<!DOCTYPE html>

<html lang="fi">

 <head>

  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

  <title>Konkurrenssikone v0.996</title>

  <style>

   body { margin: 5px auto 5px auto; width: 900px; font: 12pt "PT Sans", Calibri, sans-serif; }
   hr { color: black; background: black; height: 1px; border: 0; }
   textarea { font: 10pt Menlo, Consolas, "Courier New", monospace; width: 500px; }
   button { font: 12pt "PT Sans", Calibri, sans-serif; }
   button.b { font-weight: bold; }
   h1 { font-size: 20pt; }
   h2 { font-size: 16pt; }
   a { text-decoration: none; }
   #kayttoehdot, #demonAsetukset, #kayttoohjeet, #tarkeaaTietoa, #versiohistoria { display: none; }
   #eleven { font-weight: bold; color: red; display: none; }
   li { margin-bottom: 1em; }
   li ol { margin-top: 1em; }
   li ul { margin-top: 1em; }
   dt { font-weight: bold; }
   dd { padding-bottom: 0.5em; }
   table { border-collapse: collapse; }
   td { margin: 0; padding: 0; }
   td.lukema { width: 4em; text-align: right; padding-right: 1em; }
   td.liukusaadin { width: 300px; }
   td.liukusaadin input { width: 100%; height: 10px; padding: 0; }

  </style>

 </head>

 <body>

  <h1>Konkurrenssikone</h1>

  <p>Versio 0.996 (18.10.2021)<br />Laatinut HON Juha Terho</p>

  <hr />

  <p style="color: red"><b>Huom!</b> Konkurrenssikoneen käyttäminen edellyttää käyttöehtojen hyväksymistä. Tämä on maksuttomaan koekäyttöön tarkoitettu ns.&nbsp;beeta- eli testiversio, jonka käyttö tapahtuu omalla vastuulla.</p>

  <form onsubmit="analysoiRikosrekisteriote(this)">
    <p style="color: red">
      <input type="checkbox" name="kayttoehdotHyvaksytty" id="kayttoehdotHyvaksytty" onclick="tallennaKayttoehtojenAjankohta();" /> <b>Hyväksyn käyttöehdot</b>
      <button type="button" onclick="naytaTaiPiilota('kayttoehdot')">Näytä/piilota käyttöehdot</button>      
    </p>
    <div id="kayttoehdot">
      <p><b>Konkurrenssikoneen käyttöehdot:</b></p>
      <ol>
        <li>Konkurrenssikone on maksuttomaan koekäyttöön tarkoitettu ns. beeta- eli testiversio, jota käyttäjä käyttää omalla vastuulla, eikä konkurrenssikoneen kehittäjä tai Helsingin hovioikeus voi taata ohjelman toimivuutta tai tulosten oikeellisuutta.</li>
        <li>Konkurrenssikone ja sen lähdekoodi on julkistettu, jotta yleisö voi perehtyä konkurrenssikoneeseen ja sen toimintaan. Koekäytössä voi hyödyntää sekä demo-toimintoa että fiktiivisiä tietoja sisältävää rikosrekisteriotteen mallikappaletta. Jos konkurrenssikoneeseen tästä poiketen syötetään todellisia rikosrekisteritietoja, käyttäjä vastaa itse konkurrenssikoneen tietoturvallisesta käytöstä, rikosrekisteritietojen ja konkurrenssikoneen tulosteen salassapidosta sekä tietosuojavelvoitteiden noudattamisesta. Tarvittaessa käyttäjä voi selvittää tai selvityttää konkurrenssikoneen toiminnan yksityiskohdat lähdekoodiin tutustumalla.</li>
        <li>Konkurrenssikoneen käyttäminen edellyttää joka tapauksessa, että käyttäjä on lukenut ja ymmärtänyt oheiset ohjeet (kohdat <i>Käyttöohjeet</i> ja <i>Tärkeää tietoa</i>) ja noudattaa niitä.</li>
        <li>Konkurrenssikoneelle ei voida tarjota minkäänlaista käyttöopastusta tai teknistä tukea.</li>
        <li>Jos käyttäjä ei hyväksy käyttöehtoja kokonaisuudessaan, konkurrenssikonetta ei saa käyttää.</li>
      </ol>
    </div>
    <p style="display: none">
      Käyttöehtojen hyväksymisajankohta:
      <input type="text" readonly="readonly" name="kayttoehtojenAjankohta" id="kayttoehtojenAjankohta" />
    </p>
    <p>
      <b>Rikosrekisteriotteen sisältö:</b><br />
      <textarea name="syote" id="tekstikentta" rows="10"></textarea>
    </p>
    <p>
      <button type="button" class="b" onclick="analysoiRikosrekisteriote(this.form)">Analysoi rikosrekisteri</button>
      <button type="reset" value="reset">Tyhjennä lomake</button>
      <button type="button" onclick="naytaTaiPiilota('demonAsetukset')">Demo</button>
    </p>
    <p>
      <button type="button" onclick="naytaTaiPiilota('kayttoohjeet')">Käyttöohjeet</button>
      <button type="button" onclick="naytaTaiPiilota('tarkeaaTietoa')">Tärkeää tietoa</button>
      <button type="button" onclick="naytaTaiPiilota('versiohistoria')">Versiohistoria</button>
    </p>
    <div id="demonAsetukset">
      <table>
        <tr>
          <td colspan="3">
            <button type="button" onclick="analysoiRikosrekisteriote(this.form, true)">Luo ja analysoi mallirikosrekisteri alla olevien asetusten mukaan</button> <span id="eleven">Up&nbsp;to&nbsp;11</span>
          </td>
        </tr>
        <tr>
          <td><label>Ehdottomien tuomioiden määrä:</label></td>
          <td class="lukema" id="ehdottomienMaaraLukema"></td>
          <td class="liukusaadin"><input type="range" min="0" max="100" step="1" value="10" id="ehdottomienMaara" /></td>
        </tr>
        <tr>
          <td><label>Ehdollisten tuomioiden määrä:</label></td>
          <td class="lukema" id="ehdollistenMaaraLukema"></td>
          <td class="liukusaadin"><input type="range" min="0" max="10" step="1" value="2" id="ehdollistenMaara" /></td>
        </tr>
        <tr>
          <td><label>Rikosten enimmäismäärä tuomiossa:</label></td>
          <td class="lukema" id="rikostenEnimmaismaaraLukema"></td>
          <td class="liukusaadin"><input type="range" min="5" max="50" step="1" value="6" id="rikostenEnimmaismaara" /></td>
        </tr>
        <tr>
          <td><label>Enimmäisaika tuomioiden välillä:</label></td>
          <td class="lukema" id="tuomioidenValiMaxLukema"></td>
          <td class="liukusaadin"><input type="range" min="50" max="365" step="1" value="250" id="tuomioidenValiMax" /></td>
        </tr>
        <tr>
          <td><label>Enimmäisaika rikosten välillä:</label></td>
          <td class="lukema" id="rikostenValiMaxLukema"></td>
          <td class="liukusaadin"><input type="range" min="50" max="365" step="1" value="150" id="rikostenValiMax" /></td>
        </tr>
        <tr>
          <td><label>Muutoksenhaun todennäköisyys:</label></td>
          <td class="lukema" id="mhTodennakoisyysLukema"></td>
          <td class="liukusaadin"><input type="range" min="0" max="100" step="1" value="35" id="mhTodennakoisyys" /></td>
        </tr>
        <tr>
          <td><label>Muutoksenhaun enimmäiskesto:</label></td>
          <td class="lukema" id="mhValiMaxLukema"></td>
          <td class="liukusaadin"><input type="range" min="100" max="600" step="1" value="300" id="mhValiMax" /></td>
        </tr>
      </table>
    </div>
    <p><b>Asetukset</b><br />
    <input type="checkbox" name="varillinenKaavio" checked /> Konkurrenssikaavio värillisenä<br />
    <input type="checkbox" name="ehdollisetKaaviossa" checked /> Ehdolliset tuomiot ja nuorisorangaistukset konkurrenssikaavioon<br />
    <input type="checkbox" name="laajaLausunto" /> Pitkän mallin konkurrenssilausunto (kohdittain eritelty)<br />
    <input type="checkbox" name="lausuntoKaikille" /> Konkurrenssilausunnot myös lainvoimaisille tuomioille<br />
    <input type="checkbox" name="debug" /> Pdf-rikosrekisterin luennan vianetsintätiedot erilliseen ikkunaan<br />
  </form>

  <div id="kayttoohjeet">
    <hr />
    <h2>Käyttöohjeet</h2>
    <ul>
      <li>Kopioi pdf-muotoisen rikosrekisteriotteen koko sisältö yllä olevaan ruutuun.</li>
      <li>Rikosrekisteriotetta kopioidessasi valitse teksti aina painamalla pdf-sovelluksessa Ctrl-A. Älä siis &#8221;maalaa&#8221; tekstiä hiirellä, sillä tällöin kopioinnissa voi tapahtua virheitä ja konkurrenssikone antaa virheellisiä tuloksia.</li>
      <li>Ote ei missään tapauksessa saa olla paperitulosteesta skannattu. Käytä vain suoraan järjestelmästä otettuja pdf-muotoisia otteita. Koekäyttöä varten on olemassa rikosrekisteriotteen mallikappale.</li>
      <li>Tyhjennä leikepöytä varmuuden vuoksi heti konkurrenssikoneen käytön jälkeen.</li>
    </ul>
  </div>

  <div id="tarkeaaTietoa">

    <hr />

    <h2>Tärkeää tietoa</h2>

    <p>Lisätietoja konkurrenssikoneesta on seuraavassa Helsingin hovioikeuden julkaisussa: <i>Terho, Juha</i>: Konkurrenssikone &#8212; rikoslain 7&nbsp;luvun 6&nbsp;§:n soveltamisen automatisoinnista. Teoksessa Koponen, Pekka (toim.) &#8212; Lahti, Raimo (toim.) &#8212; Kallioinen, Laura (toim.): <a href="https://oikeus.fi/material/collections/20210407093422/7PNsJ7hZR/Valittuja_kysymyksia_rikos-_prosessi-_ja_vahingonkorvausoikeudesta_I_2021.pdf">Valittuja kysymyksiä rikos-, prosessi- ja vahingonkorvausoikeudesta</a> (s. 419&#8212;480). Helsingin hovioikeus, Helsinki 2021.</p>

    <p>Konkurrenssikoneessa on tällä hetkellä mm. seuraavat puutteet/kehitystarpeet:</p>

    <ul>
      <li>Tietojen kopioimiseen pdf-muotoisesta rikosrekisteriotteesta liittyy teknisten virheiden mahdollisuus. Luotettavampi tapa tietojen siirtämiseen rikosrekisteristä konkurrenssikoneeseen on selvitteillä.</li>
      <li>Konkurrenssikone ei tunnista tuomioita, joiden tiedot ovat rikosrekisteriotteella ruotsiksi. Rikosrekisterin luenta perustuu tällä hetkellä suomenkielisten avainsanojen kuten &#8221;vankeus&#8221; tunnistamiseen.</li>
      <li>Rikosrekisteriotteilla olevat tiedot voidaan jakaa ajallisesti kolmeen osaan:
        <ol>
          <li>vuonna 2013 tai sen jälkeen annetut Ritu-tuomiot, joiden tiedot konkurrenssikone pystyy yleensä lukemaan ongelmitta,</li>
          <li>TLP-aikakauden tuomiot vuosilta 2003&#8212;2013, joiden tietojen lukemiseen liittyy eräissä tilanteissa epävarmuustekijöitä, ja</li>
          <li>vanhimmat tuomiot vuotta 2003 edeltävältä ajalta, jotka konkurrenssikone osaa tulkita vain vajavaisesti. Tällaisia tuomioita ei enää esiinny tavallisella 10&nbsp;vuoden rikosrekisteriotteella, mutta ns. koko otteissa niitä voi olla vielä vuosikymmenten ajan.</li>
        </ol>
      </li>
      <li>Kaikkia rikosrekisteriotteen tietojen lukemiseen liittyviä tilanteita ei ole vielä kokeiltu käytännössä, ja osaan voi liittyä myös oikeuskysymyksiä, joihin ei oikeuskäytännöstä löydy selvää vastausta. Manuaalisessa tarkistuksessa on syytä kiinnittää huomiota ainakin seuraaviin:
        <ul>
          <li>onko konkurrenssikone osannut valita muutoksenhakutilanteissa oikean oikeusasteen tuomion, mihin vaikuttaa se, onko aiemmassa tuomiossa alioikeus esimerkiksi hylännyt syytteen tai tuominnut vain sakkoa tai ehdollista vankeutta (toistaiseksi tässä ei ole havaittu virheitä)</li>
          <li>käsiteltävänä olevan käräjäoikeuden tuomion jälkeen annettujen ns. jälkituomioiden merkitys hovioikeudessa (ks. esim. KKO 2018:72; tällaisten tuomioiden kohdalla konkurrenssilausuntoehdotuksissa on maininta <i>[jälkituomio]</i>)</li>
          <li>TLP-aikaisten ja varsinkin sitä vanhempien tuomioiden mahdollinen ehdollisuus alioikeudessa (rikosrekisterin merkinnöissä voi olla epäyhtenäisyyttä)</li>
          <li>rikosrekisteriotteella mahdollisesti olevat KKO:n ratkaisut, elinkautiset vankeusrangaistukset jne.</li>
          <li>ulkomaiset tuomiot (ks. seuraava kohta).</li>
        </ul>
      </li>
      <li>Ulkomaisia tuomioita tai niihin sisältyviä rikoksia ei pääsääntöisesti tunnisteta, jolloin tuomion tai rikoksen tiedot jäävät pois konkurrenssikoneen antamista tiedoista. Jos mahdollinen ulkomainen tuomio kuitenkin havaitaan, siitä annetaan käyttäjälle erillinen ilmoitus. Ulkomaisten tuomioiden tunnistus perustuu siihen, onko otteella mainittu RL 7:9:ssä tarkoitettuja valtioita.</li>
      <li>Konkurrenssikoneen tulosteessa luetellaan vain konkurrenssin kannalta merkitykselliset ehdottomat vankeusrangaistukset ml. ykp:t ja valvontarangaistukset. Tulosteessa ei siten luetella ehdollisia vankeustuomioita tai nuorisorangaistustuomioita, mutta ne esitetään konkurrenssikaaviossa katkoviivoin merkittyinä. Muuntorangaistustuomiot sivuutetaan kokonaan. Myöskään tietoja vapaudenmenetysajoista, oheisrangaistuksista, ehdollisen vankeuden tai jäännösrangaistuksen täytäntöönpanosta taikka rangaistuksen suorittamisesta ei näytetä. Näillä tiedoilla voi luonnollisesti olla merkitystä rangaistuksen määräämisessä, joten ne on tarkistettava alkuperäiseltä rikosrekisteriotteelta.</li>
      <li>Tuomiot, joilla aiempi ehdoton vankeusrangaistus on katsottu riittäväksi seuraamukseksi, näytetään konkurrenssikoneen tulosteessa, vaikka ne eivät olekaan RL 7:6:n sanamuodon mukaisia aikaisempia ehdottomia vankeustuomioita. Konkurrenssilausunnoissa on tällaisissa tapauksissa maininta hakasulkeissa siitä, että viitattu aiempi tuomio on riittävä seuraamus -tuomio.</li>
      <li>Ritu-aikaa edeltävien tuomioiden rikosten tekoajat on voitu merkitä rikosrekisteriin vapaamuotoisesti, esim. muodossa &#8221;loppuvuosi 2010&#8221; tai &#8221;8.&nbsp;ja 9.3.2012 välinen yö&#8221;. Konkurrenssikone pyrkii tunnistamaan tällaiset tekoajat eri menetelmillä, kuten etsimällä avainsanoja, joille on määritelty tietty päivämäärä: esim. &#8221;alkusyksy 2011&#8221; tulkitaan päivämääräksi 1.9.2011. Jos tällaisia tekoaikoja esiintyy, konkurrenssikone ilmoittaa käyttäjälle erikseen, miten tekoaika on tulkittu.</li>
      <li>Konkurrenssikoneessa on toiminto, joka pyrkii tunnistamaan tapauskohtaista harkintaa edellyttävät tilanteet ja ilmoittamaan niistä. Tällaisia ovat nuorisorangaistuksia tai ulkomaisia tuomioita sisältävät rikosrekisterit, rikosten ja tuomioiden sijoittuminen samalle päivälle sekä tapaukset, joissa samana päivänä on annettu tai julistettu useampi kuin yksi tuomio. Yhtenäisrangaistusjärjestelmää edeltäneitä hovioikeuksien ns. hallinnollisen yhdistämisen ratkaisuja tai vuosina 1992&#8212;1997 voimassa olleen RL 7:8:n mukaisia ns. yhteisen rangaistuksen poikkeuksellista määräämistä koskevia ratkaisuja konkurrenssikone ei pysty tulkitsemaan. Näillä ratkaisuilla ei kuitenkaan voi käytännössä olla enää vaikutusta konkurrenssiryhmien määräytymiseen nyt käsiteltävissä asioissa.</li>
      <li>Lainvoimaisten tuomioiden konkurrenssilausuntoja ei ole edes teoriassa mahdollista laatia varmuudella täysin oikein pelkkien rikosrekisteritietojen perusteella, jos huomioon otettua tuomiota koskeva muutoksenhaku on jatkunut lainvoimaiseksi tulleen viimeisimmän oikeusasteen tuomion jälkeen. Tämä johtuu siitä, että rikosrekisteristä ilmenee vain viimeisimmän oikeusasteen tuomiolauselma, eivätkä aikaisempina ajankohtina vallinneet tilanteet ole rikosrekisteriotteen pohjalta pääteltävissä kuin enintään epäsuorasti. Tällaisista tilanteista annetaan käyttäjälle erilliset ilmoitukset, jos asetuksista on valittu, että konkurrenssilausunnot laaditaan myös lainvoimaisille tuomioille.</li>
    </ul>

  </div>

  <div id="versiohistoria">

    <hr />

    <h2>Versiohistoria</h2>

    <dl>
     <dt>Versio 0.10 &#8212; 6.12.2016</dt>
     <dd>Toteutettu konkurrenssiryhmien määrittämisen automatisointi.</dd>
     <dt>Versio 0.20 &#8212; 9.12.2016</dt>
     <dd>Toteutettu rikosten tulostaminen konkurrenssiryhmien mukaiseen järjestykseen.</dd>
     <dt>Versio 0.30 &#8212; 19.12.2016</dt>
     <dd>Lisätty alustava mahdollisuus lukea pdf-muotoisen rikosrekisteriotteen tietoja.</dd>
     <dt>Versio 0.33 &#8212; 22.12.2016</dt>
     <dd>Kehitetty pdf-muotoisen rikosrekisteriotteen tietojen luentaa.</dd>
     <dt>Versio 0.40 &#8212; 1.1.2017</dt>
     <dd>Rikosrekisteriotteen tietojen lukutapaa parannettu. Lisätty muutoksenhakutilanteiden käsittely.</dd>
     <dt>Versio 0.43 &#8212; 2.1.2017</dt>
     <dd>Lisätty konkurrenssikaavio (ns. tikapuut).</dd>
     <dt>Versio 0.44 &#8212; 3.1.2017</dt>
     <dd>Kehitetty pdf-muotoisen rikosrekisteriotteen tietojen luentaa ja lisätty konkurrenssikaavioon värikoodaus.</dd>
     <dt>Versio 0.50 &#8212; 7.1.2017</dt>
     <dd>Lisätty konkurrenssilausuntojen automaattinen luominen sekä huomautukset käyttäjälle ulkomaisista tuomioista ja nuorisorangaistuksesta. Kehitetty konkurrenssikaaviota.</dd>
     <dt>Versio 0.51 &#8212; 8.1.2017</dt>
     <dd>Lisätty huomautukset käyttäjälle tilanteista, joissa samana päivänä on annettu useampi kuin yksi tuomio tai joissa rikos on tehty samana päivänä kuin jokin aiempi tuomio.</dd>
     <dt>Versio 0.52 &#8212; 18.1.2017</dt>
     <dd>Kehitetty pdf-muotoisen rikosrekisteriotteen tietojen luentaa, tulosteen sisältöä ja konkurrenssikaaviota.</dd>
     <dt>Versio 0.53 &#8212; 23.1.2017</dt>
     <dd>Kehitetty pdf-muotoisen rikosrekisteriotteen tietojen luentaa.</dd>
     <dt>Versio 0.54 &#8212; 25.1.2017</dt>
     <dd>Lisätty ilmoitus käyttäjälle tilanteesta, jossa rikosrekisteriotteelta ei löydetä huomioon otettavia ehdottomia tuomioita.</dd>
     <dt>Versio 0.55 &#8212; 8.2.2017</dt>
     <dd>Kehitetty pdf-muotoisen rikosrekisteriotteen tietojen luentaa lainvoimaa vailla olevien täytäntöönpanokelpoisten tuomioiden osalta.</dd>
     <dt>Versio 0.56 &#8212; 9.2.2017</dt>
     <dd>Lisätty mahdollisuus näyttää tarkemmat tiedot pdf-muotoisen rikosrekisterin luennasta virheiden etsimistä varten. Kehitetty tietojen luentaa ulkomaisten tuomioiden osalta.</dd>
     <dt>Versio 0.60 &#8212; 10.2.2017</dt>
     <dd>Lisätty koneen tulosteeseen tiedot tulostusajankohdasta sekä rikosrekisteriotteen pyytäjästä ja ajankohdasta. Kehitetty pdf-muotoisen rikosrekisteriotteen tietojen luentaa ja lisätty alustava tuki tuomioille, jotka on annettu ennen vuotta 2003.</dd>
     <dt>Versio 0.70 &#8212; 10.8.2017</dt>
     <dd>Kehitetty pdf-muotoisen rikosrekisteriotteen tietojen luentaa tilanteissa, joissa rikosnimike jakautuu kahdelle riville.</dd>
     <dt>Versio 0.80 &#8212; 15.8.2017</dt>
     <dd>Lisätty tulkinnanvaraisten (&#8221;alkuvuosi 2005&#8221; -tyyppisten) tekoaikojen tunnistus vanhoista TLP-aikaisista tuomioista. Lisätty myös ilmoitus käyttäjälle vanhan lain mukaisista yhdistämisratkaisuista. Kehitetty pdf-muotoisen rikosrekisteriotteen tietojen luentaa muutoinkin. Päivitetty ohjeita.</dd>
     <dt>Versio 0.90 &#8212; 16.2.2018</dt>
     <dd>Muutettu ei-lainvoimaisten tuomioiden konkurrenssilausuntoehdotusten tulostusta niin, että myös tuomion antamisen jälkeiset (hovioikeudessa mahdollisesti huomioon otettavat) tuomiot mainitaan. Ne näytetään harmaalla tekstillä ja punaisissa hakasulkeissa. Muutettu nimi konkurrenssilaskurista konkurrenssikoneeksi.</dd>
     <dt>Versio 0.91 &#8212; 20.2.2018</dt>
     <dd>Lisätty yhdyskuntapalveluiden ja valvontarangaistusten tietojen näyttäminen. Kehitetty konkurrenssiryhmittäistä tulostetta: korjattu tulostusjärjestys, parannettu ulkoasua sekä lisätty tiedot lainvoimaisuudesta ja tieto sellaisten rikosten konkurrenssiryhmistä, jotka on tuomittu eri konkurrenssin katkaisevassa muussa tuomiossa.</dd>
     <dt>Versio 0.95 &#8212; 25.2.2018</dt>
     <dd>Lisätty vaihtoehdoiksi myös konkurrenssilausunnon tulostus kohdittain eriteltynä eli ns. pitkän mallin mukaisena ja myös lainvoimaisia tuomioita koskien. Kehitetty konkurrenssikaaviota.</dd>
     <dt>Versio 0.96 &#8212; 4.3.2018</dt>
     <dd>Lisätty pitkien ja tulkinnanvaraisten tekoaikojen näyttäminen (aiemmin näytettiin vain tekoajan päättymispäivä). Kehitetty konkurrenssikaaviota sekä pdf-muotoisen rikosrekisteriotteen tietojen luentaa TLP-aikaisten tekoaikojen osalta.</dd>
     <dt>Versio 0.97 &#8212; 12.3.2018</dt>
     <dd>Lisätty konkurrenssilausuntoihin kaikkien oikeusasteiden tuomioiden tiedot.</dd>
     <dt>Versio 0.98 &#8212; 4.4.2018</dt>
     <dd>Muutettu lainvoimaisten tuomioiden konkurrenssilausuntoja niin, että niissä mainitaan myös ne tuomiot, jotka on annettu konkurrenssin kannalta ratkaisevan oikeusasteen tuomion antamisen jälkeen. Kehitetty pdf-muotoisen rikosrekisteriotteen tietojen luentaa vanhimpien TLP-aikaisten ykp-tuomiolauselmien osalta.</dd>
     <dt>Versio 0.981 &#8212; 4.6.2018</dt>
     <dd>Kehitetty pdf-muotoisen rikosrekisteriotteen tietojen luentaa käytettäessä muita sovelluksia kuin Adobe Readeria.</dd>
     <dt>Versio 0.982 &#8212; 13.8.2018</dt>
     <dd>Lisätty vaihtoehdoksi perinteinen eli mustavalkoinen konkurrenssikaavio (oletusarvo). Lisätty ilmoitus ruotsinkielisistä tuomiotiedoista, joita kone ei pysty lukemaan.</dd>
     <dt>Versio 0.983 &#8212; 20.8.2019</dt>
     <dd>Kehitetty pdf-muotoisten rikosrekisteriotteiden luentaa tilanteissa, joissa tuomion lainvoimaisuus on määrittämätön. Muutettu täytäntöönpanokelpoisten tuomioiden lainvoimaisuustiedoksi tulosteessa "Ei lainvoimainen" (aiemmin "Lainvoimainen").</dd>
     <dt>Versio 0.983b &#8212; 10.9.2019</dt>
     <dd>Lisätty huomautus siitä, että rikosrekisteriotteen tekstiä ei saa maalata hiirellä vaan on käytettävä <i>Valitse kaikki</i> -toimintoa.</dd>
     <dt>Versio 0.984 &#8212; 3.10.2019</dt>
     <dd>Kehitetty konkurrenssikaavioita. Mustavalkoisen kaavion harmaat tekstit on muutettu mustiksi, jotta kaavio tulostuu paremmin. Värillisen kaavion mallia on muutettu niin, että eri värit kuvaavat konkurrenssiryhmiä, ja erilliset viivat rikoksista konkurrenssin katkaiseviin tuomioihin on poistettu.</dd>
     <dt>Versio 0.985 &#8212; 23.10.2019</dt>
     <dd>Kehitetty pdf-muotoisen rikosrekisteriotteen tietojen luentaa yhdistelmärangaistustuomioiden osalta.</dd>
     <dt>Versio 0.99 &#8212; 25.5.2020</dt>
     <dd>Lukuisia teknisiä parannuksia. Yksinkertaistettu ulkoasua piilottamalla käyttöohjeet ja muut tiedot (saatavissa näkyviin painikkeilla). Tuloste avautuu nyt uuteen ikkunaan, samoin pdf-muotoisen otteen vianetsintätiedot (muilla selaimilla kuin IE:llä). Mahdollistettu konkurrenssikoneen käytön jatkaminen kaikilla selaimilla ilman uudelleenlatausta. Kehitetty niiden tilanteiden käsittelyä, joissa rikosrekisteriotteelta ei löydetä tuomioita. Muutettu värillinen konkurrenssikaavio oletusarvoksi ja lisätty kaavioon ehdolliset tuomiot ja nuorisorangaistukset. Lisätty ns. riittävä seuraamus -tuomiot konkurrenssikoneen tulosteeseen ja konkurrenssilausuntoehdotuksiin. Kehitetty pdf-muotoisen rikosrekisterin luentaa. Päivitetty ohjeita.</dd>
     <dt>Versio 0.991 &#8212; 1.6.2020</dt>
     <dd>Kehitetty pdf-muotoisen rikosrekisterin luentaa ns. riittävä seuraamus -tuomioiden, nuorisorangaistustuomioiden ja TLP-aikaisten tuomioiden osalta. Lisätty muuntorangaistusten tunnistus. Rajattu samalla päivällä olevien tuomioiden ja rikosten tarkistus koskemaan vain konkurrenssin katkaisevia tuomioita. Lisätty tulosteeseen tieto konkurrenssiryhmien määrittämisen kestosta.</dd>
     <dt>Versio 0.995 &#8212; 2.9.2020</dt>
     <dd>Lisätty esittelytoiminto (demo), joka luo ja analysoi esimerkkirikosrekisterin. Lisäksi toteutettu lukuisia teknisiä parannuksia. Uusittu tuomioiden, rikosten ja konkurrenssiryhmien tulostuksen toteutus pääosin ja kehitetty tulosteen ulkoasua. Uusittu kokonaan konkurrenssilausuntojen luomisen sekä samalla päivällä olevien tuomioiden ja rikosten etsimisen toteutus. Kehitetty muutoinkin niiden tilanteiden käsittelyä, joissa samalla päivällä on useita tuomioita. Otettu lainvoimaisten tuomioiden konkurrenssilausuntoehdotuksissa huomioon tilanteet, joissa huomioon otettavaa tuomiota on koskenut muutoksenhaku sen jälkeen, kun alennettu tuomio on tullut lainvoimaiseksi, ja lisätty varoitus näistä tilanteista. Lisätty konkurrenssiryhmäluettelon otsikoihin tieto konkurrenssiryhmien alku- ja loppupäivämääristä.</dd>
     <dt>Versio 0.996 &#8212; 18.10.2021</dt>
     <dd>Julkinen koekäyttöön tarkoitettu testiversio. Vähäisiä teknisiä muutoksia.</dd>
    </dl>

  </div>

  <script>

    document.getElementById("tekstikentta").focus();

    function tallennaKayttoehtojenAjankohta() {
      if(document.getElementById("kayttoehdotHyvaksytty").checked) {
        document.getElementById("kayttoehtojenAjankohta").value = ajankohtaTekstiksi(new Date());
      } else {
        document.getElementById("kayttoehtojenAjankohta").value = "";
      }
    }

    function naytaTaiPiilota(id) {
      let x = document.getElementById(id);
      if (x.style.display != "block") {
        x.style.display = "block";
      } else {
        x.style.display = "none";
      }
    }

    function onkoEleven() {
      if ( liukusaadin1.value == liukusaadin1.max &&
        liukusaadin2.value == liukusaadin2.max &&
        liukusaadin3.value == liukusaadin3.max &&
        liukusaadin4.value == liukusaadin4.max &&
        liukusaadin5.value == liukusaadin5.max &&
        liukusaadin6.value == liukusaadin6.max &&
        liukusaadin7.value == liukusaadin7.max ) {
        document.getElementById("eleven").style.display = "inline";
      } else {
        document.getElementById("eleven").style.display = "none";
      }
    }

    let liukusaadin1 = document.getElementById("ehdottomienMaara");
    let liukusaadin2 = document.getElementById("ehdollistenMaara");
    let liukusaadin3 = document.getElementById("rikostenEnimmaismaara");
    let liukusaadin4 = document.getElementById("tuomioidenValiMax");
    let liukusaadin5 = document.getElementById("rikostenValiMax");
    let liukusaadin6 = document.getElementById("mhTodennakoisyys");
    let liukusaadin7 = document.getElementById("mhValiMax");

    let lukema1 = document.getElementById("ehdottomienMaaraLukema");
    let lukema2 = document.getElementById("ehdollistenMaaraLukema");
    let lukema3 = document.getElementById("rikostenEnimmaismaaraLukema");
    let lukema4 = document.getElementById("tuomioidenValiMaxLukema");
    let lukema5 = document.getElementById("rikostenValiMaxLukema");
    let lukema6 = document.getElementById("mhTodennakoisyysLukema");
    let lukema7 = document.getElementById("mhValiMaxLukema");

    lukema1.innerHTML = liukusaadin1.value + "&nbsp;kpl";
    lukema2.innerHTML = liukusaadin2.value + "&nbsp;kpl";
    lukema3.innerHTML = liukusaadin3.value + "&nbsp;kpl";
    lukema4.innerHTML = liukusaadin4.value + "&nbsp;pv";
    lukema5.innerHTML = liukusaadin5.value + "&nbsp;pv";
    lukema6.innerHTML = liukusaadin6.value + "&nbsp;%";
    lukema7.innerHTML = liukusaadin7.value + "&nbsp;pv";

    liukusaadin1.oninput = function() { lukema1.innerHTML = this.value + "&nbsp;kpl"; onkoEleven(); }
    liukusaadin2.oninput = function() { lukema2.innerHTML = this.value + "&nbsp;kpl"; onkoEleven(); }
    liukusaadin3.oninput = function() { lukema3.innerHTML = this.value + "&nbsp;kpl"; onkoEleven(); }
    liukusaadin4.oninput = function() { lukema4.innerHTML = this.value + "&nbsp;pv"; onkoEleven(); }
    liukusaadin5.oninput = function() { lukema5.innerHTML = this.value + "&nbsp;pv"; onkoEleven(); }
    liukusaadin6.oninput = function() { lukema6.innerHTML = this.value + "&nbsp;%"; onkoEleven(); }
    liukusaadin7.oninput = function() { lukema7.innerHTML = this.value + "&nbsp;pv"; onkoEleven(); }

    // IE
    liukusaadin1.onchange = function() { lukema1.innerHTML = this.value + "&nbsp;kpl"; }
    liukusaadin2.onchange = function() { lukema2.innerHTML = this.value + "&nbsp;kpl"; }
    liukusaadin3.onchange = function() { lukema3.innerHTML = this.value + "&nbsp;kpl"; }
    liukusaadin4.onchange = function() { lukema4.innerHTML = this.value + "&nbsp;pv"; }
    liukusaadin5.onchange = function() { lukema5.innerHTML = this.value + "&nbsp;pv"; }
    liukusaadin6.onchange = function() { lukema6.innerHTML = this.value + "&nbsp;%"; }
    liukusaadin7.onchange = function() { lukema7.innerHTML = this.value + "&nbsp;pv"; }

  </script>

  <script>

///////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////

"use strict";

// globaalit muuttujat

// konkurrenssikoneen versionumero (vastaavan numeron oltava myös html:ssä)
const versio = "0.996";

// tulosteiden css-tyylipohja
let csspohja = "<style type='text/css'>"
    + "body { margin: 5px auto 5px auto; width: 900px;"
    + "       font: 12pt 'PT Sans', Calibri, sans-serif; }"
    + "hr { color: black; background: black; height: 1px; border: 1px solid black; }"
    + "svg { display: block; margin: auto; }"
    + "h1 { font-size: 20pt; }"
    + "h2 { font-size: 16pt; }"
    + "table { width: 850px; border-spacing: 0; border-collapse: collapse; }"
    + "th, td { border: 1px solid #888; margin: 0; padding: 8px; vertical-align: top; }"
    + "th { border-top: 1px solid #888; border-bottom: 1px solid #888;"
    + "     padding-top: 20px; padding-bottom: 20px; background: #eee; }"
    + "td { border-bottom: 1px solid black; }"
    + "ul { list-style-type: none; padding-left: 1em; }"
    + "ul li:before { content: '–'; position: absolute; margin-left: -1em; } "
    + ".varoitus { color: red; }"                           // varoitukset
    + ".eilainvoimainen { color: red; }"                    // lainvoimaa vailla olevan tuomion lainvoimaisuustieto
    + ".konkurrenssinkatkaiseva { color: red; }"            // tieto konkurrenssin katkaisevan tuomion konk.ryhmästä
    + ".konkurrenssitieto { color: gray; }"                 // tieto rikoksen konk.ryhmästä/ei-katkaisevasta tuomiosta
    + ".erikonkurrenssi { color: gray;"                     // eri konkurrenssin rikokset
    + "                   text-decoration: line-through; }"
    + ".jalkituomio { color: red; }"                        // tieto siitä, että kyseessä on jälkituomio
    + ".pvmtieto { color: gray; }"                          // tieto tulkinnanvaraisen päivämäärän tulkinnasta
    + ".debugkorostus { color: red; }"                      // korostetut kohdat debug-osiossa
    + ".debughimmennys { color: gray; }"                    // himmennetyt rivit debug-osiossa (laji 0)
    + "</style>";

// laskuri, joka sisältää tiedon siitä, monettako kertaa konkurrenssikonetta käytetään
let kayttokertalaskuri = 0;

///////////////////////////////////////////////////////////////////////
// analysoiRikosrekisteriote:
// funktio, joka käynnistyy painamalla "Analysoi rikosrekisteri" -painiketta ja kutsuu konkurrenssikone-funktiota
// lomakkeen tietojen perusteella; jos demo == true, tuloste perustuu luotavaan esimerkkirikosrekisteriin

function analysoiRikosrekisteriote(lomake, demo) {

    // haetaan tiedot lomakkeesta

    let rikosrekisteriote = lomake.syote.value;

    let asetukset = {}
    asetukset.varillinenKaavio = lomake.varillinenKaavio.checked;       // onko konkurrenssikaavio värillinen
    asetukset.ehdollisetKaaviossa = lomake.ehdollisetKaaviossa.checked; // näytetäänkö kaaviossa myös ehdolliset
    asetukset.laajaLausunto = lomake.laajaLausunto.checked;             // ovatko konkurrenssilausunnot pitkää mallia
    asetukset.lausuntoKaikille = lomake.lausuntoKaikille.checked;       // konkurrenssilausunnot myös lainvoimaisille
    asetukset.debug = lomake.debug.checked;                             // debug-tiedot pdf-rikosrekisterin luennasta
    asetukset.demo = false;                                             // onko kyseessä esittelytila
    if (demo) {
        asetukset.demo = true;
        asetukset.demo_ehdottomienMaara = lomake.ehdottomienMaara.value;
        asetukset.demo_ehdollistenMaara = lomake.ehdollistenMaara.value;
        asetukset.demo_rikostenEnimmaismaara = lomake.rikostenEnimmaismaara.value;
        asetukset.demo_tuomioidenValiMax = lomake.tuomioidenValiMax.value;
        asetukset.demo_rikostenValiMax = lomake.rikostenValiMax.value;
        asetukset.demo_mhTodennakoisyys = lomake.mhTodennakoisyys.value / 100;
        asetukset.demo_mhValiMax = lomake.mhValiMax.value;
    }

    // tarkistetaan, onko käyttöehdot hyväksytty, ja tallennetaan hyväksymisajankohta

    if(!lomake.kayttoehdotHyvaksytty.checked && !asetukset.demo) {
        alert("Käyttöehtoja ei ole hyväksytty. Konkurrenssikoneen käyttäminen edellyttää käyttöehtojen "
            + "hyväksymistä. Ns. demo- eli esittelytilan käyttäminen on kuitenkin mahdollista "
            + "(Demo-painike).");
        return;
    } else {
        asetukset.kayttoehtojenAjankohta = lomake.kayttoehtojenAjankohta.value;
    }

    // syötetään lomakkeen tiedot konkurrenssikoneeseen, joka palauttaa tulosteen

    let tuloste = konkurrenssikone(rikosrekisteriote, asetukset);

    // avataan uusi ikkuna konkurrenssikoneen tulosteelle (tuloste[0])

    if (navigator.userAgent.indexOf("Trident/") == -1) {
        let tulostusikkuna = window.open();
        tulostusikkuna.document.write(tuloste[0]);
    } else {
        document.write(tuloste[0]); // Internet Explorerissa kuitenkin tulostetaan samaan ikkunaan
    }

    // avataan uusi ikkuna mahdolliselle debug-tulosteelle (tuloste[1])

    if (asetukset.debug && !demo) {
        if (navigator.userAgent.indexOf("Trident/") == -1) {
            let debugikkuna = window.open();
            debugikkuna.document.write(tuloste[1]);
        } else {
            alert("Rikosrekisterin luennan vianetsintätietojen tulostamista ei tueta Internet Explorer -selaimella.");
        }
    }

}

///////////////////////////////////////////////////////////////////////
// konkurrenssikone:
// funktio, joka lukee pdf-muotoisen rikosrekisterin ja laatii siitä html-muotoisen tulosteen

function konkurrenssikone(rikosrekisteriote, asetukset) {

    // suoritusajan mittaus
    let aika = {
        aloitettu: 0,
        alustusValmis: 0,
        rikosrekisterioteLuettuTaiLuotu: 0,
        konkurrenssiryhmatMaaritetty: 0,
        valmis: 0,
    }

    aika.aloitettu = performance.now();

    // taulukot konkurrenssikoneen HTML-muotoisten tulosteiden osille (varsinainen tuloste ja debug-tiedot
    // pdf-rikosrekisterin luennasta); lopuksi näiden taulukoiden sisältö yhdistetään palautettaviksi merkkijonoiksi
    let tulosteHTML = [];
    let debugHTML = [];
    let tulosteHTMLlopullinen = "";
    let debugHTMLlopullinen = "";

    // tulostetaan konsoliin tiedot konkurrenssikoneen versiosta, asetuksista ym.
    kayttokertalaskuri++;
    console.log("Konkurrenssikone v" + versio + ", käyttöajankohta " + new Date().toLocaleString("fi-FI")
        + ", käyttökerta " + kayttokertalaskuri);
    console.log("Käyttöehtojen hyväksymisajankohta: " + asetukset.kayttoehtojenAjankohta);
    console.log("Asetukset:");
    console.log("- konkurrenssikaavio värillisenä: " + asetukset.varillinenKaavio);
    console.log("- konkurrenssikaaviossa ehdolliset ja nuorisorangaistukset: " + asetukset.ehdollisetKaaviossa);
    console.log("- laaja konkurrenssilausunto: " + asetukset.laajaLausunto);
    console.log("- konkurrenssilausunnot kaikille tuomioille: " + asetukset.lausuntoKaikille);
    console.log("- debug-tila: " + asetukset.debug);
    console.log("- demo-tila: " + asetukset.demo);
    if (asetukset.demo) {
        console.log("- demo-tilan asetukset: ");
        console.log("-- ehdottomia: " + asetukset.demo_ehdottomienMaara);
        console.log("-- ehdollisia: " + asetukset.demo_ehdollistenMaara);
        console.log("-- rikoksia/tuomio max: " + asetukset.demo_rikostenEnimmaismaara);
        console.log("-- tuomioiden väli max: " + asetukset.demo_tuomioidenValiMax);
        console.log("-- rikosten väli max: " + asetukset.demo_rikostenValiMax);
        console.log("-- mh-todennäköisyys: " + asetukset.demo_mhTodennakoisyys);
        console.log("-- mh-tuomioiden väli max: " + asetukset.demo_mhValiMax);
    }

    // seuraaviin taulukoihin tallennetaan RL 7:6:n mukaiset ehdottomat tuomiot ja niiden rikokset
    // (ml. ns. riittävä seuraamus -tuomiot, jotka käsitellään käytännössä kuten ehdottomat)
    let ehdottomatTuomiot = []; // taulukko, joka sisältää ehdottomat tuomiot
    let rikosluetteloEhdottomat = []; // taulukko, joka sisältää ehdottomien tuomioiden rikokset

     // konkurrenssiryhmät määritetään maaritaKonkurrenssiryhmat-funktiossa kahden edellisen taulukon pohjalta
    let konkurrenssiryhmat = [];

    // seuraaviin taulukoihin tallennetaan ehdolliset tuomiot (sekä nuorisorangaistukset);
    // ehdolliset eivät vaikuta RL 7:6:n soveltamiseen tai konkurrenssiryhmiin mutta näytetään konkurrenssikaaviossa
    let ehdollisetTuomiot = [];
    let rikosluetteloEhdolliset = [];

    // taulukko käyttäjälle annettavista ilmoituksista koskien tulkinnanvaraisia tilanteita ym.
    let varoitukset = [];

    // taulukko, johon tulee tieto rikosrekisterikyselyn tekijästä (kyselytiedot[0]) ja ajankohdasta (kyselytiedot[1])
    let kyselytiedot = ["", ""];

    aika.alustusValmis = performance.now();

    // luetaan pdf-muotoinen rikosrekisteriote tai luodaan esimerkkirikosrekisteri

    if (!asetukset.demo) {

        luePdfRikosrekisteriote(rikosrekisteriote, ehdottomatTuomiot, rikosluetteloEhdottomat, ehdollisetTuomiot,
            rikosluetteloEhdolliset, kyselytiedot, varoitukset, asetukset.debug, debugHTML);

    } else {

        // aloitetaan tuomioiden luominen kuluvasta päivästä
        let tuomionPvm = new Date();

        // luodaan ehdottomat tuomiot rikosrekisteriin; funktio palauttaa vanhimman tuomion päivämäärän;
        // viimeinen argumentti (3) määrittää, montako uusimmista tuomioista (ainakin) on lainvoimaa vailla
        tuomionPvm = luoEsimerkkiRikrek(ehdottomatTuomiot, rikosluetteloEhdottomat, tuomionPvm,
            asetukset.demo_ehdottomienMaara, asetukset.demo_rikostenEnimmaismaara, asetukset.demo_tuomioidenValiMax,
            asetukset.demo_rikostenValiMax, asetukset.demo_mhTodennakoisyys, asetukset.demo_mhValiMax, 3);

        // luodaan ehdolliset tuomiot em. päivämäärästä taaksepäin
        luoEsimerkkiRikrek(ehdollisetTuomiot, rikosluetteloEhdolliset, tuomionPvm,
            asetukset.demo_ehdollistenMaara, asetukset.demo_rikostenEnimmaismaara, asetukset.demo_tuomioidenValiMax,
            asetukset.demo_rikostenValiMax, asetukset.demo_mhTodennakoisyys, asetukset.demo_mhValiMax, 0);

    }

    aika.rikosrekisterioteLuettuTaiLuotu = performance.now();

    // tutkitaan rikosrekisteri ja laaditaan tuloste
    // tulosteen sisältö määräytyyy sen mukaan, onko rikosrekisterissä ehdottomia tuomioita

    if (rikosluetteloEhdottomat.length > 0) {

        // lajitellaan rikosrekisterin sisältö (pdf:ssä tai muussa lähteessä ei välttämättä oikeassa järjestyksessä)
        lajitteleTuomiot(ehdottomatTuomiot, rikosluetteloEhdottomat);

        // määritetään konkurrenssiryhmät
        maaritaKonkurrenssiryhmat(ehdottomatTuomiot, rikosluetteloEhdottomat, konkurrenssiryhmat, varoitukset);

        // luodaan tuomiokohtaiset luettelot rikosten konkurrenssiryhmistä konkurrenssilausuntojen luomiseksi
        valmisteleKonkurrenssilausunnot(ehdottomatTuomiot, rikosluetteloEhdottomat, varoitukset,
            asetukset.lausuntoKaikille);

        // käydään läpi rikosrekisteri sen tarkistamiseksi, onko samana päivänä annettu useampia tuomioita
        etsiTuomioidenPaallekkaisyydet(ehdottomatTuomiot, konkurrenssiryhmat, varoitukset);

        aika.konkurrenssiryhmatMaaritetty = performance.now();

        // tulostetaan otsikko- ym. tiedot, rikosrekisteriotteen tiedot ja asetukset
        tulostaJohdanto(kyselytiedot, asetukset, Math.round(aika.konkurrenssiryhmatMaaritetty
            - aika.rikosrekisterioteLuettuTaiLuotu), tulosteHTML);

        // tulostetaan varoitukset/virheilmoitukset
        tulostaVaroitukset(varoitukset, tulosteHTML);

        // tulostetaan rikosrekisterin ehdottomat tuomiot konkurrenssimerkinnöin
        tulostaEhdottomatTuomiot(ehdottomatTuomiot, rikosluetteloEhdottomat, asetukset.laajaLausunto,
            asetukset.lausuntoKaikille, tulosteHTML);

        // tulostetaan tuomiot ja rikokset konkurrenssiryhmittäin
        tulostaKonkurrenssiryhmat(ehdottomatTuomiot, rikosluetteloEhdottomat, konkurrenssiryhmat, tulosteHTML);

        // jos konkurrenssikaavioon ei haluta ehdollisia ja nuorisorangaistuksia, tyhjennetään ao. taulukot
        if (!asetukset.ehdollisetKaaviossa) {
            ehdollisetTuomiot = [];
            rikosluetteloEhdolliset = [];
        }

        // tulostetaan konkurrenssikaavio eli "tikapuut"
        tulostaKonkurrenssikaavio(ehdottomatTuomiot, rikosluetteloEhdottomat, ehdollisetTuomiot,
            rikosluetteloEhdolliset, asetukset.varillinenKaavio, tulosteHTML);

    } else {

        // jos rikosrekisterissä ei ole ehdottomia tuomioita, tulostetaan enintään konkurrenssikaavio

        // tulostetaan otsikko- ym. tiedot, rikosrekisteriotteen tiedot ja asetukset
        // (kun konkurrenssiryhmien analysoinnin kestoksi annetaan negatiivinen arvo, tietoa ei tulosteta)
        tulostaJohdanto(kyselytiedot, asetukset, -1, tulosteHTML);

        // tulostetaan varoitukset/virheilmoitukset
        tulostaVaroitukset(varoitukset, tulosteHTML);

        // tulostetaan ilmoitukset siitä, että rikosrekisteristä ei löydetty (ehdottomia) tuomioita

        if (ehdollisetTuomiot.length == 0) {

            tulosteHTML.push("<h2>Rikosrekisteriotteelta ei löydetty tuomioita</h2>");
            tulosteHTML.push("<p>Konkurrenssikone ei havainnut tuomioita, jotka olisivat RL 7:6:n mukaisesti "
                + "huomioon otettavia (ehdottomat vankeustuomiot sekä ykp- ja valvontarangaistustuomiot). "
                + "Myöskään konkurrenssikaaviossa esitettäviä muita tuomioita (ehdolliset vankeustuomiot "
                + "ja nuorisorangaistustuomiot) ei havaittu. Tarkista alkuperäisestä rikosrekisteriotteesta, "
                + "että tuomioita ei ole.</p>");

        } else {

            tulosteHTML.push("<h2>Rikosrekisteriotteelta ei löydetty ehdottomia vankeustuomioita</h2>");
            tulosteHTML.push("<p>Konkurrenssikone ei havainnut tuomioita, jotka olisivat RL 7:6:n mukaisesti "
                + "huomioon otettavia (ehdottomat vankeustuomiot sekä ykp- ja valvontarangaistustuomiot). "
                + "Tarkista alkuperäisestä rikosrekisteriotteesta, että tällaisia tuomioita ei ole.</p>");

            if (asetukset.ehdollisetKaaviossa) {

                tulosteHTML.push("<p>Konkurrenssikaaviossa esitetään kuitenkin rikosrekisteriotteesta havaitut "
                    + "ehdolliset vankeustuomiot ja/tai nuorisorangaistustuomiot.</p>");
                tulostaKonkurrenssikaavio(ehdottomatTuomiot, rikosluetteloEhdottomat, ehdollisetTuomiot,
                    rikosluetteloEhdolliset, asetukset.varillinenKaavio, tulosteHTML);

            } else {

                tulosteHTML.push("<p>Konkurrenssikone on kuitenkin havainnut ainakin yhden ehdollisen tuomion "
                    + "tai nuorisorangaistustuomion, jollaiset voitaisiin näyttää konkurrenssikaaviossa. "
                    + "Konkurrenssikoneen asetusten mukaan tällaiset tuomiot jätetään kuitenkin pois "
                    + "konkurrenssikaaviosta. Tämän vuoksi myöskään konkurrenssikaaviota ei tulosteta.</p>");
            }
        }

    }

    // yhdistetään tulostetaulukoiden tiedot yksittäisiksi merkkijonoiksi

    for (let i = 0; i < tulosteHTML.length; i++) {
        tulosteHTMLlopullinen += tulosteHTML[i];
    }

    for (let i = 0; i < debugHTML.length; i++) {
        debugHTMLlopullinen += debugHTML[i];
    }

    aika.valmis = performance.now();

    // tulostetaan konsoliin tiedot eri vaiheiden kestosta

    if (rikosluetteloEhdottomat.length > 0) {

        console.log("Konkurrenssikone valmis. Toimenpiteiden kesto millisekunteina:");
        console.log("- alustus " + Math.round(aika.alustusValmis - aika.aloitettu) + " ms");
        if (!asetukset.demo) {
            console.log("- pdf-muotoisen rikosrekisterin luenta "
                + Math.round(aika.rikosrekisterioteLuettuTaiLuotu - aika.alustusValmis) + " ms");            
        } else {
            console.log("- esimerkkirikosrekisterin luonti "
                + Math.round(aika.rikosrekisterioteLuettuTaiLuotu - aika.alustusValmis) + " ms");            
        }
        console.log("- konkurrenssiryhmien määrittäminen "
            + Math.round(aika.konkurrenssiryhmatMaaritetty - aika.rikosrekisterioteLuettuTaiLuotu) + " ms");
        console.log("- konkurrenssikoneen tulosteen laatiminen "
            + Math.round(aika.valmis - aika.konkurrenssiryhmatMaaritetty) + " ms");
        console.log("- koko aika " + Math.round(aika.valmis - aika.aloitettu) + " ms.");
        console.log("--------------------");

    } else {

        console.log("Konkurrenssikone valmis. Huomioon otettavia ehdottomia tuomioita ei löydetty. "
            + "Toimenpiteiden kesto millisekunteina:");
        console.log("- alustus " + Math.round(aika.alustusValmis - aika.aloitettu) + " ms");
        if (!asetukset.demo) {
            console.log("- pdf-muotoisen rikosrekisterin luenta "
                + Math.round(aika.rikosrekisterioteLuettuTaiLuotu - aika.alustusValmis) + " ms");            
        } else {
            console.log("- esimerkkirikosrekisterin luonti "
                + Math.round(aika.rikosrekisterioteLuettuTaiLuotu - aika.alustusValmis) + " ms");            
        }
        console.log("- konkurrenssikoneen tulosteen laatiminen "
            + Math.round(aika.valmis - aika.rikosrekisterioteLuettuTaiLuotu) + " ms");
        console.log("- koko aika " + Math.round(aika.valmis - aika.aloitettu) + " ms.");
        console.log("--------------------");

    }

    return([tulosteHTMLlopullinen, debugHTMLlopullinen]);

}

///////////////////////////////////////////////////////////////////////
// Rikos:
// konstruktori rikokselle

function Rikos(pvm, syytekohta, nimike, tuomionro, konkurrenssiryhmanro, pitkaTekoaika, alkupvm, pvmTeksti,
    pvmEpaselva) {

    // rikoksen perustiedot: tekopäivä, syytekohta ja rikosnimike
    this.pvm = pvm;
    this.syytekohta = syytekohta;
    this.nimike = nimike;

    // sen tuomion numero, jossa rikos on luettu syyksi
    this.tuomionro = tuomionro;

    // sen konkurrenssiryhmän numero, johon rikos kuuluu
    this.konkurrenssiryhmanro = konkurrenssiryhmanro;

    // onko kyseessä ns. pitkä tekoaika, jolla on erillinen alkupäivämäärä (true/false)
    this.pitkaTekoaika = pitkaTekoaika;

    // pitkän tekoajan alkupäivämäärä
    this.alkupvm = alkupvm;

    // onko kyseessä tulkinnanvarainen tekoaika, esim. "kevät 2005" (true/false)
    this.pvmEpaselva = pvmEpaselva;

    // tulkinnanvarainen tekoaika tekstimuodossa
    this.pvmTeksti = pvmTeksti;

}

///////////////////////////////////////////////////////////////////////
// Rikos.tekoaikaTekstina:
// funktio, joka palauttaa tekoajan tekstimuodossa taulukkona: [pvm tekstinä, tulkinnanvaraisen ajankohdan tarkka pvm]

Rikos.prototype.tekoaikaTekstina = function () {

    // jos tekoaika on pitkä (alkupvm:stä pvm:ään), se ei ole tulkinnanvarainen
    if (this.pitkaTekoaika) {
        return([ajanjaksoTekstiksi(this.alkupvm, this.pvm), ""]);
    }

    // jos tekoaika on tulkinnanvarainen (esim. "alkuvuosi 2009"), palautetaan sekä tekstimuotoinen pvm
    // että siitä tulkittu tarkka pvm; muussa tapauksessa palautetaan tarkka pvm
    if (this.pvmEpaselva || (typeof this.pvmTeksti == "string" && this.pvmTeksti.length > 0)) {
        return([this.pvmTeksti, pvmTekstiksi(this.pvm)]);
    } else {
        return([pvmTekstiksi(this.pvm), ""]);
    }

}

///////////////////////////////////////////////////////////////////////
// Tuomio:
// konstruktori tuomiolle

function Tuomio(pvm, tuomioistuin, ratkaisunro, rangaistus, lainvoimaisuus, katkaisevaTuomio,
    pvm1, tuomioistuin1, ratkaisunro1, pvm2, tuomioistuin2, ratkaisunro2, pvm3, tuomioistuin3, ratkaisunro3) {

    // tuomion perustiedot
    this.pvm = pvm;
    this.tuomioistuin = tuomioistuin;
    this.ratkaisunro = ratkaisunro;
    this.rangaistus = rangaistus;
    this.lainvoimaisuus = lainvoimaisuus;

    // tiedot eri oikeusasteiden tuomioista;
    // katkaisevaTuomio osoittaa, onko konkurrenssin kannalta ratkaiseva oikeusaste 1, 2 vai 3;
    // kyseisen oikeusasteen tuomion tiedot ovat myös yllä olevissa pvm-, tuomioistuin- ja ratkaisunro-muuttujissa
    this.katkaisevaTuomio = katkaisevaTuomio;
    this.pvm1 = pvm1;
    this.tuomioistuin1 = tuomioistuin1;
    this.ratkaisunro1 = ratkaisunro1;
    this.pvm2 = pvm2;
    this.tuomioistuin2 = tuomioistuin2;
    this.ratkaisunro2 = ratkaisunro2;
    this.pvm3 = pvm3;
    this.tuomioistuin3 = tuomioistuin3;
    this.ratkaisunro3 = ratkaisunro3;

    // taulukko, jossa on viittaukset rikosten numeroihin
    this.rikokset = [];

    // tieto siitä, onko kyseessä konkurrenssin katkaiseva tuomio (määritetään myöhemmin erikseen)
    this.konkurrenssiryhmanro = null;

    // luettelo tuomiossa edustetuista konkurrenssiryhmistä (määritetään myöhemmin erikseen)
    this.konkurrenssiryhmat = [];

    // luettelot tuomion rikoksista, jotka ovat tiettyä konkurrenssiryhmää
    // (määritetään erikseen; sisältää taulukoita, joiden indeksit tässä taulukossa vastavat edellistä)
    this.konkurrenssiryhmienRikokset = [];

    // luettelo muista tuomioista, jotka ovat tietyn konkurrenssiryhmän huomioon otettavia tuomioita
    // (määritetään erikseen; sisältää taulukoita, joiden indeksit tässä taulukossa vastaavat kahta edellistä)
    this.konkurrenssiryhmienHuomioonOtettavatTuomiot = [];

    // luettelo huomioon otettavista tuomioista (ilman konkurrenssiryhmittäistä erittelyä)
    this.huomioonOtettavatTuomiot = [];

}

///////////////////////////////////////////////////////////////////////
// Tuomio.pisinNimi:
// funktio, jonka palauttaman taulukon ensimmäisenä elementtinä [0] on konkurrenssin kannalta merkityksellisen
// oikeusasteen tuomion indeksi ja muina elementteinä (joita on 1, 2 tai 3 kpl) eri oikeusasteiden tuomioiden nimet
// pitkässä muodossa

Tuomio.prototype.pisinNimi = function() {
    let kokonimi = [];
    kokonimi[0] = this.katkaisevaTuomio;
    kokonimi[1] = this.tuomioistuin1 + " " + pvmTekstiksi(this.pvm1) + " no " + this.ratkaisunro1;
    if (this.tuomioistuin2 != "") {
        kokonimi[2] = this.tuomioistuin2 + " " + pvmTekstiksi(this.pvm2) + " no " + this.ratkaisunro2;
        if (this.tuomioistuin3 != "") {
            kokonimi[3] = this.tuomioistuin3 + " " + pvmTekstiksi(this.pvm3) + " no " + this.ratkaisunro3;
        }
    }
    return (kokonimi);
}

///////////////////////////////////////////////////////////////////////
// Tuomio.pidempiNimi:
// funktio, joka palauttaa taulukon, joka vastaa muuten pisinNimi-funktiota,
// mutta tuomioiden nimet on lyhennetty (KO -> käräjäoikeus jne.)

Tuomio.prototype.pidempiNimi = function() {
    let kokonimi = this.pisinNimi();
    for (let i = 1; i < kokonimi.length; i++) {
        kokonimi[i] = lyhennaTuomionTiedot(kokonimi[i]);
    }
    return (kokonimi);
}

///////////////////////////////////////////////////////////////////////
// Tuomio.pitkaNimi:
// funktio, joka palauttaa merkkijonona tuomion nimen, jossa eri oikeusasteet on mainittu;
// jos ensimmäinen argumentti on true, lopussa ilmoitetaan, onko kyseessä ns. riittävä seuraamus -tuomio;
// jos annetaan toinen argumentti eli katkaisupvm, katkaistaan tulostus ko. päivämäärään

Tuomio.prototype.pitkaNimi = function(onkoRiittavaSeuraamus, katkaisupvm) {

    let kokonimi;

    if (katkaisupvm == undefined) {

        kokonimi = this.tuomioistuin1 + " " + pvmTekstiksi(this.pvm1) + " no " + this.ratkaisunro1;

        if (this.tuomioistuin2 != "") {
            kokonimi += " (";
            kokonimi += this.tuomioistuin2 + " " + pvmTekstiksi(this.pvm2) + " no " + this.ratkaisunro2;
            if (this.tuomioistuin3 != "") {
                kokonimi += ", ";
                kokonimi += this.tuomioistuin3 + " " + pvmTekstiksi(this.pvm3) + " no " + this.ratkaisunro3;
            }
            kokonimi += ")";
        }

    } else {

        if (this.tuomioistuin2 == "") {
            if (this.pvm1 > katkaisupvm) {
                kokonimi = "[tuomio annettu vasta " + pvmTekstiksi(katkaisupvm) + " jälkeen]";
            } else {
                kokonimi = this.tuomioistuin1 + " " + pvmTekstiksi(this.pvm1) + " no " + this.ratkaisunro1;
            }
        } else {
            if (this.tuomioistuin3 == "") {
                if (this.pvm1 > katkaisupvm) {
                    kokonimi = this.tuomioistuin2 + " " + pvmTekstiksi(this.pvm2) + " no " + this.ratkaisunro2;
                } else {
                    kokonimi = this.tuomioistuin1 + " " + pvmTekstiksi(this.pvm1) + " no " + this.ratkaisunro1;
                    kokonimi += " (";
                    kokonimi += this.tuomioistuin2 + " " + pvmTekstiksi(this.pvm2) + " no " + this.ratkaisunro2;
                    kokonimi += ")";
                }
            } else {
                if (this.pvm2 > katkaisupvm) {
                    kokonimi = this.tuomioistuin3 + " " + pvmTekstiksi(this.pvm3) + " no " + this.ratkaisunro3;
                } else {
                    if (this.pvm1 > katkaisupvm) {
                        kokonimi = this.tuomioistuin2 + " " + pvmTekstiksi(this.pvm2) + " no " + this.ratkaisunro2;
                        kokonimi += " (";
                        kokonimi += this.tuomioistuin3 + " " + pvmTekstiksi(this.pvm3) + " no " + this.ratkaisunro3;
                        kokonimi += ")";
                    } else {
                        kokonimi = this.tuomioistuin1 + " " + pvmTekstiksi(this.pvm1) + " no " + this.ratkaisunro1;
                        kokonimi += " (";
                        kokonimi += this.tuomioistuin2 + " " + pvmTekstiksi(this.pvm2) + " no " + this.ratkaisunro2;
                        kokonimi += ", ";
                        kokonimi += this.tuomioistuin3 + " " + pvmTekstiksi(this.pvm3) + " no " + this.ratkaisunro3;
                        kokonimi += ")";
                    }
                }
            }
        }

    }

    if (onkoRiittavaSeuraamus && this.rangaistus == "Riittävä seuraamus") {
        kokonimi += " [riittävä seuraamus -tuomio]";
    }

    return (kokonimi);

}

///////////////////////////////////////////////////////////////////////
// Tuomio.lyhytNimi:
// funktio, joka palauttaa merkkijonona lyhyen version tuomion nimestä
// (vain konkurrenssin kannalta merkityksellisen oikeusasteen tuomion tiedot)

Tuomio.prototype.lyhytNimi = function() {
    // ratkaisunro voi olla 0, jos annetaan varoitus ulkomaisesta tuomiosta
    // (ulkomaisille tuomioille ei välttämättä ole merkitty ratkaisunroa rikosrekisteriin)
    if (this.ratkaisunro != 0) {
        return (this.tuomioistuin + " " + pvmTekstiksi(this.pvm) + " no " + this.ratkaisunro);
    } else {
        return (this.tuomioistuin + " " + pvmTekstiksi(this.pvm));
    }
}

///////////////////////////////////////////////////////////////////////
// Tuomio.lyhyinNimi:
// funktio, joka palauttaa merkkijonona lyhyimmän version tuomion nimestä
// (kuten lyhytNimi-funktio mutta ilman ratkaisunumeroa)

Tuomio.prototype.lyhyinNimi = function() {
    return (lyhennaTuomionTiedot(this.tuomioistuin + " " + pvmTekstiksi(this.pvm)));
}

///////////////////////////////////////////////////////////////////////
// Tuomio.viimeinenPvm:
// funktio, joka palauttaa tuomion viimeisen oikeusasteen ratkaisupäivämäärän

Tuomio.prototype.viimeinenPvm = function() {
    let viimeinen = new Date(this.pvm1.getTime());
    if (this.tuomioistuin2 != "" && this.pvm2 > viimeinen) {
        viimeinen = new Date(this.pvm2.getTime());
    }
    if (this.tuomioistuin3 != "" && this.pvm3 > viimeinen) {
        viimeinen = new Date(this.pvm3.getTime());
    }
    return viimeinen;
}

///////////////////////////////////////////////////////////////////////
// Konkurrenssiryhma:
// konstruktori konkurrenssiryhmälle

function Konkurrenssiryhma(pvm, tuomionro, rikokset) {
    this.pvm = pvm;             // konkurrenssiryhmän päättymispäivä
    this.tuomionro = tuomionro; // konkurrenssin katkaisevan tuomion numero
}

///////////////////////////////////////////////////////////////////////
// maaritaKonkurrenssiryhmat:
// funktio, joka analysoi rikosrekisterin ja määrittää konkurrenssiryhmät

function maaritaKonkurrenssiryhmat(tuomiot, rikosluettelo, konkurrenssiryhmat, varoitukset) {

    console.log("Rikosrekisterin analysointi ja konkurrenssiryhmien määrittäminen alkaa");

    // käydään läpi tuomiot (tuomiot-taulukko, silmukka i) ja niissä olevat rikokset
    // (tuomiot[i].rikokset-taulukko, silmukka j) ja verrataan rikosten päivämäärää aiempien konkurrenssiryhmien
    // päivämääriin (konkurrenssiryhmat-taulukko, silmukka k)

    for (let i = 0; i < tuomiot.length; i++) { // käydään läpi tuomiot (i)

        // apumuuttuja, jossa tieto siitä, katkaiseeko käsiteltävänä oleva tuomio konkurrenssin
        let tuomioKatkaiseeKonkurrenssin = false;

        // käydään läpi kaikki käsiteltävänä olevan tuomion rikokset (j)

        for (let j = 0; j < tuomiot[i].rikokset.length; j++) {

            // seuraava määrittely on vain koodin luettavuuden parantamiseksi
            let rikos = rikosluettelo[tuomiot[i].rikokset[j]];

            // kunkin rikoksen kohdalla käydään läpi aiemmat konkurrenssiryhmät

            for (let k = 0; k < konkurrenssiryhmat.length; k++) {

                // tarkistetaan, kuuluuko rikos aiempaan konkurrenssiin:
                // jos konkurrenssiryhmä on vielä null, rikos ei ole sopinut aiempiin konkurrenssiryhmiin;
                // kun oikea konkurrenssiryhmä on löytynyt ja merkitty, arvo ei ole enää null eikä ko. ehto voi täyttyä

                if (rikos.konkurrenssiryhmanro == null && rikos.pvm <= konkurrenssiryhmat[k].pvm) {

                    rikos.konkurrenssiryhmanro = k; // jos kuuluu, niin tämä merkitään ko. rikoksen tietoihin

                    // tarkistetaan, onko rikos tehty samana päivänä kuin konkurrenssin katkaiseva tuomio,
                    // ja annetaan tästä varoitus

                    if (rikos.pvm.getTime() === konkurrenssiryhmat[k].pvm.getTime()) {

                        // seuraava määritys on vain koodin luettavuuden parantamiseksi
                        let katkaisevanTuomionNro = tuomiot[konkurrenssiryhmat[k].tuomionro];

                        varoitukset.push("Tuomioon <i>" + tuomiot[i].lyhytNimi() + "</i>"
                            + " kuuluva rikos (<i>" + rikos.syytekohta + " " + rikos.nimike + "</i>) on tehty "
                            + pvmTekstiksi(rikos.pvm) + " eli samana päivänä kuin konkurrenssin katkaiseva tuomio "
                            + "<i>" + katkaisevanTuomionNro.tuomioistuin + " no " + katkaisevanTuomionNro.ratkaisunro
                            + "</i> on annettu tai julistettu; tarkista konkurrenssi tältä osin");

                    }

                }

            }

            // uusi konkurrenssiryhmä muodostuu, jos rikosta ei ole merkitty mihinkään aiempaan konkurrenssiryhmään

            if (rikos.konkurrenssiryhmanro == null) {

                tuomioKatkaiseeKonkurrenssin = true;
                rikos.konkurrenssiryhmanro = konkurrenssiryhmat.length;

            }

        }

        // jos kyseessä on konkurrenssin katkaiseva tuomio:

        if (tuomioKatkaiseeKonkurrenssin) {

            // käsiteltävänä olevan tuomion tietoihin merkitään, että se muodostaa uuden konkurrenssiryhmän
            tuomiot[i].konkurrenssiryhmanro = konkurrenssiryhmat.length;

            // lisätään uusi konkurrenssiryhmä, jolla on nyt käsiteltävää tuomiota vastaavat tiedot
            // (pvm, järjestysnro)
            konkurrenssiryhmat.push(new Konkurrenssiryhma(new Date(tuomiot[i].pvm.getTime()), i));

        }

    }

    console.log("Rikosrekisterin analysointi ja konkurrenssiryhmien määrittäminen valmis. "
        + "Konkurrenssiryhmien määrä: " + konkurrenssiryhmat.length);

}

///////////////////////////////////////////////////////////////////////
// valmisteleKonkurrenssilausunnot:
// funktio, joka luo tuomiokohtaiset luettelot rikosten konkurrenssiryhmistä konkurrenssilausuntojen luomiseksi

function valmisteleKonkurrenssilausunnot(tuomiot, rikosluettelo, varoitukset, lausuntoKaikille) {

    console.log("Konkurrenssilausuntojen valmistelu alkaa");

    // tehdään luettelot kunkin tuomion konkurrenssiryhmistä ja siitä, mitä rikoksia niihin kuuluu

    // käydään läpi kaikki tuomiot (i)
    for (let i = 0; i < tuomiot.length; i++) {

        // käydään läpi tuomion kaikki rikokset (j)
        for (let j = 0 ; j < tuomiot[i].rikokset.length; j++) {

            // seuraava määritys on vain koodin luettavuuden parantamiseksi
            let rikos = rikosluettelo[tuomiot[i].rikokset[j]];

            // jos rikoksen konkurrenssiryhmää ei ole vielä konkurrenssiryhmäluettelossa, lisätään se
            // (ja vastaavasti tyhjä taulukko konkurrenssiryhmän rikosten luetteloon)
            if (tuomiot[i].konkurrenssiryhmat.indexOf(rikos.konkurrenssiryhmanro) == -1) {
                tuomiot[i].konkurrenssiryhmat.push(rikos.konkurrenssiryhmanro);
                tuomiot[i].konkurrenssiryhmienRikokset.push([]);
            }

            // lisätään nyt käsiteltävän rikoksen syytekohta konkurrenssiryhmän rikosten luetteloon
            // konkurrenssiryhmäluetteloa vastaavaan kohtaan
            tuomiot[i].konkurrenssiryhmienRikokset[tuomiot[i].konkurrenssiryhmat
                .indexOf(rikos.konkurrenssiryhmanro)].push(rikos.syytekohta);

        }

    }

    // täydennetään em. luetteloita lisäämällä niihin luettelot tuomioista, joissa on samoja konkurrenssiryhmiä;
    // lähtökohtaisesti käydään läpi aiemmat tuomiot, mutta myös myöhemmät tuomiot on tutkittava,
    // koska ne voivat olla ns. jälkituomioita (kKO 2018:72)

    // käydään läpi kaikki tuomiot (i)
    for (let i = 0; i < tuomiot.length; i++) {

        // käydään jokaisen tuomion kohdalla läpi kaikki siinä olevat konkurrenssiryhmät (j)
        for (let j = 0; j < tuomiot[i].konkurrenssiryhmat.length; j++) {

            // lisätään konkurrenssiryhmienHuomioonOtettavatTuomiot-taulukkoon tyhjä taulukko
            // vastaamaan ao. konkurrenssiryhmää
            tuomiot[i].konkurrenssiryhmienHuomioonOtettavatTuomiot.push([]);

            // käydään läpi kaikki muut tuomiot (k)
            for (let k = 0; k < tuomiot.length; k++) {

                // tarkistetaan siis ensin, että tarkasteltava tuomio (k) ei ole nyt läpikäytävä tuomio (i)
                if (k != i) {

                    // tarkasteltava tuomio (k) on mahdollisesti huomioon otettava tuomio, jos:
                    // - tuomio (k) on annettu aiemmin kuin nyt läpikäytävä tuomio (i) TAI
                    // - nyt läpikäytävä tuomio (i) on lainvoimaa vailla (jolloin kaikki olemassa olevat tuomiot
                    //   voidaan ottaa jälkituomioina huomioon) TAI
                    // - tuomio (k) on annettu (konkurrenssin kannalta merkityksellisessä mielessä) viimeistään
                    //   sinä päivänä, jolloin nyt läpikäytävä tuomio (i) on ratkaistu viimeisessä oikeusasteessa
                    //   (viimeksi mainitun päivän jälkeisiä tuomioita ei ole voitu ottaa i:ssä huomioon)

                    if (k < i || !tuomiot[i].lainvoimaisuus || tuomiot[k].pvm <= tuomiot[i].viimeinenPvm()) {

                        // onko muun tuomion (k) konkurrenssiryhmissä nyt käsiteltävää konkurrenssiryhmää (j)?
                        if (tuomiot[k].konkurrenssiryhmat.indexOf(tuomiot[i].konkurrenssiryhmat[j]) != -1) {

                            // jos on, lisätään muu tuomio (k) nyt käsiteltävän konkurrenssiryhmän (j) kohdalle
                            // konkurrenssiryhmienHuomioonOtettavatTuomiot-taulukkoon
                            tuomiot[i].konkurrenssiryhmienHuomioonOtettavatTuomiot[j].push(k);

                            // jos asetusten mukaan konkurrenssilausunto laaditaan myös lainvoimaisille tuomioille,
                            // tarkistetaan, onko huomioon otettavassa tuomiossa (k) muutoksenhaku jatkunut
                            // tuomion (i) lainvoimaiseksi tulleen viimeisen oikeusasteen tuomion jälkeen
                            if (lausuntoKaikille && tuomiot[i].lainvoimaisuus &&
                                tuomiot[i].viimeinenPvm() < tuomiot[k].viimeinenPvm()) {
                                let varoitus = ("Lainvoimaisessa tuomiossa <i>" + tuomiot[i].pitkaNimi() + "</i> "
                                    + "on otettava huomioon <i>" + tuomiot[k].lyhytNimi() + "</i>; "
                                    + "ensin mainitun tuomion viimeisen oikeusasteen tuomion antamispäivän "
                                    + pvmTekstiksi(tuomiot[i].viimeinenPvm()) + " jälkeen "
                                    + "on jälkimmäistä tuomiota koskenut muutoksenhaku: "
                                    + "<i>" + tuomiot[k].pitkaNimi() + "</i>");
                                if (varoitukset.indexOf(varoitus) == -1) {
                                    varoitukset.push(varoitus);
                                }
                            }

                        }

                    }

                }

            }

        }

    }

    // laaditaan edellisten tulosten perusteella tiivistetty luettelo lyhyiden konkurrenssilausuntojen tulostamiseksi

    // käydään läpi kaikki tuomiot (i)
    for (let i = 0; i < tuomiot.length; i++) {

        // käydään jokaisen tuomion kohdalla läpi kaikki siinä olevat konkurrenssiryhmät (j)
        for (let j = 0; j < tuomiot[i].konkurrenssiryhmat.length; j++) {

            // käydään tuomion (i) konkurrenssiryhmän (j) huomioon otettavat tuomiot (k) läpi
            for (let k = 0; k < tuomiot[i].konkurrenssiryhmienHuomioonOtettavatTuomiot[j].length; k++) {

                // tarkistetaan, onko huomioon otettava tuomio (k) jo tämän tuomion (i) huomioon otettavien luettelossa
                if (tuomiot[i].huomioonOtettavatTuomiot
                        .indexOf(tuomiot[i].konkurrenssiryhmienHuomioonOtettavatTuomiot[j][k]) == -1) {

                    // jos ei ole, lisätään se sinne
                    tuomiot[i].huomioonOtettavatTuomiot
                        .push(tuomiot[i].konkurrenssiryhmienHuomioonOtettavatTuomiot[j][k]);

                }

            }

        }

    }

    console.log("Konkurrenssilausuntojen valmistelu valmis");

}

///////////////////////////////////////////////////////////////////////
// etsiTuomioidenPaallekkaisyydet:
// funktio, joka tarkistaa, onko rikosrekisterissä useita (ehdottomia) tuomioita konkurrenssiryhmän päättymispäivällä,
// ja lisää varoitukset-taulukkoon niitä koskevat varoitukset

function etsiTuomioidenPaallekkaisyydet(tuomiot, konkurrenssiryhmat, varoitukset) {

    console.log("Samalla päivällä olevien tuomioiden etsintä alkaa");

    // muuttuja, johon luodaan yksi varoitus kerrallaan
    let varoitus = "";

    // käydään läpi kaikki konkurrenssiryhmät (i)
    for (let i = 0; i < konkurrenssiryhmat.length; i++) {

        // tarkistetaan kyseistä konkurrenssiryhmää seuraavat tuomiot (j)
        // (maaritaKonkurrenssiryhmat-funktio toimii niin, että jos samalla päivällä on useita konkurrenssin
        // katkaisevia tuomioita, niistä ensimmäinen muodostuu katkaisevaksi tuomioksi ja muut eivät)
        let j = konkurrenssiryhmat[i].tuomionro + 1;

        // käydään läpi seuraavat tuomiot yksi kerrallaan (j) seuraavin ehdoin:
        // - rikosrekisterin loppupäätä ei saa ohittaa
        // - tuomion (j) päivämäärän on oltava konkurrenssiryhmän (i) päättymispäivä
        // - tuomiossa on oltava kyseisen konkurrenssiryhmän rikoksia

        while (j < tuomiot.length && konkurrenssiryhmat[i].pvm.toDateString() == tuomiot[j].pvm.toDateString() &&
            tuomiot[j].konkurrenssiryhmat.indexOf(i) != -1) {

            // jos kaikki ehdot täyttyvät, on löytynyt ainakin yksi seuraava tuomio (j);
            // ensimmäisen kohdalla tulostetaan myös varoituksen alkuosa
            if (varoitus == "") {
                varoitus = "Konkurrenssiryhmän " + toRoman(i + 1) + " päättymispäivänä "
                    + pvmTekstiksi(konkurrenssiryhmat[i].pvm)
                    + " on annettu tai julistettu useampi kuin yksi tuomio, jossa on ko. ryhmän rikoksia &#8211; "
                    + "tarkista tuomioiden keskinäinen järjestys: ";
                varoitus += tuomiot[j - 1].tuomioistuin + " no " + tuomiot[j - 1].ratkaisunro
                    + " (katsottu tässä konkurrenssin katkaisevaksi)";
            }

            varoitus += ", " + tuomiot[j].tuomioistuin + " no " + tuomiot[j].ratkaisunro;

            j++;

        }

        if (varoitus != "") {
            varoitukset.push(varoitus);
            varoitus = "";
        }

    }

    console.log("Samalla päivällä olevien tuomioiden etsintä valmis");

}

///////////////////////////////////////////////////////////////////////
// listaaSyytekohdat:
// funktio, joka palauttaa merkkijonona oikein muotoillun luettelon syytekohdista,
// esim. [1, "3.", 4, 5, "6.1", "6.2", 7] => "1, 3-5, 6.1, 6.2 ja 7"

function listaaSyytekohdat(syytekohdat) {

    // vaihe 1/3: käydään läpi syytekohdat, stilisoidaan numerot ja merkitään pelkkaNro-taulukkoon (true/false),
    // onko kunkin syytekohdan numero pelkkä numero (eli ei esim. "12.1")

    let pelkkaNro = [];

    for (let i = 0; i < syytekohdat.length; i++) {
        if (typeof syytekohdat[i] == "number") {
            syytekohdat[i] = syytekohdat[i].toString();
            pelkkaNro.push(true);
        } else {
            if (syytekohdat[i][syytekohdat[i].length - 1] == "." || syytekohdat[i][syytekohdat[i].length - 1] == ")") {
                syytekohdat[i] = syytekohdat[i].slice(0, -1); // poistetaan piste tai sulku lopusta
            }
            let numerot = syytekohdat[i].replace(/[^0-9]/g, ""); // karsitaan kaikki paitsi numerot 0-9
            let alkuosa = parseInt(syytekohdat[i]); // ensimmäinen kokonaisluku
            if (numerot == alkuosa) { // onko nro esim. mallia "12.1" eli kaikki nrot eivät ole alkuosassa?
                pelkkaNro.push(true);
            } else {
                pelkkaNro.push(false);
            }
        }
    }

    // vaihe 2/3: ryhmitellään syytekohdat numerokokonaisuuksiksi (nroRyhmat)

    let nroRyhmat = [];

    {
        let i = 0;
        let j = 0;
        do {
            if (i < syytekohdat.length && pelkkaNro[i]) {
                do {
                    j++;
                    if (j == syytekohdat.length) {
                        break;
                    }
                } while (pelkkaNro[j] && parseInt(syytekohdat[j]) - parseInt(syytekohdat[j - 1]) == 1)
                j--;
                if (j > i + 1) {
                    nroRyhmat.push(syytekohdat[i] + "&#8211;" + syytekohdat[j]);
                    i = j;
                } else {
                    nroRyhmat.push(syytekohdat[i].toString());
                    j = i;
                }
            } else {
                nroRyhmat.push(syytekohdat[i]);
            }
            i++;
            j++;
        } while (i < syytekohdat.length)
    }

    // vaihe 3/3: yhdistetään numerokokonaisuudet yhdeksi merkkijonoksi (syytekohtaLista), jonka funktio palauttaa

    let syytekohtaLista = "";

    for (let i = 0; i < nroRyhmat.length; i++) {
        syytekohtaLista += nroRyhmat[i];
        if (i >= 0 && i < nroRyhmat.length - 2) {
            syytekohtaLista += ", ";
        }
        if (i >= 0 && i == nroRyhmat.length - 2) {
            syytekohtaLista += " ja&nbsp;";
        }
    }

    return syytekohtaLista;

}

///////////////////////////////////////////////////////////////////////
// pvmTekstiksi:
// funktio, joka palauttaa päivämäärän oikein muotoiltuna

function pvmTekstiksi(pvm) {
    return(pvm.getDate() + "." + (pvm.getMonth() + 1) + "." + pvm.getFullYear());
}

///////////////////////////////////////////////////////////////////////
// ajankohtaTekstiksi:
// funktio, joka palauttaa päivämäärän ja kellonajan oikein muotoiltuna

function ajankohtaTekstiksi(ajankohta) {
    return(pvmTekstiksi(ajankohta)
        + " klo " + ("0" + ajankohta.getHours()).slice(-2)
        + "." + ("0" + ajankohta.getMinutes()).slice(-2)
        + "." + ("0" + ajankohta.getSeconds()).slice(-2));
}

///////////////////////////////////////////////////////////////////////
// ajanjaksoTekstiksi:
// funktio, joka palauttaa kahden päivämäärän välin oikein muotoiltuna

function ajanjaksoTekstiksi(alkupvm, loppupvm) {

    let ajanjakso = "";

    if (alkupvm != loppupvm) {
        ajanjakso += alkupvm.getDate();
        ajanjakso += ".";
        if (alkupvm.getMonth() != loppupvm.getMonth() || alkupvm.getFullYear() != loppupvm.getFullYear()) {
            ajanjakso += (alkupvm.getMonth() + 1);
            ajanjakso += ".";
        }
        if (alkupvm.getFullYear() != loppupvm.getFullYear()) {
            ajanjakso += alkupvm.getFullYear();
        }
        ajanjakso += "&#8211;";
    }

    ajanjakso += pvmTekstiksi(loppupvm);

    return(ajanjakso);

}

///////////////////////////////////////////////////////////////////////
// lyhennaTuomionTiedot:
// funktio, joka palauttaa tuomion nimen sisältävän merkkijonon lyhennettynä (käräjäoikeus -> KO jne.)

function lyhennaTuomionTiedot(tuomionTiedot) {
    return(tuomionTiedot
        .replace("käräjäoikeus", "KO")
        .replace("hovioikeus", "HO")
        .replace("Korkein oikeus", "KKO")
        .replace("tingsrätt", "TR")
        .replace("hovrätt", "HovR")
        .replace("Högsta domstolen", "HD")
        .replace("raastuvanoikeus", "RO")
        .replace("kihlakunnanoikeus", "KO")
        .replace("tuomiokunta", "TK")
        .replace("rådstuvurätt", "RR")
        .replace("häradsrätt", "HR")
        .replace("rådhusrätt", "RR")
        .replace("domsaga", "DS"));
}

///////////////////////////////////////////////////////////////////////
// toRoman:
// funktio, joka palauttaa annetun numeron roomalaisena numerona

function toRoman(num) {

    const decimal = [1000, 900, 500, 400, 100, 90, 50, 40, 10, 9, 5, 4, 1];
    const roman = ["M", "CM", "D", "CD", "C", "XC", "L", "XL", "X", "IX", "V", "IV", "I"];
    let result = "";

    for (let i = 0; i <= decimal.length; i++) {
        while (num % decimal[i] < num) {
            result += roman[i];
            num -= decimal[i];
        }
    }

    return result;

}

///////////////////////////////////////////////////////////////////////
// tulostaJohdanto:
// funktio, joka luo konkurrenssikoneen tulosteen alkuosan

function tulostaJohdanto(kyselytiedot, asetukset, kesto, tulosteHTML) {

    console.log("Konkurrenssikoneen tulosteen luominen alkaa");
    console.log("Johdantotekstien tulostaminen alkaa");

    let nyt = ajankohtaTekstiksi(new Date());

    tulosteHTML.push("<!DOCTYPE html><html><head><title>Konkurrenssikoneen tuloste " + nyt + "</title>"
        + csspohja + "</head><body>");

    tulosteHTML.push("<h1>Konkurrenssikoneen tuloste</h1>")

    if (!asetukset.demo) {
        tulosteHTML.push("<p><b>SALASSA PIDETTÄVÄ. Ks. rikosrekisterilaki 3 ja 11&nbsp;§, "
            + "laki oikeudenkäynnin julkisuudesta yleisissä tuomioistuimissa 9&nbsp;§ 1&nbsp;mom. 4&nbsp;kohta "
            + "sekä laki viranomaisten toiminnan julkisuudesta 24&nbsp;§ 1&nbsp;mom. 28&nbsp;kohta.</b></p>");
    } else {
        tulosteHTML.push("<p><b>Tämä on mallituloste, joka ei perustu todellisen rikosrekisteriotteen tietoihin "
            + "vaan esimerkkiaineistoon, jonka konkurrenssikone on luonut käyttäjän määrittämien asetusten "
            + "mukaisesti.</b></p>");
    }

    tulosteHTML.push("<p><b>Konkurrenssikoneen versio:</b> " + versio + "<br />");
    tulosteHTML.push("<b>Konkurrenssikoneen käyttöajankohta:</b> " + nyt + "<br />");

    if (!asetukset.demo) {
        tulosteHTML.push("<b>Käyttöehtojen hyväksymisajankohta:</b> " + asetukset.kayttoehtojenAjankohta + "<br />");
    }

    tulosteHTML.push("<b>Selaimen tunnistetiedot:</b> " + navigator.userAgent + "<br />");

    if (kyselytiedot[0] != "") {
        tulosteHTML.push("<b>Rikosrekisteriotteen tilaaja:</b> " + kyselytiedot[0]);
        if (kyselytiedot[1] != "") {
            tulosteHTML.push(" (" + kyselytiedot[1] + ")");
        }
        tulosteHTML.push("<br />");
    }

    if (kesto > 0) {
        tulosteHTML.push("<b>Rikosrekisterin analysoinnin kesto:</b> "
            + (kesto/1000).toLocaleString("fi-FI") + " s<br />");
    } else if (kesto = 0) {
        tulosteHTML.push("<b>Rikosrekisterin analysoinnin kesto:</b> alle 0,001 s<br />");
    }

    tulosteHTML.push("<b>Asetukset:</b> ");
    if (asetukset.varillinenKaavio) {
        tulosteHTML.push("Konkurrenssikaavio värillisenä ");
    } else {
        tulosteHTML.push("Konkurrenssikaavio mustavalkoisena" );
    }
    if (asetukset.ehdollisetKaaviossa) {
        tulosteHTML.push("sisältäen mahdolliset ehdolliset tuomiot ja nuorisorangaistukset, ");
    } else {
        tulosteHTML.push("ilman mahdollisia ehdollisia tuomioita ja nuorisorangaistuksia, ");
    }
    if (asetukset.laajaLausunto) {
        tulosteHTML.push("konkurrenssilausunnot pitkän mallin mukaisena (kohdittain eriteltynä) ja ");
    } else {
        tulosteHTML.push("konkurrenssilausunnot lyhyen mallin mukaisena (ilman kohdittaista erittelyä) ja ");
    }
    if (asetukset.lausuntoKaikille) {
        tulosteHTML.push("kaikille tuomioille lainvoimaisuudesta riippumatta");
    } else {
        tulosteHTML.push("vain lainvoimaa vailla oleville tuomioille");
    }

    if (asetukset.demo) {
        tulosteHTML.push("<br />");
        tulosteHTML.push("<b>Mallitulosteen luonnin asetukset:</b> "
            + "Ehdottomia tuomioita " + asetukset.demo_ehdottomienMaara + "&nbsp;kpl, "
            + "ehdollisia tuomioita " + asetukset.demo_ehdollistenMaara + "&nbsp;kpl, "
            + "rikoksia tuomiossa enintään " + asetukset.demo_rikostenEnimmaismaara + "&nbsp;kpl, "
            + "tuomioiden&nbsp;väli enintään " + asetukset.demo_tuomioidenValiMax + "&nbsp;pv, "
            + "rikosten&nbsp;väli enintään " + asetukset.demo_rikostenValiMax + "&nbsp;pv, "
            + "muutoksenhaun todennäköisyys " + asetukset.demo_mhTodennakoisyys * 100 + "&nbsp;%, "
            + "eri&nbsp;oikeusasteiden tuomioiden väli enintään " + asetukset.demo_mhValiMax + "&nbsp;pv");
    }

    tulosteHTML.push("</p>");

    console.log("Johdantotekstien tulostaminen valmis");

}

///////////////////////////////////////////////////////////////////////
// tulostaVaroitukset:
// funktio, joka tulostaa rikosrekisterin lukemiseen ja analysointiin liittyvät varoitukset

function tulostaVaroitukset(varoitukset, tulosteHTML) {

    console.log("Varoitusten tulostaminen alkaa. Varoitusten määrä: " + varoitukset.length);

    if (varoitukset.length > 0) {
        tulosteHTML.push("<hr /><p class='varoitus'>"
            + "<b><u>Huom! Konkurrenssikone havaitsi seuraavat epäselvyydet rikosrekisterissä:</u></b></p><ul>");
    }

    for (let i = 0; i < varoitukset.length; i++) {
        tulosteHTML.push("<li>" + varoitukset[i] + "</li>");
    }

    if (varoitukset.length > 0) {
        tulosteHTML.push("</ul>");
    }

    tulosteHTML.push("<hr />");

    console.log("Varoitusten tulostaminen valmis");

}

///////////////////////////////////////////////////////////////////////
// tulostaEhdottomatTuomiot:
// funktio, joka tulostaa rikosrekisterin ehdottomat tuomiot konkurrenssimerkinnöin

function tulostaEhdottomatTuomiot(tuomiot, rikosluettelo, laajaLausunto, lausuntoKaikille, tulosteHTML) {

    console.log("Rikosrekisterin tulostaminen alkaa");

    tulosteHTML.push("<h2>Ehdottomat tuomiot konkurrenssimerkinnöin</h2>");

    // tulostetaan kaikki tuomiot käänteisessä järjestyksessä eli uusimmat ensin

    for (let i = tuomiot.length - 1; i >= 0; i--) {

        // tulostetaan käsiteltävänä olevan tuomion tiedot (tuomioistuin, päivämäärä ja ratkaisunumero)
        // eri oikeusasteiden tuomioita voi olla enintään kolme;
        // niistä alleviivataan konkurrenssin kannalta merkityksellinen

        tulosteHTML.push("<p><b>");

        let tuomionNimi = tuomiot[i].pisinNimi();

        for (let j = 1; j < tuomionNimi.length; j++) {
            if (j > 1) {
                tulosteHTML.push("<br />");
            }
            if (j == tuomionNimi[0]) {
                tulosteHTML.push("<u>");
            }
            tulosteHTML.push(tuomionNimi[j]);
            if (j == tuomionNimi[0]) {
                tulosteHTML.push("</u>");
            }
        }

        tulosteHTML.push("</b>");

        // tulostetaan tieto siitä, onko kyseessä konkurrenssin katkaiseva tuomio ja jos on,
        // minkä konkurrenssiryhmän tuomiosta on kyse

        if (tuomiot[i].konkurrenssiryhmanro == null) {
            tulosteHTML.push(" <i class='konkurrenssitieto'>(ei katkaise konkurrenssia)</i>");
        } else {
            tulosteHTML.push(" <i class='konkurrenssinkatkaiseva'>(" + toRoman(tuomiot[i].konkurrenssiryhmanro + 1)
                + ")</i>");
        }

        tulosteHTML.push("</p>");

        // tulostetaan tuomiossa olevat rikokset

        tulosteHTML.push("<dl>");

        // käydään läpi kaikki tuomion (i) rikokset (j)
        for (let j = 0; j < tuomiot[i].rikokset.length; j++) {

            // seuraava määritys on vain koodin luettavuuden parantamiseksi
            let rikos = rikosluettelo[tuomiot[i].rikokset[j]];

            // tulostetaan rikoksen syytekohta ja nimike
            tulosteHTML.push("<dt>" + rikos.syytekohta + "&nbsp;" + rikos.nimike + "</dt>");

            tulosteHTML.push("<dd>");

            // tulostetaan rikoksen tekoaika
            let rikoksenPvmTiedot = rikos.tekoaikaTekstina();
            tulosteHTML.push(rikoksenPvmTiedot[0]);
            if (rikoksenPvmTiedot[1] != "") {
                tulosteHTML.push(" <span class='konkurrenssitieto'>[=&nbsp;" + rikoksenPvmTiedot[1] + "]</span>");
            }

            // tulostetaan tieto rikoksen konkurrenssiryhmästä, jos rikos kuuluu aiempaan konkurrenssiryhmään
            if (rikos.konkurrenssiryhmanro != tuomiot[i].konkurrenssiryhmanro) {
                tulosteHTML.push(" <i class='konkurrenssitieto'> (&#8594;&nbsp;"
                    + toRoman(rikos.konkurrenssiryhmanro + 1) + ")</i>");
            }


            tulosteHTML.push("</dd>");

        }

        tulosteHTML.push("</dl>");

        // tulostetaan tieto rangaistuksesta

        tulosteHTML.push("<p><i>" + tuomiot[i].rangaistus + "</i></p>");

        // tulostetaan tieto tuomion lainvoimaisuudesta ja mahdollinen konkurrenssilausunto

        // ilmoitetaan ensin tuomion lainvoimaisuus

        if (!tuomiot[i].lainvoimaisuus) {
             tulosteHTML.push("<p><b class='eilainvoimainen'>Tuomio ei ole lainvoimainen.");
        } else {
             tulosteHTML.push("<p><b>Tuomio on lainvoimainen.");
        }

        // ei ilmoiteta muita tietoja, jos käyttäjä haluaa konkurrenssilausunnon
        // vain lainvoimaa vailla oleville tuomioille ja tuomio on lainvoimainen

        if (!lausuntoKaikille && tuomiot[i].lainvoimaisuus) {

            tulosteHTML.push("</b></p>");

        } else {

            // muussa tapauksessa laaditaan ehdotus konkurrenssilausunnoksi

            //  jos huomioon otettavia tuomioita ei ole, lausunto on "tyhjä"

            if (tuomiot[i].huomioonOtettavatTuomiot.length == 0) {

                tulosteHTML.push("</b> Aiempia huomioon otettavia rangaistuksia ei ole.</p>");

            } else {

                // jos huomioon otettavia tuomioita on, konkurrenssilausunto on käyttäjän valinnan mukaan
                // pitkän tai lyhyen malliin mukainen

                if (laajaLausunto) {

                    // vaihtoehto 1: tulostetaan tuomiolle pitkän mallin mukainen konkurrenssilausunto

                    tulosteHTML.push(" Ehdotus tuomiolauselman kohtuullistamislausunnoksi (ns. pitkä malli):</b></p>");

                    tulosteHTML.push("<p>Rangaistusta alentavana on otettu huomioon:</p>");

                    // lasketaan, montako konkurrenssiryhmää tuomiosta mainitaan
                    // (määrä selviää vasta läpikäynnin yhteydessä)
                    let mainitutKonkurrenssiryhmat = 0;
                    let viimeisimmanKonkryhmatEritelty = false;
                    let poistettavatElementit = [];

                    tulosteHTML.push("<ul>");
                    poistettavatElementit.push(tulosteHTML.length - 1);

                    // käydään läpi kaikki tuomion konkurrenssiryhmät (pitkä malli muodostuu konkurrenssiryhmittäin)
                    for (let n = 0; n < tuomiot[i].konkurrenssiryhmat.length; n++) {

                        // konkurrenssiryhmästä ei mainita mitään, jos siinä ei ole huomioon otettavia tuomioita
                        if (tuomiot[i].konkurrenssiryhmienHuomioonOtettavatTuomiot[n].length > 0) {

                            mainitutKonkurrenssiryhmat++;

                            tulosteHTML.push("<li>");
                            poistettavatElementit.push(tulosteHTML.length - 1);

                            // eritellään, missä kohdissa on kyse ao. konkurrenssiryhmästä;
                            // erittelylle ei kuitenkaan ole tarvetta, jos tuomion kaikki rikokset ovat
                            // samaa konkurrenssiryhmää
                            if (tuomiot[i].konkurrenssiryhmienRikokset[n].length != tuomiot[i].rikokset.length) {

                                viimeisimmanKonkryhmatEritelty = true;

                                if (tuomiot[i].konkurrenssiryhmienRikokset[n].length == 1) {
                                    tulosteHTML.push("kohdassa ");
                                } else {
                                    tulosteHTML.push("kohdissa ");
                                }

                                // tulostetaan konkurrenssiryhmän rikosten syytekohtien numerot
                                tulosteHTML.push(listaaSyytekohdat(tuomiot[i].konkurrenssiryhmienRikokset[n]));

                                // konkurrenssiryhmän roomalainen numero mainitaan kohtien jälkeen hakasulkeissa
                                tulosteHTML.push(" <span class='konkurrenssitieto'>[=&nbsp;"
                                    + toRoman(tuomiot[i].konkurrenssiryhmat[n] + 1) + "]</span>");

                            } else {

                                viimeisimmanKonkryhmatEritelty = false;

                            }

                            tulosteHTML.push("<ul>");

                            // käydään läpi kaikki ao. konkurrenssiryhmän huomioon otettavat tuomiot
                            for (let o = 0; o < tuomiot[i].konkurrenssiryhmienHuomioonOtettavatTuomiot[n].length;
                                o++) {

                                tulosteHTML.push("<li>");

                                // seuraavat kolme määrittelyä ovat vain koodin luettavuuden parantamiseksi

                                let huomioonOtettavanTuomionNro = tuomiot[i]
                                    .konkurrenssiryhmienHuomioonOtettavatTuomiot[n][o];

                                let huomioonOtettavanTuomionKonkryhmaViittaus = tuomiot[huomioonOtettavanTuomionNro]
                                    .konkurrenssiryhmat.indexOf(tuomiot[i].konkurrenssiryhmat[n]);

                                let huomioonOtettavanTuomionKonkryhmanRikokset = tuomiot[huomioonOtettavanTuomionNro]
                                    .konkurrenssiryhmienRikokset[huomioonOtettavanTuomionKonkryhmaViittaus];

                                // tulostetaan huomioon otettavan tuomion nimi;
                                // argumentti 0 == true: mainitaan tarvittaessa, onko kyseessä riittävä seuraamus
                                // argumentti 1: tuomion (i) viimeinen päivämäärä, johon tulostus katkaistaan
                                // (jos tällä on vaikutusta, siitä tulostetaan jäljempänä huomautus);
                                // huom. tämä koskee vain lainvoimaisille tuomioille tehtäviä konkurrenssilausuntoja

                                if (tuomiot[i].lainvoimaisuus) {
                                    tulosteHTML.push(tuomiot[huomioonOtettavanTuomionNro]
                                        .pitkaNimi(true, tuomiot[i].viimeinenPvm()));
                                } else {
                                    tulosteHTML.push(tuomiot[huomioonOtettavanTuomionNro]
                                        .pitkaNimi(true));
                                }

                                if (huomioonOtettavanTuomionNro > i) {
                                    tulosteHTML.push(" <span class='jalkituomio'>[jälkituomio]</span>");
                                }

                                // eritellään, missä huomioon otettavan tuomion kohdissa on kyse
                                // ao. konkurrenssiryhmästä; erittelylle ei kuitenkaan ole tarvetta,
                                // jos huomioon otettavan tuomion kaikki rikokset ovat samaa konkurrenssiryhmää  
                                if (huomioonOtettavanTuomionKonkryhmanRikokset.length !=
                                    tuomiot[huomioonOtettavanTuomionNro].rikokset.length) {

                                    if (huomioonOtettavanTuomionKonkryhmanRikokset.length == 1) {
                                        tulosteHTML.push(" sen&nbsp;kohdan&nbsp;");
                                    } else {
                                        tulosteHTML.push(" sen&nbsp;kohtien&nbsp;");
                                    }

                                    // tulostetaan huomioon otettavan tuomion niiden rikosten syytekohtien numerot,
                                    // jotka ovat ao. konkurrenssiryhmää
                                    tulosteHTML.push(listaaSyytekohdat(huomioonOtettavanTuomionKonkryhmanRikokset));

                                    tulosteHTML.push("&nbsp;osalta");

                                }

                                // lainvoimaisessa tuomiossa huomioon otettavaa tuomiota on voinut koskea
                                // myöhempi muutoksenhaku; jos näin on, lisätään ilmoitus siitä
                                if (tuomiot[i].lainvoimaisuus && tuomiot[i].viimeinenPvm() <
                                    tuomiot[huomioonOtettavanTuomionNro].viimeinenPvm()) {
                                    tulosteHTML.push("<br /><span class='varoitus'>[huom. ko. tuomiossa muutoksenhaku "
                                        + pvmTekstiksi(tuomiot[i].viimeinenPvm()) + " jälkeen]</span>");
                                }

                                tulosteHTML.push("</li>");

                            }

                            tulosteHTML.push("</ul>");

                            tulosteHTML.push("</li>");
                            poistettavatElementit.push(tulosteHTML.length - 1);

                        }

                    }

                    tulosteHTML.push("</ul>");
                    poistettavatElementit.push(tulosteHTML.length - 1);

                    // poistetaan lopuksi tarpeettomat HTML-elementit, jos konkurrenssiryhmiä on mainittu vain 1
                    // (tällöin vältytään ylimääräiseltä luettelon sisennykseltä)

                    if (mainitutKonkurrenssiryhmat == 1 && !viimeisimmanKonkryhmatEritelty) {
                        for (let n = 0; n < poistettavatElementit.length; n++) {
                            tulosteHTML[poistettavatElementit[n]] = "";
                        }
                    }

                } else {

                    // vaihtoehto 2: tulostetaan tuomiolle lyhyen mallin mukainen konkurrenssilausunto

                    tulosteHTML.push(" Ehdotus tuomiolauselman kohtuullistamislausunnoksi:</b></p>");

                    if (tuomiot[i].huomioonOtettavatTuomiot.length == 1) {
                        tulosteHTML.push("<p>Rangaistusta alentavana on otettu huomioon "
                            + "seuraava aiempi vankeusrangaistus:");
                    }

                    if (tuomiot[i].huomioonOtettavatTuomiot.length > 1) {
                        tulosteHTML.push("<p>Rangaistusta alentavana on otettu huomioon "
                            + "seuraavat aiemmat vankeusrangaistukset:");
                    }

                    // käydään läpi kaikki huomioon otettavat tuomiot
                    for (let n = 0; n < tuomiot[i].huomioonOtettavatTuomiot.length; n++) {

                            tulosteHTML.push("<br />");

                            // ranskalainen viiva kunkin tuomion kohdalle rivin alkuun vain, jos tuomioita on useampia
                            if (tuomiot[i].huomioonOtettavatTuomiot.length > 1) {
                                tulosteHTML.push("&#8212; ");
                            }

                            // seuraava määritys on vain koodin luettavuuden parantamiseksi
                            let huomioonOtettavanTuomionNro = tuomiot[i].huomioonOtettavatTuomiot[n];

                            // tulostetaan huomioon otettavan tuomion nimi;
                            // argumentti 0 == true: mainitaan tarvittaessa, onko kyseessä riittävä seuraamus
                            // argumentti 1: tuomion (i) viimeinen päivämäärä, johon tulostus katkaistaan
                            // (jos tällä on vaikutusta, siitä tulostetaan jäljempänä huomautus)
                            // huom. tämä koskee vain lainvoimaisille tuomioille tehtäviä konkurrenssilausuntoja
                            if (tuomiot[i].lainvoimaisuus) {
                                tulosteHTML.push(tuomiot[huomioonOtettavanTuomionNro]
                                    .pitkaNimi(true, tuomiot[i].viimeinenPvm()));
                            } else {
                                tulosteHTML.push(tuomiot[huomioonOtettavanTuomionNro]
                                    .pitkaNimi(true));
                            }

                            // lisätään ilmoitus jälkituomiosta
                            if (huomioonOtettavanTuomionNro > i) {
                                tulosteHTML.push(" <span class='jalkituomio'>[jälkituomio]</span>");
                            }

                            // lainvoimaisessa tuomiossa huomioon otettavaa tuomiota on voinut koskea
                            // myöhempi muutoksenhaku; jos näin on, lisätään ilmoitus siitä
                            if (tuomiot[i].lainvoimaisuus && tuomiot[i].viimeinenPvm() <
                                tuomiot[huomioonOtettavanTuomionNro].viimeinenPvm()) {
                                tulosteHTML.push(" <span class='varoitus'>[huom. ko. tuomiossa muutoksenhaku "
                                    + pvmTekstiksi(tuomiot[i].viimeinenPvm()) + " jälkeen]</span>");
                            }

                    }

                    tulosteHTML.push(".</p>");

                }

            }

        }

        tulosteHTML.push("<hr />");

    }

    console.log("Rikosrekisterin tulostaminen valmis");

}

///////////////////////////////////////////////////////////////////////
// tulostaKonkurrenssiryhmat:
// funktio, joka tulostaa luettelon konkurrenssiryhmistä ja niihin liittyvistä tuomioista

function tulostaKonkurrenssiryhmat(tuomiot, rikosluettelo, konkurrenssiryhmat, tulosteHTML) {

    console.log("Konkurrenssiryhmien tulostaminen alkaa");

    tulosteHTML.push("<h2>Ehdottomat tuomiot ja niissä käsitellyt rikokset konkurrenssiryhmittäin</h2>");

    tulosteHTML.push("<table>");

    // käydään läpi kaikki konkurrenssiryhmät (i)
    for (let i = 0; i < konkurrenssiryhmat.length; i++) {

        // tulostetaan konkurrenssiryhmän otsikko ja päivämääräjakso (jos ryhmä I eli i = 0, vain loppupvm eli i:n pvm)
        tulosteHTML.push("<tr><th colspan='3'><b>");
        tulosteHTML.push("Konkurrenssiryhmä " + toRoman(i + 1) + "<br />");
        if (i == 0) {
            tulosteHTML.push("&#8594;");
            tulosteHTML.push(pvmTekstiksi(konkurrenssiryhmat[i].pvm));
        } else {
            // konkurrenssiryhmä alkaa edellisen konkurrenssiryhmän päättymispäivää seuraavasta päivästä
            let edellisenKonkurrenssiryhmanPvm = new Date(konkurrenssiryhmat[i - 1].pvm.getTime());
            edellisenKonkurrenssiryhmanPvm.setDate(edellisenKonkurrenssiryhmanPvm.getDate() + 1);
            tulosteHTML.push(ajanjaksoTekstiksi(edellisenKonkurrenssiryhmanPvm, konkurrenssiryhmat[i].pvm));
        }
        tulosteHTML.push("</b></th></tr>");

        // käydään läpi kaikki rikosrekisterin tuomiot (j)
        for (let j = 0; j < tuomiot.length; j++) {

            // tulostetaan tuomioista ne, joissa on ko. konkurrenssiryhmän (i) rikoksia
            if (tuomiot[j].konkurrenssiryhmat.indexOf(i) != -1) {

                tulosteHTML.push("<tr><td>");

                // tulostetaan sarake 1/3: tuomion tiedot

                tulosteHTML.push("<b>");

                // luodaan taulukko, jossa on eri oikeusasteiden tiedot
                let tuomionNimi = tuomiot[j].pidempiNimi();

                // tulostetaan eri oikeusasteiden tiedot taulukon elementistä [1] alkaen;
                // elementti [0] sisältää tiedon konkurrenssin kannalta ratkaisevan oikeusasteen
                // tuomiosta (alleviivataan); tuomion nimi katkaistaan rivinvaihdolla (<br />) ennen numeroa
                for (let k = 1; k < tuomionNimi.length; k++) {
                    if (k > 1) {
                        tulosteHTML.push("<br />");
                    }
                    if (k == tuomionNimi[0]) {
                        tulosteHTML.push("<u>");
                    }
                    tulosteHTML.push(tuomionNimi[k]
                        .replace(/ (\d\.)/, "<br />$1")
                        .replace(/ (\d\d\.)/, "<br />$1")
                        .replace(" no ", "&nbsp;no&nbsp;"));
                    if (k == tuomionNimi[0]) {
                        tulosteHTML.push("</u>");
                    }
                }

                tulosteHTML.push("</b>");

                if (tuomiot[j].konkurrenssiryhmanro == i || !tuomiot[j].lainvoimaisuus) {
                    tulosteHTML.push("<br /><i>(");
                }
                if (tuomiot[j].konkurrenssiryhmanro == i) {
                    tulosteHTML.push("katkaiseva tuomio");
                    if (!tuomiot[j].lainvoimaisuus) {
                        tulosteHTML.push(",<br />");
                    } else {
                        tulosteHTML.push(")</i>");
                    }
                }
                if (!tuomiot[j].lainvoimaisuus) {
                    tulosteHTML.push("<span class='eilainvoimainen'>ei lainvoimainen</span>)</i>");
                }

                tulosteHTML.push("</td><td>");

                // tulostetaan sarake 2/3: tuomion rikokset

                // käydään läpi kaikki tuomion (j) rikokset (k)
                for (let k = 0; k < tuomiot[j].rikokset.length; k++) {

                    // seuraava määrittely on vain koodin luettavuuden parantamiseksi
                    let rikos = rikosluettelo[tuomiot[j].rikokset[k]];

                    if (rikos.konkurrenssiryhmanro != i) {
                        tulosteHTML.push("<span class='erikonkurrenssi'>");
                    }

                    // tulostetaan rikoksen syytekohta ja nimike
                    tulosteHTML.push(rikos.syytekohta + "&nbsp;" + rikos.nimike);

                    // tulostetaan rikoksen tekoaika
                    let rikoksenPvmTiedot = rikos.tekoaikaTekstina();
                    if (rikoksenPvmTiedot[1] != "") {
                        tulosteHTML.push(", ");
                    } else {
                        tulosteHTML.push(" ");
                    }
                    tulosteHTML.push(rikoksenPvmTiedot[0]);
                    if (rikoksenPvmTiedot[1] != "") {
                        tulosteHTML.push(" <span class='konkurrenssitieto'>[=&nbsp;"
                            + rikoksenPvmTiedot[1] + "]</span>");
                    }

                    if (rikos.konkurrenssiryhmanro != i) {
                        tulosteHTML.push("</span>");
                    }

                    // tulostetaan tieto rikoksen konkurrenssiryhmästä, ellei kyse ole tulostettavaan
                    // konkurrenssiryhmään (i) kuuluvista rikoksista konkurrenssin katkaisevassa tuomiossa
                    if (rikos.konkurrenssiryhmanro != tuomiot[j].konkurrenssiryhmanro) {
                        tulosteHTML.push(" <i class='konkurrenssitieto'> (&#8594;&nbsp;"
                            + toRoman(rikos.konkurrenssiryhmanro + 1) + ")</i>");
                    } else if (rikos.konkurrenssiryhmanro != i) {
                        tulosteHTML.push(" <i class='konkurrenssitieto'> ("
                            + toRoman(rikos.konkurrenssiryhmanro + 1) + ")</i>");
                    }

                    if (k != tuomiot[j].rikokset.length - 1) {
                        tulosteHTML.push("<br />");
                    }

                }

                tulosteHTML.push("</td><td>");

                // tulostetaan sarake 3/3: rangaistus (tiivistettynä ja sitovilla välilyönneillä)

                tulosteHTML.push(tuomiot[j].rangaistus
                    .replace(" vankeutta", " vank.")
                    .replace(" v", "&nbsp;v")
                    .replace("v ", "v&nbsp;")
                    .replace(" kk", "&nbsp;kk")
                    .replace("kk ", "kk&nbsp;")
                    .replace(" pv", "&nbsp;pv")
                    .replace("pv ", "pv&nbsp;")
                    .replace(" h ", "&nbsp;h&nbsp;")
                    .replace("valvontarang.", "valv.rang.")
                    .replace(" &#8658;", "<br />&#8658;")
                    .replace("Riittävä seuraamus", "Riitt. seur."));

                tulosteHTML.push("</td></tr>");

            }

        }

    }

    tulosteHTML.push("</table>");

    console.log("Konkurrenssiryhmien tulostaminen valmis");

}

///////////////////////////////////////////////////////////////////////
// tulostaKonkurrenssikaavio:
// funktio, joka luo SVG-muotoisen konkurrenssikaavion eli "tikapuut"

function tulostaKonkurrenssikaavio(ehdottomatTuomiot, rikosluetteloEhdottomat, ehdollisetTuomiot,
    rikosluetteloEhdolliset, varillinenKaavio, tulosteHTML) {

    console.log("Konkurrenssikaavion tulostaminen alkaa");

    const varivalikoima = ["blue", "red", "olive", "orange", "gray", "purple", "teal"]; // konkurrenssiryhmien värit

    let kaavionKorkeus = 0; // kaavion korkeus pikseleinä, lasketaan myöhemmin
    const kaavionLeveys = 800; // kaavion leveys pikseleinä
    const pystymarginaali = 50; // kaavion pystysuuntainen marginaali pikseleinä

    let valiviivaPvm; // kaavion vaakaviivan pvm
    let valiviivaY = 0; // kaavion vaakaviivan sijainti (Y-koordinaatti)

    let alkupvmY = 0; // kaavion ensimmäinen pvm (Y-koordinaatti)
    let loppupvmY = 0; // kaavion viimeinen pvm (Y-koordinaatti)

    // luodaan taulukko, joka sisältää sekä ehdottomat että ehdolliset tuomiot päivämäärineen;
    // tämä on tarpeen, koska tuomiot vaikuttavat toistensa asetteluun;
    // kukin taulukon elementti on oma taulukkonsa, jossa on kolme elementtiä:
    // true/false (onko ehdoton tuomio); tuomion järjestysnumero ehdottomien/ehdollisten joukossa; tuomion pvm
    let kaikkiTuomiot = [];

    // lisätään ehdottomat tuomiot kaikkiTuomiot-taulukkoon
    for (let i = 0; i < ehdottomatTuomiot.length; i++) {
        kaikkiTuomiot.push([true, i, new Date(ehdottomatTuomiot[i].pvm.getTime())]);
    }

    // lisätään ehdolliset tuomiot kaikkiTuomiot-taulukkoon
    for (let i = 0; i < ehdollisetTuomiot.length; i++) {
        kaikkiTuomiot.push([false, i, new Date(ehdollisetTuomiot[i].pvm.getTime())]);
    }

    // lajitellaan kaikkiTuomiot-taulukko aikajärjestykseen
    kaikkiTuomiot.sort(function(a, b) {return a[2] - b[2]});

    // ajallisesti viimeisen tuomion pvm on myöhäisin kaaviossa näkyvä pvm
    // kaavio ei pääty seuraavan kk:n vaan sitä seuraavan kk:n alkuun
    valiviivaPvm = new Date(kaikkiTuomiot[kaikkiTuomiot.length - 1][2].getFullYear(),
        kaikkiTuomiot[kaikkiTuomiot.length - 1][2].getMonth() + 2, 1);

    // asetetaan em. ajankohta kaavion ylärajaksi
    loppupvmY = pvmY(valiviivaPvm);

    // siihen verrataan, kun etsitään seuraavaksi varhaisin kaaviossa näkyvä pvm
    alkupvmY = loppupvmY;

    // seuraavaksi etsitään ajallisesti varhaisin rikos, jonka pvm on varhaisin kaaviossa näkyvä pvm
    // ensin ehdottomien tuomioiden osalta
    for (let i = 0; i < rikosluetteloEhdottomat.length; i++) {
        if (pvmY(rikosluetteloEhdottomat[i].pvm) < alkupvmY) {
            // aloitetaan edellisen kuukauden alusta
            valiviivaPvm = new Date(rikosluetteloEhdottomat[i].pvm.getFullYear(),
                rikosluetteloEhdottomat[i].pvm.getMonth() - 1, 1);
            // kaavion vaakaviivan sijainti
            valiviivaY = pvmY(valiviivaPvm);
            // kaavion yläraja
            alkupvmY = valiviivaY;
        }
    }
    // sitten vastaavasti ehdollisten tuomioiden osalta
    for (let i = 0; i < rikosluetteloEhdolliset.length; i++) {
        if (pvmY(rikosluetteloEhdolliset[i].pvm) < alkupvmY) {
            // aloitetaan edellisen kuukauden alusta
            valiviivaPvm = new Date(rikosluetteloEhdolliset[i].pvm.getFullYear(),
                rikosluetteloEhdolliset[i].pvm.getMonth() - 1, 1);
            // kaavion vaakaviivan sijainti
            valiviivaY = pvmY(valiviivaPvm);
            // kaavion yläraja
            alkupvmY = valiviivaY;
        }
    }

    // lasketaan kaavion korkeus, johon lisätään vielä 50px ylimääräistä sen varalta, että tuomioiden tiedot eivät
    // muuten mahtuisi (jos lopussa on paljon "päällekkäisiä" eli ajallisesti lähekkäin olevia tuomioita)
    kaavionKorkeus = loppupvmY - alkupvmY + pystymarginaali * 2 + 50;

    // aloitetaan SVG-osio
    tulosteHTML.push("<p style='text-align:center'><svg width='" + kaavionLeveys
        + "' height='" + kaavionKorkeus + "'>");

    // lisätään kuukausien vaakaviivat ja kuukausinumerot

    while (valiviivaY <= loppupvmY) {

        // lisätään kuukauden vaakaviiva
        lisaaKaavioonViiva(tulosteHTML, 95, (valiviivaY - alkupvmY + pystymarginaali), 349,
            (valiviivaY - alkupvmY + pystymarginaali), "#d8d8d8", 1);

        // lisätään kuukausinumero
        lisaaKaavioonTekstinAloitus(tulosteHTML, 90, valiviivaY - alkupvmY + 2 + pystymarginaali,
            "middle", "end", "black");
        tulosteHTML.push(valiviivaPvm.getMonth() + 1); // kuukausi
        tulosteHTML.push("/"); // kauttaviiva
        tulosteHTML.push(valiviivaPvm.getFullYear()); // vuosi nelinumeroisena
        lisaaKaavioonTekstinLopetus(tulosteHTML);

        // siirrytään kuukaudella eteenpäin
        valiviivaPvm = new Date(valiviivaPvm.getFullYear(), valiviivaPvm.getMonth() + 1, 1);
        valiviivaY = pvmY(valiviivaPvm);

    }

    // vasen ja oikea reuna
    lisaaKaavioonViiva(tulosteHTML, 100, pystymarginaali, 100, (loppupvmY - alkupvmY + pystymarginaali), "black", 2);
    lisaaKaavioonViiva(tulosteHTML, 350, pystymarginaali, 350, (loppupvmY - alkupvmY + pystymarginaali), "black", 2);

    // ylä- ja alareuna
    lisaaKaavioonViiva(tulosteHTML, 100, pystymarginaali, 350, pystymarginaali, "black", 2);
    lisaaKaavioonViiva(tulosteHTML, 100, (loppupvmY - alkupvmY + pystymarginaali), 350,
        (loppupvmY - alkupvmY + pystymarginaali), "black", 2);

    // kaavion otsikko "Rikokset"
    lisaaKaavioonTekstinAloitus(tulosteHTML, 100, (pystymarginaali - 30),
        "auto", "middle", "black", "font-weight: bold");
    tulosteHTML.push("Rikokset");
    lisaaKaavioonTekstinLopetus(tulosteHTML);

    // kaavion otsikko "Tuomiot"
    lisaaKaavioonTekstinAloitus(tulosteHTML, 350, (pystymarginaali - 30),
        "auto", "middle", "black", "font-weight: bold");
    tulosteHTML.push("Tuomiot");
    lisaaKaavioonTekstinLopetus(tulosteHTML);

    // käydään ensin läpi kaikki ehdottomien tuomioiden rikokset ja piirretään niistä viivat tuomioihin

    for (let i = 0; i < rikosluetteloEhdottomat.length; i++) {

        let viivanVari = varivalikoima[rikosluetteloEhdottomat[i].konkurrenssiryhmanro % varivalikoima.length];
        let rikoksenY = pvmY(rikosluetteloEhdottomat[i].pvm) - alkupvmY + pystymarginaali;
        let tuomionY = pvmY(ehdottomatTuomiot[rikosluetteloEhdottomat[i].tuomionro].pvm) - alkupvmY + pystymarginaali;

        // piirretään jokaisesta rikoksesta viiva tuomioon, jossa se on tuomittu, ja lisätään rikoksen kohdalle ympyrä

        if (varillinenKaavio) {
            lisaaKaavioonViiva(tulosteHTML, 100, rikoksenY, 350, tuomionY, viivanVari, 2);
            lisaaKaavioonYmpyra(tulosteHTML, 100, rikoksenY, 3, "black", 1, viivanVari);
        } else {
            lisaaKaavioonViiva(tulosteHTML, 100, rikoksenY, 350, tuomionY, "black", 2);
            lisaaKaavioonYmpyra(tulosteHTML, 100, rikoksenY, 3, "black", 1, "black");
        }

    }

    // käydään sitten läpi kaikki ehdollisten tuomioiden rikokset ja piirretään niistä viivat tuomioihin

    for (let i = 0; i < rikosluetteloEhdolliset.length; i++) {

        let rikoksenY = pvmY(rikosluetteloEhdolliset[i].pvm) - alkupvmY + pystymarginaali;
        let tuomionY = pvmY(ehdollisetTuomiot[rikosluetteloEhdolliset[i].tuomionro].pvm) - alkupvmY + pystymarginaali;

        // piirretään jokaisesta rikoksesta viiva tuomioon, jossa se on tuomittu, ja lisätään rikoksen kohdalle ympyrä

        if (varillinenKaavio) {
            // katkoviiva, koska ehdollinen (2 viimeistä argumenttia)
            lisaaKaavioonViiva(tulosteHTML, 100, rikoksenY, 350, tuomionY, "#bbb", 2, "10, 10");
            lisaaKaavioonYmpyra(tulosteHTML, 100, rikoksenY, 3, "#888", 1, "#bbb");
        } else {
            // katkoviiva, koska ehdollinen (2 viimeistä argumenttia)
            lisaaKaavioonViiva(tulosteHTML, 100, rikoksenY, 350, tuomionY, "black", 2, "10, 10");
            lisaaKaavioonYmpyra(tulosteHTML, 100, rikoksenY, 3, "black", 1, "white");
        }

    }

    // käydään läpi kaikki tuomiot

    // tuomion ja tekstiselitteen y-koordinaatit vaihtuvat kaikkiTuomiot-silmukan kierrokselta toiselle
    // (tekstiselite voi olla tuomiota alempana, jos tuomiot ovat lähekkäin, jotta tekstiselitteet
    // eivät menisi päällekkäin)

    let vasenY = 0; // tuomion y-koordinaatti
    let oikeaY = 0; // tekstiselitteen y-koordinaatti

    for (let i = 0; i < kaikkiTuomiot.length; i++) {

        let tuomionvari = 0;

        // haetaan käsiteltävän tuomion tiedot kaikkiTuomiot-taulukosta

        // onko kyseessä ehdoton tuomio
        let tuomioOnEhdoton = kaikkiTuomiot[i][0];
        // viittaus tuomion nroon ehdottomatTuomiot- tai ehdollisetTuomiot-taulukossa
        let tuomionIndeksi = kaikkiTuomiot[i][1];

        let tuomionPvm = null;
        if (tuomioOnEhdoton) {
            tuomionPvm = new Date(ehdottomatTuomiot[tuomionIndeksi].pvm.getTime());
        } else {
            tuomionPvm = new Date(ehdollisetTuomiot[tuomionIndeksi].pvm.getTime());
        }

        if (tuomioOnEhdoton) {
            if (ehdottomatTuomiot[tuomionIndeksi].konkurrenssiryhmanro != null) {
                tuomionvari = varivalikoima[ehdottomatTuomiot[tuomionIndeksi].konkurrenssiryhmanro
                    % varivalikoima.length];
            }
        }

        // lasketaan ensin tuomion y-koordinaatti (vasenY) sekä tekstiselitteen y-koordinaatti (oikeaY),
        // joka voi olla tuomion y-koordinaattia alempana (jos tuomiot ovat lähekkäin)

        // lasketaan ko. rikoksen tuomion pvm:n y-koordinaatti
        vasenY = pvmY(tuomionPvm) - alkupvmY + pystymarginaali;

        // oikeaY on edelliseltä kierrokselta; verrataan siihen, jotta tiedetään mahtuuko teksti pystysuunnassa
        if (i > 0 && vasenY - oikeaY < 20) {
            // jos ei mahdu, otetaan riittävä etäisyys edelliseen
            oikeaY = oikeaY + 20;
        } else {
            // muutoin teksti voi olla samassa kohdassa
            oikeaY = vasenY;
        }

        // lisätään tuomion tekstiselite

        if (tuomioOnEhdoton) {

            // tuomion tekstiselite alkaa
            if (varillinenKaavio && ehdottomatTuomiot[tuomionIndeksi].konkurrenssiryhmanro == null) {
                // teksti mustalla, jos värillinen kaavio ja kyseessä ei ole konkurrenssin katkaiseva tuomio
                lisaaKaavioonTekstinAloitus(tulosteHTML, 380, (oikeaY + 4), "middle", "start", "black");
            } else {
                // teksti mustalla, jos mustavalkoinen kaavio
                lisaaKaavioonTekstinAloitus(tulosteHTML, 380, (oikeaY + 4), "middle", "start", "black");
            }

            tulosteHTML.push("<tspan>");

            // jos kyseessä on konkurrenssin katkaiseva tuomio, selitteen alussa on konkurrenssiryhmän numero
            // suluissa lihavoituna
            if (ehdottomatTuomiot[tuomionIndeksi].konkurrenssiryhmanro != null) {
                tulosteHTML.push("<tspan style='font-weight: bold'>");
                tulosteHTML.push("(" + toRoman(ehdottomatTuomiot[tuomionIndeksi].konkurrenssiryhmanro + 1) + ") ");
                tulosteHTML.push("</tspan>");
            }

            tulosteHTML.push(ehdottomatTuomiot[tuomionIndeksi].lyhyinNimi());

            // selitteeseen merkitään punaisella, jos tuomio on lainvoimaa vailla
            if (!ehdottomatTuomiot[tuomionIndeksi].lainvoimaisuus) {
                tulosteHTML.push(" <tspan style='fill: red'>(ei lainv.)</tspan>");
            }

            tulosteHTML.push("</tspan>");

            // tuomion tekstiselite päättyy
            lisaaKaavioonTekstinLopetus(tulosteHTML);

        } else {

            // jos kyseessä ehdollinen

            // tuomion tekstiselite alkaa
            if (varillinenKaavio) {
                // teksti harmaalla, jos värillinen kaavio
                lisaaKaavioonTekstinAloitus(tulosteHTML, 380, (oikeaY + 4), "middle", "start", "#777");
            } else {
                // teksti mustalla, jos mustavalkoinen kaavio
                lisaaKaavioonTekstinAloitus(tulosteHTML, 380, (oikeaY + 4), "middle", "start", "black");
            }

            // ehdolliset kursivoituna
            tulosteHTML.push("<tspan style='font-style: italic'>");
            tulosteHTML.push(ehdollisetTuomiot[tuomionIndeksi].lyhyinNimi());
            if (ehdollisetTuomiot[tuomionIndeksi].rangaistus.toLowerCase().indexOf("nuorisorangaistu") != -1 ||
                ehdollisetTuomiot[tuomionIndeksi].rangaistus.toLowerCase().indexOf("nuorisopalvelu") != -1) {
                tulosteHTML.push(" (nuorisorang.");
            } else {
                tulosteHTML.push(" (ehdoll.");
            }
            if (!ehdollisetTuomiot[tuomionIndeksi].lainvoimaisuus) {
                tulosteHTML.push(", <tspan style='fill: red'>ei lainv.</tspan>");
            }
            tulosteHTML.push(")</tspan>");

            // tuomion tekstiselite päättyy
            lisaaKaavioonTekstinLopetus(tulosteHTML);

        }

        // piirretään lyhyt viiva tuomiosta tuomion tekstiselitteeseen

        if (tuomioOnEhdoton) {
            if (varillinenKaavio) {
                if (ehdottomatTuomiot[tuomionIndeksi].konkurrenssiryhmanro == null) {
                    lisaaKaavioonViiva(tulosteHTML, 350, vasenY, 375, oikeaY, "#999", 1);
                } else {
                    lisaaKaavioonViiva(tulosteHTML, 350, vasenY, 375, oikeaY, tuomionvari, 1);
                }
            } else {
                lisaaKaavioonViiva(tulosteHTML, 350, vasenY, 375, oikeaY, "black", 1);
            }
        } else { // jos kyseessä ehdollinen
            if (varillinenKaavio) {
                lisaaKaavioonViiva(tulosteHTML, 350, vasenY, 375, oikeaY, "#999", 1);
            } else {
                lisaaKaavioonViiva(tulosteHTML, 350, vasenY, 375, oikeaY, "black", 1);
            }
        }

        // ohut vaakaviiva kaavioon konkurrenssin katkaisevan ehdottoman tuomion kohdalle

        if (tuomioOnEhdoton) {
            if (varillinenKaavio) {
                if (ehdottomatTuomiot[tuomionIndeksi].konkurrenssiryhmanro != null) {
                    lisaaKaavioonViiva(tulosteHTML, 100, vasenY, 350, vasenY, tuomionvari, 1);
                }
            } else {
                if (ehdottomatTuomiot[tuomionIndeksi].konkurrenssiryhmanro != null) {
                    lisaaKaavioonViiva(tulosteHTML, 100, vasenY, 350, vasenY, "black", 1);
                }
            }
        }

        // lisätään tuomion kohdalle ympyrä

        if (tuomioOnEhdoton) {
            if (varillinenKaavio) {
                if (ehdottomatTuomiot[tuomionIndeksi].konkurrenssiryhmanro != null) {
                    lisaaKaavioonYmpyra(tulosteHTML, 350, vasenY, 3, "black", 1, tuomionvari);
                } else {
                    lisaaKaavioonYmpyra(tulosteHTML, 350, vasenY, 3, "#888", 1, "#888");
                }
            } else {
                if (ehdottomatTuomiot[tuomionIndeksi].konkurrenssiryhmanro != null) {
                    lisaaKaavioonYmpyra(tulosteHTML, 350, vasenY, 3, "black", 1, "black");
                } else {
                    lisaaKaavioonYmpyra(tulosteHTML, 350, vasenY, 3, "black", 1, "white");
                }
            }
        } else { // jos kyseessä ehdollinen
            if (varillinenKaavio) {
                lisaaKaavioonYmpyra(tulosteHTML, 350, vasenY, 3, "#888", 1, "#bbb");
            } else {
                lisaaKaavioonYmpyra(tulosteHTML, 350, vasenY, 3, "black", 1, "white");
            }
        }

    }

    // lopetetaan SVG-osio

    tulosteHTML.push("</svg></p>");

    console.log("Konkurrenssikaavion tulostaminen valmis");

}

///////////////////////////////////////////////////////////////////////
// pvmY:
// funktio, joka muuttaa päivämäärän konkurrenssikaavion mittakaavaan (y-koordinaatin osaksi, 1 vrk = 1 pikseli)

function pvmY(pvm) {
    // vastaus saadaan jakamalla rikoksen/tuomion pvm (.getTime) vuorokauden pituudella,
    // joka on millisekunteina 1000 * 60 * 60 * 24
    return Math.round(pvm.getTime() / (1000 * 60 * 60 * 24));
}

///////////////////////////////////////////////////////////////////////
// lisaaKaavioonViiva:
// funktio, joka lisää SVG-muotoiseen konkurrenssikaavioon viivan

function lisaaKaavioonViiva(tulosteHTML, x1, y1, x2, y2, stroke, strokewidth, strokedasharray) {
    tulosteHTML.push("<line x1='" + x1);
    tulosteHTML.push("' y1='" + y1);
    tulosteHTML.push("' x2='" + x2);
    tulosteHTML.push("' y2='" + y2);
    tulosteHTML.push("' style='stroke: " + stroke);
    tulosteHTML.push("; stroke-width: " + strokewidth);
    if (strokedasharray != undefined) {
        tulosteHTML.push("; stroke-dasharray: " + strokedasharray);        
    }
    tulosteHTML.push("' />");
}

///////////////////////////////////////////////////////////////////////
// lisaaKaavioonYmpyra:
// funktio, joka lisää SVG-muotoiseen konkurrenssikaavioon ympyrän

function lisaaKaavioonYmpyra(tulosteHTML, x, y, r, stroke, strokewidth, fill) {
    tulosteHTML.push("<circle cx='" + x);
    tulosteHTML.push("' cy='" + y);
    tulosteHTML.push("' r='" + r);
    tulosteHTML.push("' stroke='" + stroke);
    tulosteHTML.push("' stroke-width='" + strokewidth);
    tulosteHTML.push("' fill='" + fill);
    tulosteHTML.push("' />");
}

///////////////////////////////////////////////////////////////////////
// lisaaKaavioonTekstinAloitus:
// funktio, joka lisää SVG-muotoiseen konkurrenssikaavioon tekstin aloituksen

function lisaaKaavioonTekstinAloitus(tulosteHTML, x, y, alignmentbaseline, textanchor, fill, style) {
    tulosteHTML.push("<text x='" + x);
    tulosteHTML.push("' y='" + y);
    tulosteHTML.push("' alignment-baseline='" + alignmentbaseline);
    tulosteHTML.push("' text-anchor='" + textanchor);
    tulosteHTML.push("' fill='" + fill);
    tulosteHTML.push("' style='" + style);
    tulosteHTML.push("'>");
}

///////////////////////////////////////////////////////////////////////
// lisaaKaavioonTekstinLopetus:
// funktio, joka lisää SVG-muotoiseen konkurrenssikaavioon tekstin lopetuksen

function lisaaKaavioonTekstinLopetus(tulosteHTML) {
    tulosteHTML.push("</text>");
}

///////////////////////////////////////////////////////////////////////
// luePdfRikosrekisteriote:
// funktio, joka lukee pdf-muotoisen rikosrekisteriotteen sisällön (rikosrekisteriote) ja tallentaa siitä löydetyt
// tuomiot ja rikokset neljään taulukkoon (ehdottomatTuomiot, rikosluetteloEhdottomat, ehdollisetTuomiot ja
// rikosluetteloEhdolliset); lisäksi tiedot rikosrekisterikyselyn tekijästä ja ajankohdasta tallennetaan
// kyselytiedot-taulukkoon; luentaan liittyvät varoitukset tallennetaan varoitukset-taulukkoon;
// jos debug == true, luentaa koskevista debug-tiedoista laaditaan erillinen tuloste (debugHTML)

function luePdfRikosrekisteriote(rikosrekisteriote, ehdottomatTuomiot, rikosluetteloEhdottomat, ehdollisetTuomiot,
    rikosluetteloEhdolliset, kyselytiedot, varoitukset, debug, debugHTML) {

    console.log("Pdf-muotoisen rikosrekisterin luenta alkaa");

    if (debug) {
        let nyt = ajankohtaTekstiksi(new Date());
        debugHTML.push("<!DOCTYPE html><html><head><title>Rikosrekisterin luentatiedot " + nyt + "</title>"
            + csspohja + "</head><body>");
        debugHTML.push("<h1>Rikosrekisterin luentatiedot</h1>");
    }

    // luettelo RL 7:9:n mukaisista valtioista tai niiden lyhenteistä (käytetään ulkomaisten tuomioiden tunnistamiseen)
    const ulkomaat = ["Itäval", "Belgia", "Bulgaria", "Kroatia", "Kypro", "Tsekin", "Tsekki", "Tanska", "Viro",
        "Ranska", "Saksa", "Kreikka", "Kreika", "Helleeni", "Unkari", "Irlan", "Italia", "Latvia", "Liettua",
        "Luxemburg", "Malta", "Alankoma", "Hollan", "Puola", "Portugal", "Romania", "Slovakia", "Slovenia",
        "Espanja", "Ruotsi", "Kuningaskun", "Englan", "Wales", "Skotlan", "Islan", "Norja",
        "(AT)", "(AUT)", "(BE)", "(BEL)", "(BG)", "(BGR)", "(HR)", "(HRV)", "(CY)", "(CYP)", "(CZ)", "(CZE)", "(DK)",
        "(DNK)", "(EE)", "(EST)", "(FR)", "(FRA)", "(DE)", "(DEU)", "(GR)", "(GRC)", "(HU)", "(HUN)", "(IE)", "(IRL)",
        "(IT)", "(ITA)", "(LV)", "(LVA)", "(LT)", "(LTU)", "(LU)", "(LUX)", "(MT)", "(MLT)", "(NL)", "(NLD)", "(PL)",
        "(POL)", "(RO)", "(ROU)", "(SK)", "(SVK)", "(SI)", "(SVN)", "(ES)", "(ESP)", "(SE)", "(SWE)", "(GB)", "(GBR)",
        "(IS)", "(ISL)", "(NO)", "(NOR)"];

    // luettelo tulkinnanvaraisista tekoajoista, jotka pyritään muuntamaan täsmällisiksi päivämääriksi;
    // taulukossa on ensin 2 merkkijonoa (esim. "kesän" + 2006 + "alkupuoli") ja sitä vastaavat 2 numeroa (pv, kk)
    const ajankohdat = [
        "kesä", "", "15", "7",
        "talvi", "", "15", "1",
        "syksy", "", "15", "10",
        "kevät", "", "15", "4",
        "syystalvi", "", "30", "11",
        "syyskesä", "", "1", "9",
        "kevätkesä", "", "31", "5",
        "kevättalvi", "", "1", "3",
        "alkuvuosi", "", "1", "1",
        "loppuvuosi", "", "31", "12",
        "alkukesä", "", "1", "6",
        "loppukesä", "", "31", "8",
        "alkutalvi", "", "1", "12",
        "lopputalvi", "", "28", "2",
        "alkusyksy", "", "1", "9",
        "loppusyksy", "", "30", "11",
        "alkukevät", "", "1", "3",
        "loppukevät", "", "31", "5",
        "keskikesä", "", "1", "7",
        "joulu", "", "25", "12",
        "juhannus", "", "25", "6",
        "tammikuu", "", "15", "1",
        "tammikuun alku", "", "1", "1",
        "tammikuun alun", "", "1", "1",
        "tammikuun alkupuoli", "", "1", "1",
        "tammikuun alkupuolen", "", "1", "1",
        "tammikuun loppu", "", "31", "1",
        "tammikuun lopulla", "", "31", "1",
        "tammikuun lopussa", "", "31", "1",
        "tammikuun lopun", "", "31", "1",
        "tammikuun loppupuoli", "", "31", "1",
        "tammikuun loppupuolen", "", "31", "1",
        "tammikuun puoliväli", "", "15", "1",
        "tammikuun puolivälin", "", "15", "1",
        "tammikuuhun", "", "15", "1",
        "tammikuulle", "", "15", "1",
        "tammikuun", "alku", "1", "1",
        "tammikuun", "alun", "1", "1",
        "tammikuun", "alkupuol", "1", "1",
        "tammikuun", "lop", "31", "1",
        "tammikuun", "puoliväli", "15", "1",
        "helmikuu", "", "15", "2",
        "helmikuun alku", "", "1", "2",
        "helmikuun alun", "", "1", "2",
        "helmikuun alkupuoli", "", "1", "2",
        "helmikuun alkupuolen", "", "1", "2",
        "helmikuun loppu", "", "28", "2",
        "helmikuun lopulla", "", "28", "2",
        "helmikuun lopussa", "", "28", "2",
        "helmikuun lopun", "", "28", "2",
        "helmikuun loppupuoli", "", "28", "2",
        "helmikuun loppupuolen", "", "28", "2",
        "helmikuun puoliväli", "", "15", "2",
        "helmikuun puolivälin", "", "15", "2",
        "helmikuuhun", "", "15", "2",
        "helmikuulle", "", "15", "2",
        "helmikuun", "alku", "1", "2",
        "helmikuun", "alun", "1", "2",
        "helmikuun", "alkupuol", "1", "2",
        "helmikuun", "lop", "28", "2",
        "helmikuun", "puoliväli", "15", "2",
        "maaliskuu", "", "15", "3",
        "maaliskuun alku", "", "1", "3",
        "maaliskuun alun", "", "1", "3",
        "maaliskuun alkupuoli", "", "1", "3",
        "maaliskuun alkupuolen", "", "1", "3",
        "maaliskuun loppu", "", "31", "3",
        "maaliskuun lopulla", "", "31", "3",
        "maaliskuun lopussa", "", "31", "3",
        "maaliskuun lopun", "", "31", "3",
        "maaliskuun loppupuoli", "", "31", "3",
        "maaliskuun loppupuolen", "", "31", "3",
        "maaliskuun puoliväli", "", "15", "3",
        "maaliskuun puolivälin", "", "15", "3",
        "maaliskuuhun", "", "15", "3",
        "maaliskuulle", "", "15", "3",
        "maaliskuun", "alku", "1", "3",
        "maaliskuun", "alun", "1", "3",
        "maaliskuun", "alkupuol", "1", "3",
        "maaliskuun", "lop", "31", "3",
        "maaliskuun", "puoliväli", "15", "3",
        "huhtikuu", "", "15", "4",
        "huhtikuun alku", "", "1", "4",
        "huhtikuun alun", "", "1", "4",
        "huhtikuun alkupuoli", "", "1", "4",
        "huhtikuun alkupuolen", "", "1", "4",
        "huhtikuun loppu", "", "30", "4",
        "huhtikuun lopulla", "", "30", "4",
        "huhtikuun lopussa", "", "30", "4",
        "huhtikuun lopun", "", "30", "4",
        "huhtikuun loppupuoli", "", "30", "4",
        "huhtikuun loppupuolen", "", "30", "4",
        "huhtikuun puoliväli", "", "15", "4",
        "huhtikuun puolivälin", "", "15", "4",
        "huhtikuuhun", "", "15", "4",
        "huhtikuulle", "", "15", "4",
        "huhtikuun", "alku", "1", "4",
        "huhtikuun", "alun", "1", "4",
        "huhtikuun", "alkupuol", "1", "4",
        "huhtikuun", "lop", "30", "4",
        "huhtikuun", "puoliväli", "15", "4",
        "toukokuu", "", "15", "5",
        "toukokuun alku", "", "1", "5",
        "toukokuun alun", "", "1", "5",
        "toukokuun alkupuoli", "", "1", "5",
        "toukokuun alkupuolen", "", "1", "5",
        "toukokuun loppu", "", "31", "5",
        "toukokuun lopulla", "", "31", "5",
        "toukokuun lopussa", "", "31", "5",
        "toukokuun lopun", "", "31", "5",
        "toukokuun loppupuoli", "", "31", "5",
        "toukokuun loppupuolen", "", "31", "5",
        "toukokuun puoliväli", "", "15", "5",
        "toukokuun puolivälin", "", "15", "5",
        "toukokuuhun", "", "15", "5",
        "toukokuulle", "", "15", "5",
        "toukokuun", "alku", "1", "5",
        "toukokuun", "alun", "1", "5",
        "toukokuun", "alkupuol", "1", "5",
        "toukokuun", "lop", "31", "5",
        "toukokuun", "puoliväli", "15", "5",
        "kesäkuu", "", "15", "6",
        "kesäkuun alku", "", "1", "6",
        "kesäkuun alun", "", "1", "6",
        "kesäkuun alkupuoli", "", "1", "6",
        "kesäkuun alkupuolen", "", "1", "6",
        "kesäkuun loppu", "", "30", "6",
        "kesäkuun lopulla", "", "30", "6",
        "kesäkuun lopussa", "", "30", "6",
        "kesäkuun lopun", "", "30", "6",
        "kesäkuun loppupuoli", "", "30", "6",
        "kesäkuun loppupuolen", "", "30", "6",
        "kesäkuun puoliväli", "", "15", "6",
        "kesäkuun puolivälin", "", "15", "6",
        "kesäkuuhun", "", "15", "6",
        "kesäkuulle", "", "15", "6",
        "kesäkuun", "alku", "1", "6",
        "kesäkuun", "alun", "1", "6",
        "kesäkuun", "alkupuol", "1", "6",
        "kesäkuun", "lop", "30", "6",
        "kesäkuun", "puoliväli", "15", "6",
        "heinäkuu", "", "15", "7",
        "heinäkuun alku", "", "1", "7",
        "heinäkuun alun", "", "1", "7",
        "heinäkuun alkupuoli", "", "1", "7",
        "heinäkuun alkupuolen", "", "1", "7",
        "heinäkuun loppu", "", "31", "7",
        "heinäkuun lopulla", "", "31", "7",
        "heinäkuun lopussa", "", "31", "7",
        "heinäkuun lopun", "", "31", "7",
        "heinäkuun loppupuoli", "", "31", "7",
        "heinäkuun loppupuolen", "", "31", "7",
        "heinäkuun puoliväli", "", "15", "7",
        "heinäkuun puolivälin", "", "15", "7",
        "heinäkuuhun", "", "15", "7",
        "heinäkuulle", "", "15", "7",
        "heinäkuun", "alku", "1", "7",
        "heinäkuun", "alun", "1", "7",
        "heinäkuun", "alkupuol", "1", "7",
        "heinäkuun", "lop", "31", "7",
        "heinäkuun", "puoliväli", "15", "7",
        "elokuu", "", "15", "8",
        "elokuun alku", "", "1", "8",
        "elokuun alun", "", "1", "8",
        "elokuun alkupuoli", "", "1", "8",
        "elokuun alkupuolen", "", "1", "8",
        "elokuun loppu", "", "31", "8",
        "elokuun lopulla", "", "31", "8",
        "elokuun lopussa", "", "31", "8",
        "elokuun lopun", "", "31", "8",
        "elokuun loppupuoli", "", "31", "8",
        "elokuun loppupuolen", "", "31", "8",
        "elokuun puoliväli", "", "15", "8",
        "elokuun puolivälin", "", "15", "8",
        "elokuuhun", "", "15", "8",
        "elokuulle", "", "15", "8",
        "elokuun", "alku", "1", "8",
        "elokuun", "alun", "1", "8",
        "elokuun", "alkupuol", "1", "8",
        "elokuun", "lop", "31", "8",
        "elokuun", "puoliväli", "15", "8",
        "syyskuu", "", "15", "9",
        "syyskuun alku", "", "1", "9",
        "syyskuun alun", "", "1", "9",
        "syyskuun alkupuoli", "", "1", "9",
        "syyskuun alkupuolen", "", "1", "9",
        "syyskuun loppu", "", "30", "9",
        "syyskuun lopulla", "", "30", "9",
        "syyskuun lopussa", "", "30", "9",
        "syyskuun loppu", "", "30", "9",
        "syyskuun loppupuoli", "", "30", "9",
        "syyskuun loppupuolen", "", "30", "9",
        "syyskuun puoliväli", "", "15", "9",
        "syyskuun puolivälin", "", "15", "9",
        "syyskuuhun", "", "15", "9",
        "syyskuulle", "", "15", "9",
        "syyskuun", "alku", "1", "9",
        "syyskuun", "alun", "1", "9",
        "syyskuun", "alkupuol", "1", "9",
        "syyskuun", "lop", "30", "9",
        "syyskuun", "puoliväli", "15", "9",
        "lokakuu", "", "15", "10",
        "lokakuun alku", "", "1", "10",
        "lokakuun alun", "", "1", "10",
        "lokakuun alkupuoli", "", "1", "10",
        "lokakuun alkupuolen", "", "1", "10",
        "lokakuun loppu", "", "31", "10",
        "lokakuun lopulla", "", "31", "10",
        "lokakuun lopussa", "", "31", "10",
        "lokakuun lopun", "", "31", "10",
        "lokakuun loppupuoli", "", "31", "10",
        "lokakuun loppupuolen", "", "31", "10",
        "lokakuun puoliväli", "", "15", "10",
        "lokakuun puolivälin", "", "15", "10",
        "lokakuuhun", "", "15", "10",
        "lokakuulle", "", "15", "10",
        "lokakuun", "alku", "1", "10",
        "lokakuun", "alun", "1", "10",
        "lokakuun", "alkupuol", "1", "10",
        "lokakuun", "lop", "31", "10",
        "lokakuun", "puoliväli", "15", "10",
        "marraskuu", "", "15", "11",
        "marraskuun alku", "", "1", "11",
        "marraskuun alun", "", "1", "11",
        "marraskuun alkupuoli", "", "1", "11",
        "marraskuun alkupuolen", "", "1", "11",
        "marraskuun loppu", "", "30", "11",
        "marraskuun lopulla", "", "30", "11",
        "marraskuun lopussa", "", "30", "11",
        "marraskuun lopun", "", "30", "11",
        "marraskuun loppupuoli", "", "30", "11",
        "marraskuun loppupuolen", "", "30", "11",
        "marraskuun puoliväli", "", "15", "11",
        "marraskuun puolivälin", "", "15", "11",
        "marraskuuhun", "", "15", "11",
        "marraskuulle", "", "15", "11",
        "marraskuun", "alku", "1", "11",
        "marraskuun", "alun", "1", "11",
        "marraskuun", "alkupuol", "1", "11",
        "marraskuun", "lop", "30", "11",
        "marraskuun", "puoliväli", "15", "11",
        "joulukuu", "", "15", "12",
        "joulukuun alku", "", "1", "12",
        "joulukuun alun", "", "1", "12",
        "joulukuun alkupuoli", "", "1", "12",
        "joulukuun alkupuolen", "", "1", "12",
        "joulukuun loppu", "", "31", "12",
        "joulukuun lopulla", "", "31", "12",
        "joulukuun lopussa", "", "31", "12",
        "joulukuun lopun", "", "31", "12",
        "joulukuun loppupuoli", "", "31", "12",
        "joulukuun loppupuolen", "", "31", "12",
        "joulukuun puoliväli", "", "15", "12",
        "joulukuun puolivälin", "", "15", "12",
        "joulukuuhun", "", "15", "12",
        "joulukuulle", "", "15", "12",
        "joulukuun", "alku", "1", "12",
        "joulukuun", "alun", "1", "12",
        "joulukuun", "alkupuol", "1", "12",
        "joulukuun", "lop", "31", "12",
        "joulukuun", "puoliväli", "15", "12"];

    // poistettavat rivit, joissa on turhaa tietoa tai sivunumero (tehdään kunkin tuomiojakson kohdalla)
    const poistettavat = ["Kyselijä", "Kyselyn käyttötarkoitus", "Sukunimi", "Etunimet", "Henkilötunnus",
        "Kansalaisuus", "OIKEUSREKISTERIKESKUS", "Vanajantie", "13101 HÄMEENLINNA", "Rikosrekisterilaki 3",
        "RIKOSREKISTERIOTE", " klo ", "osaote sisältää"];
    const sivunro = /\d+\s\(\d+\)/;

    // aloitetaan rikosrekisteriotteen luenta

    // stilisoidaan otetta:
    // - korvataan rivinvaihdot katkaisumerkillä ja poistetaan "rivien" alusta ja lopusta tyhjät merkit
    // - poistetaan peräkkäiset katkaisumerkit (2 kpl => 0 kpl)
    // - muunnetaan peräkkäiset tyhjät merkit yksittäisiksi välilyönneiksi
    rikosrekisteriote = rikosrekisteriote
        .replace(/(\r\n|\n|\r)/gm, "&#8212;").replace(/\s*\&#8212;\s*/g, "&#8212;")
        .replace("&#8212;&#8212;", "")
        .replace(/ +/g, " ");

    // luodaan tuomiojaksot-taulukko, joista kukin sisältää enintään yhden tuomion, jakamalla rikosrekisteriote
    // merkkijonoiksi sanan "Tuomio" ja sitä seuraavan katkaisumerkin kohdalta
    let tuomiojaksot = rikosrekisteriote.split(/Tuomio\&#8212;/);

    // laskurit ehdottomille ja ehdollisille tuomioille
    let tuomiolaskuriEhdottomat = 0;
    let tuomiolaskuriEhdolliset = 0;

    // käydään läpi kukin tuomiojakso rivi riviltä (silmukka i)

    for (let i = 0; i < tuomiojaksot.length; i++) {

        if (debug) debugHTML.push("<hr /><hr /><b>TUOMIO</b><br />");

        let tila = 0;
        let edellinenTila = 0;

        // tila-muuttuja määrittää, missä tilassa tuomion läpikäynti on
        // (edellinenTila on edelliseltä kierrokselta):
        // 0: tuomion 1 tietojen lukeminen
        // 1: rikostietojen lukeminen
        // 2: rangaistustietojen lukeminen
        // 3: tuomion 2 tai rikostietojen lukeminen
        // 4: tuomion 3 tai rikostietojen lukeminen

        let laji = 0;
        let edellinenLaji = -1;

        // laji-muuttuja määrittää, mikä on läpikäytävän rivin laji
        // (edellinenLaji on edelliseltä kierrokselta):
        // -1: nyt käsiteltävä rivi on ensimmäinen
        // 0: tunnistamaton
        // 1: tuomion pvm, aina ensimmäisenä (tuomio 1)
        // 2: tuomioistuin ja lainvoimaisuus, seuraa aina 0:aa (tuomio 1)
        // 3: ratkaisunro, seuraa aina 1:ä
        // 4: syytekohta ja rikosnimike, seuraa aina 2:a
        // 5: rikoksen pvm, seuraa aina 3:a
        // 6: "Yhteinen rangaistus" / "Syyksi luetut rikokset" tms.
        // 7: vankeuden määrä, "vankeutta"
        // 8: "on riittävä seuraamus"
        // 9: "Vankeusrangaistus on ehdollinen"
        // 10: "... oli alioikeudessa ehdollinen"
        // 11: "Suoritustiedot" = seuraava rivi on pvm, joka on jätettävä huomiotta
        // 12: tuomion pvm ja tuomioistuin (tuomio 2)
        // 13: tuomion pvm ja tuomioistuin (tuomio 3)
        // 14: ratkaisunro (tuomio 2)
        // 15: ratkaisunro (tuomio 3)
        // 16: "sijasta yhdyskuntapalvelua" ___ tuntia
        // 17: valvontarangaistus
        // 18: nuorisorangaistus
        // 19: ykp:n tms. muuntotuomio

        // uusi, "tyhjä" tuomio
        let uusiTuomio = new Tuomio(new Date(0), "", 0, "", true);

        // muuttujat, joihin tallennetaan eri oikeusasteiden (enintään 3) tuomioiden tiedot
        let pvm1 = new Date(0);
        let pvm2 = new Date(0);
        let pvm3 = new Date(0);
        let tuomioistuin1 = "";
        let tuomioistuin2 = "";
        let tuomioistuin3 = "";
        let ratkaisunro1 = null;
        let ratkaisunro2 = null;
        let ratkaisunro3 = null;

        // tieto siitä, onko konkurrenssin kannalta ratkaiseva oikeusaste 1, 2 vai 3
        let katkaisevaTuomio = 1;

        // uusi, "tyhjä" rikos
        let uusiRikos = new Rikos(new Date(0), "", "", 0, 0, false, new Date(0))

        // taulukko, johon tuomiosta löydetyt rikokset kerätään
        let lisattavatRikokset = [];

        // onko tuomion tiedot tunnistettu?
        let tuomionTiedotTunnistettu = false;

        // onko rikoksen syytekohta ja nimike tunnistettu?
        let syytekohtaJaNimikeTunnistettu = false;

        // onko ehdoton (tai riittävä seuraamus)?
        let huomioonotettava = false;

        // onko ehdollinen (tai nuorisorangaistus)?
        let ehdollinen = false;

        // onko nuorisorangaistus?
        let nuorisorangaistus = false;

        // onko kokonaan sivuutettava (esim. ykp-muunto)?
        let sivuutettava = false;

        // katkaistaan tuomion tietojen lukeminen viimeistään sanaan "tuomiotiedot"
        let valmis = false;

        // katkaistaan tutkittavana oleva tuomiojakso yksittäisiksi riveiksi katkaisumerkin kohdalta
        let tuomiojaksonRivit = tuomiojaksot[i].split("&#8212;");

        // ennen kuin tuomiojaksosta etsitään tuomiot ja rikokset, poistetaan tarpeettomat rivit
        // (poistettavat- ja sivunro-muuttujat määritelty yllä) (otetaan samalla talteen tieto
        // rikosrekisterikyselyn tekijästä ja ajankohdasta, jos tällaiset tiedot tulevat vastaan)

        for (let j = 0; j < tuomiojaksonRivit.length; j++) {

            if (kyselytiedot[0] == "") {
                if (tuomiojaksonRivit[j].indexOf("Kyselijä: ") != -1) {
                    kyselytiedot[0] = tuomiojaksonRivit[j].split("Kyselijä: ")[1];
                }
            }

            if (kyselytiedot[1] == "") {
                if (tuomiojaksonRivit[j].indexOf(" klo ") != -1) {
                    kyselytiedot[1] = tuomiojaksonRivit[j];
                }
            }

            for (let k = 0; k < poistettavat.length; k++) {
                if ((tuomiojaksonRivit[j].indexOf(poistettavat[k]) != -1) || (sivunro.test(tuomiojaksonRivit[j]))) {
                    tuomiojaksonRivit.splice(j, 1);
                    // jos on poistettu tarpeeton rivi, niin korjataan j-laskuria vastaavasti ja siirrytään eteenpäin
                    j--;
                    break;
                }
            }
        }

        // käydään tuomion alla oleva jokainen rivi läpi
        for (let j = 0; j < tuomiojaksonRivit.length; j++) {

            // tuomion laji on 0 eli tunnistamaton, jos muuta ei havaita
            laji = 0;

            // ulkomainen tuomio?

            for (let k = 0; k < ulkomaat.length; k++) {
                if (tuomiojaksonRivit[j].indexOf(ulkomaat[k]) != -1) {
                    varoitukset.push("Ote saattaa sisältää ulkomaisen tuomion: &#8221;<i>"
                        + tuomiojaksonRivit[j].replace(" Lainvoimainen", "").replace(" Ei lainvoimainen", "")
                        + "</i>&#8221;.");
                }
            }

            // ruotsinkielinen tuomio?

            if (tuomiojaksonRivit[j].indexOf("agakraft") != -1 ||
                tuomiojaksonRivit[j].indexOf("aga kraft") != -1 ||
                tuomiojaksonRivit[j].indexOf("erkställbar") != -1) {
                let teksti = "Ote saattaa sisältää tuomion, jonka tiedot ovat ruotsiksi. Tarkista, onko asia näin. "
                    + "Ruotsinkielisten tuomioiden tietoja kone ei pysty lukemaan. Tämä ilmoitus perustuu seuraavaan "
                    + "kohtaan rikosrekisteriotteessa:<br />";
                if (j > 0) {
                    teksti += "<i>" + tuomiojaksonRivit[j - 1] + "</i> ";
                }
                teksti += "<i>" + tuomiojaksonRivit[j] + "</i>";
                varoitukset.push(teksti);
            }
            
            // päivämäärän tunnistus: pp.kk.vvvv

            if ((/([0-9]{2}).([0-9]{2}).([0-9]{4})/.test(tuomiojaksonRivit[j].substr(0, 10))) && // nn.nn.nnnn
                ((tuomiojaksonRivit[j].substr(0,2) > 0) && (tuomiojaksonRivit[j].substr(0,2) < 32) && // pvm 1-31
                (tuomiojaksonRivit[j].substr(3,2) > 0) && (tuomiojaksonRivit[j].substr(3,2) < 13) && // kk 1-12
                (tuomiojaksonRivit[j].substr(6,4) > 1950) && (tuomiojaksonRivit[j].substr(6,4) < 2100)) && // v 50-99
                // ei saa myöskään sisältää merkkijonoa "klo" (tällöin kyseessä on sivuutettava rivi,
                // jossa ilmoitetaan otteen ajankohta)
                (tuomiojaksonRivit[j].indexOf(" klo ") == -1) &&
                // edellinen rivi ei saa olla "Suoritustiedot" (tällöin kyseessä on suoritustietopvm)
                (edellinenLaji != 11)) {

                // jos kyseessä ensimmäinen rivi, joka ilmoittaa tuomion pvm:n
                if (edellinenLaji == -1) {

                    if (tila == 0) {
                        uusiTuomio.pvm.setFullYear(tuomiojaksonRivit[j].substr(6,4),
                            tuomiojaksonRivit[j].substr(3,2) - 1, tuomiojaksonRivit[j].substr(0,2));
                        pvm1.setFullYear(tuomiojaksonRivit[j].substr(6,4), tuomiojaksonRivit[j].substr(3,2) - 1,
                            tuomiojaksonRivit[j].substr(0,2));
                        laji = 1;
                    }

                } else {

                    // muussa tapauksessa kyseessä on tuomion 2 tai 3 pvm (tila 3 tai 4) taikka rikoksen pvm (tila 1)

                    if (tila == 3) {
                        pvm2.setFullYear(tuomiojaksonRivit[j].substr(6,4), tuomiojaksonRivit[j].substr(3,2) - 1,
                            tuomiojaksonRivit[j].substr(0,2));
                        tuomioistuin2 = tuomiojaksonRivit[j].substr(11);
                        laji = 12;
                    }

                    if (tila == 4) {
                        pvm3.setFullYear(tuomiojaksonRivit[j].substr(6,4), tuomiojaksonRivit[j].substr(3,2) - 1,
                            tuomiojaksonRivit[j].substr(0,2));
                        tuomioistuin3 = tuomiojaksonRivit[j].substr(11);
                        laji = 13;
                    }

                    if (tila == 1 && syytekohtaJaNimikeTunnistettu) {

                        uusiRikos.pvm.setFullYear(tuomiojaksonRivit[j].substr(6,4),
                            tuomiojaksonRivit[j].substr(3,2) - 1, tuomiojaksonRivit[j].substr(0,2));
                        laji = 5;

                        // tarkistetaan vielä, onko rivillä pvm:n perässä viiva ja toinen pvm,
                        // jolloin kyseessä on pitkä tekoaika

                        // -nn.nn.nnnn, pvm 1-31, kk 1-12, v 1950-2099
                        if ((/-([0-9]{2}).([0-9]{2}).([0-9]{4})/.test(tuomiojaksonRivit[j].substr(10, 11))) && 
                           ((tuomiojaksonRivit[j].substr(11,2) > 0) && (tuomiojaksonRivit[j].substr(11,2) < 32) &&
                           (tuomiojaksonRivit[j].substr(14,2) > 0) && (tuomiojaksonRivit[j].substr(14,2) < 13) &&
                           (tuomiojaksonRivit[j].substr(17,4) > 1950) && (tuomiojaksonRivit[j].substr(17,4) < 2100))) {
                            uusiRikos.pitkaTekoaika = true;
                            uusiRikos.alkupvm.setFullYear(tuomiojaksonRivit[j].substr(6,4),
                                tuomiojaksonRivit[j].substr(3,2) - 1, tuomiojaksonRivit[j].substr(0,2));
                            uusiRikos.pvm.setFullYear(tuomiojaksonRivit[j].substr(17,4),
                                tuomiojaksonRivit[j].substr(14,2) - 1, tuomiojaksonRivit[j].substr(11,2));
                        }

                        // lisätään uusi rikos lisättävien rikosten luetteloon

                        if (uusiRikos.pitkaTekoaika) {
                            lisattavatRikokset.push(new Rikos(new Date(uusiRikos.pvm.getTime()),
                                uusiRikos.syytekohta, uusiRikos.nimike, tuomiolaskuriEhdottomat, null, true,
                                new Date(uusiRikos.alkupvm.getTime()), uusiRikos.pvmTeksti, uusiRikos.pvmEpaselva));
                        } else {
                            lisattavatRikokset.push(new Rikos(new Date(uusiRikos.pvm.getTime()),
                                uusiRikos.syytekohta, uusiRikos.nimike, tuomiolaskuriEhdottomat, null, false,
                                null, uusiRikos.pvmTeksti, uusiRikos.pvmEpaselva));
                        }

                        syytekohtaJaNimikeTunnistettu = false;

                    }
                }

            }

            // onko kyseessä ritu-aikaa edeltävä tilanne eli ratkaisunro on alle 100000?
            // (tällöin vapaamuotoisesti kirjoitettu tekoaika; KKO:ssa ilmeisesti aina alle 100000)
            // pyritään tunnistamaan tällaisesta tuomiosta tekoaika

            if ((uusiTuomio.ratkaisunro < 100000 || (ratkaisunro1 > 0 && ratkaisunro1 < 10000)) &&
                tuomiojaksonRivit[j].length > 7 && tila == 1 && syytekohtaJaNimikeTunnistettu) {

                // tässä tarkistetaan vain tekoajan päättymispvm (rivi päättyy pvm:ään ja 1-nroinen pvm/kk)

                let apumuuttuja = "";

                if (tuomiojaksonRivit[j].length > 8) {
                    apumuuttuja = tuomiojaksonRivit[j].substr(tuomiojaksonRivit[j].length - 9);
                }
                if (tuomiojaksonRivit[j].length == 8) {
                    apumuuttuja = tuomiojaksonRivit[j];
                }

                let tunnistettu = false;

                if ((/[0-9].([0-9]{2}).([0-9]{4})/.test(apumuuttuja)) && // n.nn.nnnn
                    (apumuuttuja.substr(0,1) > 0) && (apumuuttuja.substr(0,1) < 32) && // pv 1-31
                    (apumuuttuja.substr(2,2) > 0) && (apumuuttuja.substr(2,2) < 13) && // kk 1-12
                    (apumuuttuja.substr(5,4) > 1950) && (apumuuttuja.substr(5,4) < 2100)) { // v 1951-2099
                    uusiRikos.pvm.setFullYear(apumuuttuja.substr(5,4), apumuuttuja.substr(2,2) - 1,
                        apumuuttuja.substr(0,1));
                    laji = 5;
                    uusiRikos.pvmTeksti = tuomiojaksonRivit[j].toString();
                    uusiRikos.pvmEpaselva = true;
                    tunnistettu = true;
                }

                if ((/([0-9]{2}).[0-9].([0-9]{4})/.test(apumuuttuja)) && // nn.n.nnnn
                    (apumuuttuja.substr(0,2) > 0) && (apumuuttuja.substr(0,2) < 32) && // pv 1-31
                    (apumuuttuja.substr(3,1) > 0) && (apumuuttuja.substr(3,1) < 13) && // kk 1-12
                    (apumuuttuja.substr(5,4) > 1950) && (apumuuttuja.substr(5,4) < 2100)) { // v 1951-2099
                    uusiRikos.pvm.setFullYear(apumuuttuja.substr(5,4), apumuuttuja.substr(3,1) - 1,
                        apumuuttuja.substr(0,2));
                    laji = 5;
                    uusiRikos.pvmTeksti = tuomiojaksonRivit[j].toString();
                    uusiRikos.pvmEpaselva = true;
                    tunnistettu = true;
                }

                if ((/[0-9].[0-9].([0-9]{4})/.test(apumuuttuja)) && // n.n.nnnn
                    (apumuuttuja.substr(0,1) > 0) && (apumuuttuja.substr(0,1) < 32) && // pv 1-31
                    (apumuuttuja.substr(2,1) > 0) && (apumuuttuja.substr(2,1) < 13) && // kk 1-12
                    (apumuuttuja.substr(4,4) > 1950) && (apumuuttuja.substr(4,4) < 2100)) { // v 1951-2099
                    uusiRikos.pvm.setFullYear(apumuuttuja.substr(4,4), apumuuttuja.substr(2,1) - 1,
                        apumuuttuja.substr(0,1));
                    laji = 5;
                    uusiRikos.pvmTeksti = tuomiojaksonRivit[j].toString();
                    uusiRikos.pvmEpaselva = true;
                    tunnistettu = true;
                }

                if (tuomiojaksonRivit[j].length > 9) { // jos pitkä tekoaika on mallia nn.nn.nnnn vanhassa tuomiossa
                    let apumuuttuja2 = tuomiojaksonRivit[j].substr(tuomiojaksonRivit[j].length - 10);
                    if ((/[0-9]{2}.[0-9]{2}.([0-9]{4})/.test(apumuuttuja2)) && // nn.nn.nnnn
                        (apumuuttuja2.substr(0,2) > 0) && (apumuuttuja2.substr(0,2) < 32) && // pv 1-31
                        (apumuuttuja2.substr(3,1) > 0) && (apumuuttuja2.substr(3,2) < 13) && // kk 1-12
                        (apumuuttuja2.substr(6,4) > 1950) && (apumuuttuja2.substr(6,4) < 2100)) { // v 1951-2099
                        uusiRikos.pvm.setFullYear(apumuuttuja2.substr(6,4), apumuuttuja2.substr(3,2) - 1,
                            apumuuttuja2.substr(0,2));
                        laji = 5;
                        uusiRikos.pvmTeksti = tuomiojaksonRivit[j].toString();
                        uusiRikos.pvmEpaselva = true;
                        tunnistettu = true;
                    }
                }

                // seuraava voi toteutua, jos sekä pv että kk ovat 1-numeroisia ja on pitkä tekoaika
                // (tällöin n.nn.nnnn ja nn.n.nnnn eivät ole toteutuneet ja apumuuttujan 1. merkki
                // on jotain pvm:ään kuulumatonta, esim. "-5.4.2002")

                if (!tunnistettu) {
                    apumuuttuja = apumuuttuja.slice(1); // poistetaan 1. merkki
                    if ((/[0-9].[0-9].([0-9]{4})/.test(apumuuttuja)) && // n.n.nnnn
                        (apumuuttuja.substr(0,1) > 0) && (apumuuttuja.substr(0,1) < 32) && // pv 1-31
                        (apumuuttuja.substr(2,1) > 0) && (apumuuttuja.substr(2,1) < 13) && // kk 1-12
                        (apumuuttuja.substr(4,4) > 1950) && (apumuuttuja.substr(4,4) < 2100)) { // v 1951-2099
                        uusiRikos.pvm.setFullYear(apumuuttuja.substr(4,4), apumuuttuja.substr(2,1) - 1,
                            apumuuttuja.substr(0,1));
                        laji = 5;
                        uusiRikos.pvmTeksti = tuomiojaksonRivit[j].toString();
                        uusiRikos.pvmEpaselva = true;
                        tunnistettu = true;
                    }
                }

                if (!tunnistettu) {
                
                    let vuosiluku = 0;
                    let vuosiluvunSijainti = 0;

                    // seuraavan rivin logiikka voitaisiin siirtää koko tämän tekoajantunnistusosuuden alkuun

                    let onkoVuosilukua = tuomiojaksonRivit[j].match(/([0-9]{4})(?!.*[0-9]{4})/g);

                    if (onkoVuosilukua != null) {
                        vuosiluku = onkoVuosilukua[0];
                    }

                    if (vuosiluku > 1950 && vuosiluku < 2100) {
                        vuosiluvunSijainti = tuomiojaksonRivit[j].lastIndexOf(vuosiluku);

                        // pyritään tulkitsemaan tulkinnanvarainen tekoaika (esim. "kesä 2006";
                        // tällaiset on lueteltu alussa määritellyssä ajankohdat[]-taulukossa);

                        let vertailuajankohta = "";
                        let vertailuteksti = "";
                        let pv = 0;
                        let kk = 0;

                        for (let n = 0; n < ajankohdat.length; n += 4) {

                            vertailuajankohta = ajankohdat[n] + " " + vuosiluku;
                            if (ajankohdat[n + 1] != "") {       
                                vertailuajankohta += " " + ajankohdat[n + 1];
                                vertailuteksti = tuomiojaksonRivit[j]
                                    .substring(vuosiluvunSijainti - ajankohdat[n].length - 1,
                                        vuosiluvunSijainti + vuosiluku.toString().length + 1
                                        + ajankohdat[n + 1].length);
                            } else {
                                vertailuteksti = tuomiojaksonRivit[j].substring(vuosiluvunSijainti
                                    - ajankohdat[n].length - 1, vuosiluvunSijainti + vuosiluku.toString().length);
                            }

                            if (vertailuajankohta == vertailuteksti) {
                                pv = ajankohdat[n + 2];
                                kk = ajankohdat[n + 3];
                            }

                        }

                        if (pv != 0 && kk != 0) {
                            uusiRikos.pvm.setFullYear(vuosiluku, kk - 1, pv);
                            laji = 5;
                            uusiRikos.pvmTeksti = tuomiojaksonRivit[j].toString();
                            uusiRikos.pvmEpaselva = true;
                            tunnistettu = true;
                            varoitukset.push("Tuomiossa <i>" + uusiTuomio.lyhytNimi()
                                + "</i> olevan rikoksen (<i>" + uusiRikos.syytekohta + " " + uusiRikos.nimike
                                + "</i>) tekoajankohta on tulkinnanvarainen: &#8217;<i>"
                                + tuomiojaksonRivit[j] + "</i>&#8217; &#8211; kone tulkitsee tekoajaksi tai sen "
                                + "päättymisajankohdaksi " + pv + "." + kk + "." + vuosiluku);
                        } else {

                            // tarkistetaan vielä, täsmääkö pelkkä pvm (vuosiluvun sijainnista 6 vasemmalle,
                            // siis nn.nn. = 6 merkkiä, plus 4 merkin vuosiluku = 10)

                            apumuuttuja = tuomiojaksonRivit[j].substr(vuosiluvunSijainti - 6, 10);

                            if ((/[0-9]{2}.([0-9]{2}).([0-9]{4})/.test(apumuuttuja)) && // nn.nn.nnnn
                                (apumuuttuja.substr(0,2) > 0) && (apumuuttuja.substr(0,2) < 32) && // pv 1-31
                                (apumuuttuja.substr(3,2) > 0) && (apumuuttuja.substr(3,2) < 13) && // kk 1-12
                                (apumuuttuja.substr(6,4) > 1950) && (apumuuttuja.substr(6,4) < 2100)) { // v 1951-2099
                                uusiRikos.pvm.setFullYear(apumuuttuja.substr(6,4), apumuuttuja.substr(3,2) - 1,
                                    apumuuttuja.substr(0,2));
                                laji = 5;
                                uusiRikos.pvmTeksti = tuomiojaksonRivit[j].toString();
                                uusiRikos.pvmEpaselva = true;
                                tunnistettu = true;
                            }

                            // seuraava osio vastaa ylempänä olevaa (paitsi ympäröivä if-lauseke ja alun slice-rivi)

                            if (!tunnistettu) {

                                apumuuttuja = apumuuttuja.slice(1); // poistetaan 1. merkki
                            
                                if ((/[0-9].([0-9]{2}).([0-9]{4})/.test(apumuuttuja)) && // n.nn.nnnn
                                    (apumuuttuja.substr(0,1) > 0) && (apumuuttuja.substr(0,1) < 32) && // pv 1-31
                                    (apumuuttuja.substr(2,2) > 0) && (apumuuttuja.substr(2,2) < 13) && // kk 1-12
                                    (apumuuttuja.substr(5,4) > 1950) && (apumuuttuja.substr(5,4) < 2100)) { // v 51-99
                                    uusiRikos.pvm.setFullYear(apumuuttuja.substr(5,4), apumuuttuja.substr(2,2) - 1,
                                        apumuuttuja.substr(0,1));
                                    laji = 5;
                                    uusiRikos.pvmTeksti = tuomiojaksonRivit[j].toString();
                                    uusiRikos.pvmEpaselva = true;
                                    tunnistettu = true;
                                }

                                if ((/([0-9]{2}).[0-9].([0-9]{4})/.test(apumuuttuja)) && // nn.n.nnnn
                                    (apumuuttuja.substr(0,2) > 0) && (apumuuttuja.substr(0,2) < 32) && // pv 1-31
                                    (apumuuttuja.substr(3,1) > 0) && (apumuuttuja.substr(3,1) < 13) && // kk 1-12
                                    (apumuuttuja.substr(5,4) > 1950) && (apumuuttuja.substr(5,4) < 2100)) { // v 51-99
                                    uusiRikos.pvm.setFullYear(apumuuttuja.substr(5,4), apumuuttuja.substr(3,1) - 1,
                                        apumuuttuja.substr(0,2));
                                    laji = 5;
                                    uusiRikos.pvmTeksti = tuomiojaksonRivit[j].toString();
                                    uusiRikos.pvmEpaselva = true;
                                    tunnistettu = true;
                                }

                                // seuraava voi toteutua, jos sekä pv että kk ovat 1-numeroisia
                                // (tällöin n.nn.nnnn ja nn.n.nnnn eivät ole toteutuneet ja apumuuttujan 1. merkki
                                // on jotain pvm:ään kuulumatonta, esim. "-5.4.2002")

                                if (!tunnistettu) {
                                    apumuuttuja = apumuuttuja.slice(1); // poistetaan 1. merkki
                                    if ((/[0-9].[0-9].([0-9]{4})/.test(apumuuttuja)) &&
                                        (apumuuttuja.substr(0,1) > 0) && (apumuuttuja.substr(0,1) < 32) &&
                                        (apumuuttuja.substr(2,1) > 0) && (apumuuttuja.substr(2,1) < 13) &&
                                        (apumuuttuja.substr(4,4) > 1950) && (apumuuttuja.substr(4,4) < 2100)) {
                                        uusiRikos.pvm.setFullYear(apumuuttuja.substr(4,4), apumuuttuja.substr(2,1) - 1,
                                            apumuuttuja.substr(0,1));
                                        laji = 5;
                                        uusiRikos.pvmTeksti = tuomiojaksonRivit[j].toString();
                                        uusiRikos.pvmEpaselva = true;
                                        tunnistettu = true;
                                    }
                                }
                            }

                            // ylempänä olevaa vastaava osio päättyy

                        }

                        if (!tunnistettu) {
                            uusiRikos.pvm.setFullYear(vuosiluku, 6, 15);
                            laji = 5;
                            varoitukset.push("Tuomiossa <i>" + uusiTuomio.lyhytNimi()
                                + "</i> olevan rikoksen (<i>" + uusiRikos.syytekohta + " " + uusiRikos.nimike
                                + "</i>) tekoajankohdasta pystyttiin tunnistamaan vain vuosiluku: &#8217;<i>"
                                + tuomiojaksonRivit[j] + "</i>&#8217; &#8211; tekoajan päättymispäiväksi merkitään "
                                + "15.7." + vuosiluku);
                            uusiRikos.pvmTeksti = tuomiojaksonRivit[j].toString();
                            uusiRikos.pvmEpaselva = true;
                            tunnistettu = true;
                        }

                    }
                }

                // onko vanhanmallinen pvm tunnistettu?

                if (tunnistettu) {

                    // tarkistetaan, onko rikoksen pvm ennen käsiteltävän tuomion pvm:ää (tämä on mahdollista 
                    // joissakin harvinaisissa tilanteissa, joissa pvm on tulkinnanvarainen)

                    if (uusiRikos.pvm.getTime() > uusiTuomio.pvm.getTime()) {
                        varoitukset.push("Tuomiossa <i>" + uusiTuomio.lyhytNimi()
                            + "</i> olevasta rikoksesta (<i>" + uusiRikos.syytekohta + " " + uusiRikos.nimike
                            + "</i>) tunnistettu tekoajankohta <i>" + pvmTekstiksi(uusiRikos.pvm)
                            + "</i> on vasta tuomion antopäivän " + pvmTekstiksi(uusiTuomio.pvm) + " jälkeen &#8211; "
                            + "tekoajaksi korjataan päivämäärä, joka on kuukausi ennen tuomion antamista");
                        uusiRikos.pvm = new Date(uusiTuomio.pvm.getTime());
                        uusiRikos.pvm.setMonth(uusiRikos.pvm.getMonth() - 1);
                    }

                    // lisätään uusi rikos lisättävien rikosten luetteloon (huom! koodi sama kuin ylempänä)

                    if (uusiRikos.pitkaTekoaika) {
                        lisattavatRikokset.push(new Rikos(new Date(uusiRikos.pvm.getTime()),
                            uusiRikos.syytekohta, uusiRikos.nimike, tuomiolaskuriEhdottomat, null, true,
                            new Date(uusiRikos.alkupvm.getTime()), uusiRikos.pvmTeksti, uusiRikos.pvmEpaselva));
                    } else {
                        lisattavatRikokset.push(new Rikos(new Date(uusiRikos.pvm.getTime()),
                            uusiRikos.syytekohta, uusiRikos.nimike, tuomiolaskuriEhdottomat, null, false,
                            null, uusiRikos.pvmTeksti, uusiRikos.pvmEpaselva));
                    }

                    syytekohtaJaNimikeTunnistettu = false;

                }

            }

            // tuomioistuimen tunnistus: rivi päättyy aina sanoihin "Lainvoimainen" tai "Lainvoimaisuus"
            // tai "Ei lainvoimainen" tai "Täytäntöönpanok" (sana katkeaa); (ainoastaan ensimmäisen osalta!)
            // (huom! "Lainvoimaisuus" viittaa sanoihin "Lainvoimaisuus määrittämätön")

            if (tila == 0) {

                if (/Lainvoimainen$/.test(tuomiojaksonRivit[j])) {
                    uusiTuomio.tuomioistuin = tuomiojaksonRivit[j].split(" Lainvoimainen")[0];
                    tuomioistuin1 = uusiTuomio.tuomioistuin;
                    uusiTuomio.lainvoimaisuus = true;
                    laji = 2;
                }

                if (/Lainvoimaisuus$/.test(tuomiojaksonRivit[j])) {
                    uusiTuomio.tuomioistuin = tuomiojaksonRivit[j].split(" Lainvoimaisuus")[0];
                    tuomioistuin1 = uusiTuomio.tuomioistuin;
                    uusiTuomio.lainvoimaisuus = false;
                    laji = 2;
                }

                if (/Ei lainvoimainen$/.test(tuomiojaksonRivit[j])) {
                    uusiTuomio.tuomioistuin = tuomiojaksonRivit[j].split(" Ei lainvoimainen")[0];
                    tuomioistuin1 = uusiTuomio.tuomioistuin;
                    uusiTuomio.lainvoimaisuus = false;
                    laji = 2;
                }

                if (/Täytäntöönpanok$/.test(tuomiojaksonRivit[j])) {
                    uusiTuomio.tuomioistuin = tuomiojaksonRivit[j].split(" Täytäntöönpanok")[0];
                    tuomioistuin1 = uusiTuomio.tuomioistuin;
                    uusiTuomio.lainvoimaisuus = false;
                    laji = 2;
                }

            }

            // ratkaisunron tunnistus: rivi alkaa merkkijonolla "no " + nro

            if ((tila == 0) || (tila == 3) || (tila == 4)) {

                if (/^no \d+$/.test(tuomiojaksonRivit[j])) {
                    switch (tila) {
                    case 0:
                        uusiTuomio.ratkaisunro = tuomiojaksonRivit[j].split("no ")[1];
                        ratkaisunro1 = uusiTuomio.ratkaisunro;
                        laji = 3;
                        tila = 3;
                    break;
                    case 3:
                        ratkaisunro2 = tuomiojaksonRivit[j].split("no ")[1];
                        katkaisevaTuomio = 2;
                        laji = 14;
                        tila = 4;
                    break;
                    case 4:
                        ratkaisunro3 = tuomiojaksonRivit[j].split("no ")[1];
                        katkaisevaTuomio = 3;
                        laji = 15;
                        tila = 1;
                        uusiRikos = new Rikos(new Date(0), "", "", 0, 0, false, new Date(0)) // tyhjä rikos
                    break;
                    }
                }

            }

            if ((tila == 1) || (tila == 3) || (tila == 4)) {

                // rikoksen tunnistus: rivi alkaa seuraavasti: nro(ja)+piste+välilyönti+kirjain (esim. "1. Ryöstö")
                // syytekohtanumero voi päättyä pisteeseen (Ritu), välilyöntiin (TLP) tai sulkuun (vanhimmat TLP:t)

                if (/^\d+\.\s([A-Z]|Å|Ä|Ö)/.test(tuomiojaksonRivit[j])) {
                    uusiRikos = new Rikos(new Date(0), "", "", 0, 0, false, new Date(0)) // tyhjä rikos
                    uusiRikos.syytekohta = tuomiojaksonRivit[j].split(" ")[0];
                    uusiRikos.nimike = tuomiojaksonRivit[j].split(/\d+\.\s/)[1];
                    laji = 4;
                    syytekohtaJaNimikeTunnistettu = true;
                    tila = 1;
                }

                if (/^\d+\s([A-Z]|Å|Ä|Ö)/.test(tuomiojaksonRivit[j])) {
                    uusiRikos = new Rikos(new Date(0), "", "", 0, 0, false, new Date(0)) // tyhjä rikos
                    uusiRikos.syytekohta = tuomiojaksonRivit[j].split(" ")[0]+".";
                    uusiRikos.nimike = tuomiojaksonRivit[j].split(/\d+\s/)[1];
                    laji = 4;
                    syytekohtaJaNimikeTunnistettu = true;
                    tila = 1;
                }
                
                if (/^\d+\)\s([A-Z]|Å|Ä|Ö)/.test(tuomiojaksonRivit[j])) {
                    uusiRikos = new Rikos(new Date(0), "", "", 0, 0, false, new Date(0)) // tyhjä rikos
                    uusiRikos.syytekohta = tuomiojaksonRivit[j].split(") ")[0]+".";
                    uusiRikos.nimike = tuomiojaksonRivit[j].split(/\d+\)\s/)[1];
                    laji = 4;
                    syytekohtaJaNimikeTunnistettu = true;
                    tila = 1;
                }

                // vanhimmissa tuomioissa (sulkumerkkiin päättyvä nro) voi joskus olla myös
                // pieni alkukirjain nimikkeessä:

                if (/^\d+\)\s([a-z]|å|ä|ö)/.test(tuomiojaksonRivit[j])) {
                    uusiRikos = new Rikos(new Date(0), "", "", 0, 0, false, new Date(0)) // tyhjä rikos
                    uusiRikos.syytekohta = tuomiojaksonRivit[j].split(") ")[0]+".";
                    uusiRikos.nimike = tuomiojaksonRivit[j].split(/\d+\)\s/)[1];
                    laji = 4;
                    syytekohtaJaNimikeTunnistettu = true;
                    tila = 1;
                }

                // rikoksen tunnistus: rivi alkaa seuraavasti: nro(ja)+piste+nro(ja)+piste+välilyönti+kirjain
                // (esim. "1.1. Varkaus");
                // syytekohtanumero voi päättyä pisteeseen (Ritu), välilyöntiin (TLP) tai sulkuun (vanhimmat TLP:t)

                if (/^\d+\.\d+\.\s([A-Z]|Å|Ä|Ö)/.test(tuomiojaksonRivit[j])) {
                    uusiRikos = new Rikos(new Date(0), "", "", 0, 0, false, new Date(0)) // tyhjä rikos
                    uusiRikos.syytekohta = tuomiojaksonRivit[j].split(" ")[0];
                    uusiRikos.nimike = tuomiojaksonRivit[j].split(/\d+\.\d+\.\s/)[1];
                    laji = 4;
                    syytekohtaJaNimikeTunnistettu = true;
                    tila = 1;
                }

                if (/^\d+\.\d+\s([A-Z]|Å|Ä|Ö)/.test(tuomiojaksonRivit[j])) {
                    uusiRikos = new Rikos(new Date(0), "", "", 0, 0, false, new Date(0)) // tyhjä rikos
                    uusiRikos.syytekohta = tuomiojaksonRivit[j].split(" ")[0]+".";
                    uusiRikos.nimike = tuomiojaksonRivit[j].split(/\d+\.\d+\s/)[1];
                    laji = 4;
                    syytekohtaJaNimikeTunnistettu = true;
                    tila = 1;
                }

                if (/^\d+\.\d+\)\s([A-Z]|Å|Ä|Ö)/.test(tuomiojaksonRivit[j])) {
                    uusiRikos = new Rikos(new Date(0), "", "", 0, 0, false, new Date(0)) // tyhjä rikos
                    uusiRikos.syytekohta = tuomiojaksonRivit[j].split(") ")[0]+".";
                    uusiRikos.nimike = tuomiojaksonRivit[j].split(/\d+\.\d+\)\s/)[1];
                    laji = 4;
                    syytekohtaJaNimikeTunnistettu = true;
                    tila = 1;
                }

                // vanhimmissa tuomioissa (sulkumerkkiin päättyvä nro) voi joskus olla myös
                // pieni alkukirjain nimikkeessä:

                if (/^\d+\.\d+\)\s([a-z]|å|ä|ö)/.test(tuomiojaksonRivit[j])) {
                    uusiRikos = new Rikos(new Date(0), "", "", 0, 0, false, new Date(0)) // tyhjä rikos
                    uusiRikos.syytekohta = tuomiojaksonRivit[j].split(") ")[0]+".";
                    uusiRikos.nimike = tuomiojaksonRivit[j].split(/\d+\.\d+\)\s/)[1];
                    laji = 4;
                    syytekohtaJaNimikeTunnistettu = true;
                    tila = 1;
                }

            }

            // tarkistetaan, onko kyse tilanteesta, jossa rikosnimike jatkuu kahdelle riville:
            // (tällöin lisätään nyt käsiteltävän toisen rivin sisältö rikosnimikkeeseen)
            // lisäksi otetaan huomioon tilanteet kuten "Nuorena henkilönä Nuorena henkilönä..."
            // tai "Yllytys Yllytys..." (joista alkuosa 1. rivillä ja toistuen 2. rivillä)

            if (tila == 1 && laji == 0 && syytekohtaJaNimikeTunnistettu) {

                if (uusiRikos.nimike.toLowerCase() == tuomiojaksonRivit[j]
                    .toLowerCase().substr(0, uusiRikos.nimike.length) ||
                    uusiRikos.nimike.toLowerCase() == tuomiojaksonRivit[j]
                    .toLowerCase().slice(0 - uusiRikos.nimike.length)) {

                    uusiRikos.nimike = tuomiojaksonRivit[j];

                } else {

                    uusiRikos.nimike += " " + tuomiojaksonRivit[j];

                }

                laji = 4;

            }

            // rangaistuskohtaan siirtyminen ("Aikaisempi tuomio" on muuntorangaistuksissa):

            if ((/^Yhteinen rangaistus/.test(tuomiojaksonRivit[j])) ||
                (/^Vankeus/.test(tuomiojaksonRivit[j])) ||
                (/^Yhdistelmärangaistus/.test(tuomiojaksonRivit[j])) ||
                (/^Jäännösrangaistus/.test(tuomiojaksonRivit[j])) ||
                (/^Aikaisempi tuomio/.test(tuomiojaksonRivit[j])) ||
                (/^Syyksi luetut rikokset/.test(tuomiojaksonRivit[j])) ||
                (/^Syyksi luettu rikos/.test(tuomiojaksonRivit[j]))) {
                laji = 6;
                tila = 2;
            }

            // vastaava testi, mutta ennen vuotta 2003 kaikki isolla:
            if ((/^YHTEINEN VANKEUSRANGAISTUS/.test(tuomiojaksonRivit[j])) ||
                (/^VANKEUS/.test(tuomiojaksonRivit[j])) ||
                (/^AIKAISEMPI TUOMIO/.test(tuomiojaksonRivit[j])) ||
                (/^JÄÄNNÖSRANGAISTUS/.test(tuomiojaksonRivit[j]))) {
                laji = 6;
                tila = 2;
            }

            // rangaistuskohdan tunnistus

            if ((tila == 2) && (!valmis)) {

                // tunnistetaan sana vankeutta mutta vältetään sanoja määräämä/tuomitsema/oikeuden/oikeus
                // (rikosrekisteriotteessa näkyvien konkurrenssilausuntojen ohittamiseksi)

                if (/vankeutta$/.test(tuomiojaksonRivit[j])) {
                    if (tuomiojaksonRivit[j].indexOf("määräämä") == -1 &&
                        tuomiojaksonRivit[j].indexOf("tuomitsema") == -1 &&
                        tuomiojaksonRivit[j].indexOf("oikeuden") == -1 &&
                        tuomiojaksonRivit[j].indexOf("oikeus") == -1) {
                        uusiTuomio.rangaistus = tuomiojaksonRivit[j].split(" vankeutta")[0]
                            .replace(" vuosi", "&nbsp;v").replace(" vuotta", "&nbsp;v")
                            .replace(" kuukautta", "&nbsp;kk").replace(" kuukausi", "&nbsp;kk")
                            .replace(" päivää", "&nbsp;pv") + " vankeutta";
                        huomioonotettava = true;
                        ehdollinen = false;
                        laji = 7;
                    }
                }

                if (tuomiojaksonRivit[j].indexOf("sijasta yhdyskuntapalvelua") != -1 &&
                    uusiTuomio.rangaistus != "") {
                    // vanhoissa tuomioissa ykp-teksti voi jakautua 2 riville (eli rivi päättyy
                    // sanoihin "sijasta ykp"); yhdistetään tarvittaessa:
                    if (tuomiojaksonRivit[j].slice(-26) == "sijasta yhdyskuntapalvelua") {
                        tuomiojaksonRivit[j] = tuomiojaksonRivit[j] + " " + tuomiojaksonRivit[j + 1];
                    }
                    uusiTuomio.rangaistus += " &#8658; " + tuomiojaksonRivit[j]
                        .split("sijasta yhdyskuntapalvelua ")[1].replace(" tuntia", "&nbsp;h")
                        .replace(".","") + " ykp";
                    laji = 16;
                }

                if (tuomiojaksonRivit[j].indexOf("sijasta") != -1 &&
                    tuomiojaksonRivit[j].indexOf("valvontarangaistu") != -1 &&
                    uusiTuomio.rangaistus != "") {
                    uusiTuomio.rangaistus += " &#8658; valvontarang.";
                    laji = 17;
                }

                if (tuomiojaksonRivit[j].indexOf("riittävä seuraamus") != -1) {
                    huomioonotettava = true;
                    ehdollinen = false;
                    uusiTuomio.rangaistus = "Riittävä seuraamus";
                    laji = 8;
                }

                // huom. voi jakautua eri riveille, joten vain 1 sana
                if (tuomiojaksonRivit[j].indexOf("riittäväksi") != -1) {
                    huomioonotettava = true;
                    ehdollinen = false;
                    uusiTuomio.rangaistus = "Riittävä seuraamus";
                    laji = 8;
                }

                // huom. voi jakautua eri riveille, joten vain 1 sana
                if (tuomiojaksonRivit[j].indexOf("riittävänä") != -1) {
                    huomioonotettava = true;
                    ehdollinen = false;
                    uusiTuomio.rangaistus = "Riittävä seuraamus";
                    laji = 8;
                }

                // huom. rivinvaihtojen eri sijaintivaihtoehdot TLP-ajan tuomioissa
                if (tuomiojaksonRivit[j].indexOf("koskevat myös nyt") != -1 ||
                    tuomiojaksonRivit[j].indexOf("koskee myös nyt") != -1 ||
                    tuomiojaksonRivit[j].indexOf("myös nyt syyksi luettuja") != -1 ||
                    tuomiojaksonRivit[j].indexOf("myös nyt syyksi luettua") != -1 ||
                    tuomiojaksonRivit[j].indexOf("nyt syyksi luettuja rikoksia") != -1 ||
                    tuomiojaksonRivit[j].indexOf("nyt syyksi luettua rikosta") != -1) {
                    huomioonotettava = true;
                    ehdollinen = false;
                    uusiTuomio.rangaistus = "Riittävä seuraamus";
                    laji = 8;
                }

                // huom. rivinvaihtojen eri sijaintivaihtoehdot / eri sanamuotovaihtoehdot TLP-ajan tuomioissa
                if (tuomiojaksonRivit[j].indexOf("ovat riittävä") != -1 ||
                    tuomiojaksonRivit[j].indexOf("on riittävä") != -1 ||
                    tuomiojaksonRivit[j].indexOf("seuraamus myös") != -1 ||
                    tuomiojaksonRivit[j].indexOf("seuraamus nyt") != -1) {
                    huomioonotettava = true;
                    ehdollinen = false;
                    uusiTuomio.rangaistus = "Riittävä seuraamus";
                    laji = 8;
                }

                if (tuomiojaksonRivit[j].indexOf("Vankeusrangaistus on ehdollinen") != -1) {
                    huomioonotettava = false;
                    ehdollinen = true;
                    uusiTuomio.rangaistus += " (ehdollinen)";
                    laji = 9;
                }

                if (tuomiojaksonRivit[j].indexOf("Suorittamatta oleva osa") != -1 ||
                    tuomiojaksonRivit[j].indexOf("on kokonaan suorittamatta") != -1 ||
                    tuomiojaksonRivit[j].indexOf("Suorittamatta jääneen") != -1) {
                    huomioonotettava = false;
                    ehdollinen = false;
                    sivuutettava = true;
                    laji = 19;
                }

                // seuraavassa otettava huomioon "tuomittu" ja "tuomitsema" (jolloin kyse rikosrekisteriotteessa
                // näkyvästä konkurrenssilausunnosta)

                if ((tuomiojaksonRivit[j].toLowerCase().indexOf("nuorisorangaistus") != -1 ||
                     tuomiojaksonRivit[j].toLowerCase().indexOf("nuorisopalvelu") != -1) &&
                    (tuomiojaksonRivit[j].toLowerCase().indexOf("sema") == -1 &&
                     tuomiojaksonRivit[j].toLowerCase().indexOf("ttu") == -1)) {
                    huomioonotettava = false;
                    ehdollinen = true; // nuorisorangaistus lajitellaan ehdollisten joukkoon
                    nuorisorangaistus = true;
                    uusiTuomio.rangaistus = tuomiojaksonRivit[j].replace(" vuosi", "&nbsp;v")
                        .replace(" vuotta", "&nbsp;v")
                        .replace(" kuukausi", "&nbsp;kk")
                        .replace(" kuukautta", "&nbsp;kk")
                        .replace(" päivää", "&nbsp;pv"
                        .replace(" tuntia", "&nbsp;h"));
                    laji = 18;
                }

                if ((tuomiojaksonRivit[j].indexOf("alioikeudessa ehdollinen") != -1) ||
                    (tuomiojaksonRivit[j].indexOf("ALIOIKEUDESSA EHDOLLINEN") != -1)) {
                    huomioonotettava = true;
                    ehdollinen = false;
                    if (tuomioistuin3 == "") {
                        katkaisevaTuomio = 1;
                    } else {
                        katkaisevaTuomio = 2;
                    }
                    laji = 10;
                }

                if ((tuomiojaksonRivit[j].indexOf("hovioikeudessa ehdollinen") != -1) ||
                    (tuomiojaksonRivit[j].indexOf("HOVIOIKEUDESSA EHDOLLINEN") != -1)) {
                    huomioonotettava = true;
                    ehdollinen = false;
                    katkaisevaTuomio = 1;
                    laji = 10;
                }

            }

            if (/^Suoritustiedot/.test(tuomiojaksonRivit[j])) {
                laji = 11;
                valmis = true;
            }

            if ((uusiTuomio.pvm != 0) && (uusiTuomio.tuomioistuin != "") && (uusiTuomio.ratkaisunro != 0)) {
                tuomionTiedotTunnistettu = true;
            }

            // debug-osio 1

            if (debug) {

                if (laji == 0) {
                    debugHTML.push("<span style='color:#aaa'>");
                }

                debugHTML.push("[" + edellinenLaji + "]" + laji + ": " + tuomiojaksonRivit[j]);

                debugHTML.push("<i style='color:red'>");

                switch (laji) {
                case 1:
                    debugHTML.push("<br />");
                    debugHTML.push("&nbsp;&nbsp;&nbsp;&nbsp;tuomion 1 päivämäärä: ");
                    debugHTML.push(pvmTekstiksi(uusiTuomio.pvm));
                    break;
                case 2:
                    debugHTML.push("<br />");
                    debugHTML.push("&nbsp;&nbsp;&nbsp;&nbsp;tuomioistuin 1: " + uusiTuomio.tuomioistuin);
                    debugHTML.push("<br />");
                    debugHTML.push("&nbsp;&nbsp;&nbsp;&nbsp;lainvoimaisuus: " + uusiTuomio.lainvoimaisuus);
                    break;
                case 3:
                    debugHTML.push("<br />");
                    debugHTML.push("&nbsp;&nbsp;&nbsp;&nbsp;ratkaisunro: " + uusiTuomio.ratkaisunro);
                    break;
                case 4:
                    debugHTML.push("<br />");
                    debugHTML.push("&nbsp;&nbsp;&nbsp;&nbsp;syytekohta: " + uusiRikos.syytekohta);
                    debugHTML.push("<br />");
                    debugHTML.push("&nbsp;&nbsp;&nbsp;&nbsp;rikosnimike: " + uusiRikos.nimike);
                    break;
                case 5:
                    debugHTML.push("<br />");
                    if (uusiRikos.pitkaTekoaika) {
                        debugHTML.push("&nbsp;&nbsp;&nbsp;&nbsp;rikoksen tekoaika: ");
                        debugHTML.push(pvmTekstiksi(uusiRikos.alkupvm));
                        debugHTML.push("&#8211;");
                        debugHTML.push(pvmTekstiksi(uusiRikos.pvm));
                    } else {
                        debugHTML.push("&nbsp;&nbsp;&nbsp;&nbsp;rikoksen tekopäivä: ");
                        debugHTML.push(pvmTekstiksi(uusiRikos.pvm));
                    }
                    break;
                case 7:
                    debugHTML.push("<br />");
                    debugHTML.push("&nbsp;&nbsp;&nbsp;&nbsp;rangaistus: " + uusiTuomio.rangaistus);
                    break;
                case 12:
                    debugHTML.push("<br />");
                    debugHTML.push("&nbsp;&nbsp;&nbsp;&nbsp;tuomion 2 päivämäärä: ");
                    debugHTML.push(pvmTekstiksi(pvm2));
                    debugHTML.push("<br />");
                    debugHTML.push("&nbsp;&nbsp;&nbsp;&nbsp;tuomioistuin 2: " + tuomioistuin2);
                    break;
                case 13:
                    debugHTML.push("<br />");
                    debugHTML.push("&nbsp;&nbsp;&nbsp;&nbsp;tuomion 3 päivämäärä: ");
                    debugHTML.push(pvmTekstiksi(pvm3));
                    debugHTML.push("<br />");
                    debugHTML.push("&nbsp;&nbsp;&nbsp;&nbsp;tuomioistuin 3: " + tuomioistuin3);
                    break;
                case 14:
                    debugHTML.push("<br />");
                    debugHTML.push("&nbsp;&nbsp;&nbsp;&nbsp;ratkaisunro 2: " + ratkaisunro2);
                    break;
                case 15:
                    debugHTML.push("<br />");
                    debugHTML.push("&nbsp;&nbsp;&nbsp;&nbsp;ratkaisunro 3: " + ratkaisunro3);
                    break;
                }

                debugHTML.push("</i>");

                if (laji == 0) {
                    debugHTML.push("</span>");
                }

                debugHTML.push("<br />");

                if (tila != edellinenLaji) {
                    debugHTML.push("<hr />");
                }

            }

            // debug-osio 1 päättyy

            edellinenLaji = laji;
            edellinenLaji = tila;

        }

        // debug-osio 2

        if (debug) {

            if (lisattavatRikokset.length > 0) {
                if (huomioonotettava) {
                    if (uusiTuomio.rangaistus == "Riittävä seuraamus") {
                        debugHTML.push("<hr /><p><b>Tuomio on ns. <i>riittävä seuraamus</i> -tuomio "
                            + "(lajitellaan tässä teknisistä syistä ehdottomaksi, "
                            + "vaikka ei olekaan varsinaisesti RL 7:6.1:n soveltamisalaan kuuluva). "
                            + "Ehdottomien tuomioiden luetteloon lisättävät rikokset:</b></p>");
                    } else {
                        debugHTML.push("<hr /><p><b>Tuomio on <i>ehdoton</i>. "
                            + "Ehdottomien tuomioiden luetteloon lisättävät rikokset:</b></p>");
                    }
                }
                if (ehdollinen) {
                    if (nuorisorangaistus) {
                        debugHTML.push("<hr /><p><b>Tuomio on <i>nuorisorangaistus</i> "
                            + "(lajitellaan tässä teknisistä syistä ehdolliseksi, "
                            + "koska ei ole RL 7:6:n soveltamisalaan kuuluva). "
                            + "Ehdollisten tuomioiden luetteloon lisättävät rikokset:</b></p>");
                    } else {
                        debugHTML.push("<hr /><p><b>Tuomio on <i>ehdollinen</i>. "
                            + "Ehdollisten tuomioiden luetteloon lisättävät rikokset:</b></p>");
                    }
                }
                if (huomioonotettava || ehdollinen) {
                    for (let j = 0; j < lisattavatRikokset.length; j++) {
                        debugHTML.push(lisattavatRikokset[j].syytekohta + " "
                            + lisattavatRikokset[j].nimike + " " + lisattavatRikokset[j].tekoaikaTekstina()[0] + " "
                            + lisattavatRikokset[j].tekoaikaTekstina()[1] + "<br />");
                    }
                }
                if (!huomioonotettava && !ehdollinen && !sivuutettava) {
                        debugHTML.push("<hr /><p><b style='color: red'>Tuomion lajia (ehdollinen/ehdoton) "
                            + "ei pystytty tunnistamaan!</b></p>");
                }
            } else {
                if (sivuutettava) {
                    debugHTML.push("<hr /><p><b>Tuomio on <i>sivuutettava</i> "
                            + "(esim. ykp-muunto tai vastaava).</b></p>");
                } else {
                    if (tuomionTiedotTunnistettu) {
                        debugHTML.push("<hr /><p><b style='color: red'>Tämän tuomion kohdalta "
                            + "ei löytynyt rikoksia!</b></p>");
                    } else {
                        debugHTML.push("<hr /><p><b style='color: red'>Tästä rikosrekisterin osiosta "
                            + "ei tunnistettu tuomiota!</b></p>");
                    }
                }
            }

        }

        // debug-osio 2 päättyy

        if (katkaisevaTuomio == 2) {
            uusiTuomio.pvm = new Date(pvm2.getTime());
            uusiTuomio.tuomioistuin = tuomioistuin2;
            uusiTuomio.ratkaisunro = ratkaisunro2;
        }

        if (katkaisevaTuomio == 3) {
            uusiTuomio.pvm = new Date(pvm3.getTime());
            uusiTuomio.tuomioistuin = tuomioistuin3;
            uusiTuomio.ratkaisunro = ratkaisunro3;
        }

        // jos tuomion perustiedot (pvm, tuomioistuin ja lainvoimaisuus sekä ratkaisunro) ovat kunnossa,
        // tuomioon liittyy rikoksia ja kyseessä on ehdoton, lisätään tuomio ja siihen kuuluvat rikokset luetteloihin

        if (tuomionTiedotTunnistettu && lisattavatRikokset.length > 0 && huomioonotettava) {

            ehdottomatTuomiot.push(new Tuomio(new Date(uusiTuomio.pvm.getTime()), uusiTuomio.tuomioistuin,
                uusiTuomio.ratkaisunro, uusiTuomio.rangaistus, uusiTuomio.lainvoimaisuus, katkaisevaTuomio,
                pvm1, tuomioistuin1, ratkaisunro1, pvm2, tuomioistuin2, ratkaisunro2, pvm3, tuomioistuin3,
                ratkaisunro3));

            for (let j = 0; j < lisattavatRikokset.length; j++) {
                if (lisattavatRikokset[j].pvmEpaselva) {
                    if (pvmTekstiksi(lisattavatRikokset[j].pvm) ==
                        lisattavatRikokset[j].pvmTeksti.slice((0 - pvmTekstiksi(lisattavatRikokset[j].pvm).length))) {
                        lisattavatRikokset[j].pvmEpaselva = false;
                    }
                }
                if (lisattavatRikokset[j].pitkaTekoaika) {
                    rikosluetteloEhdottomat.push(new Rikos(new Date(lisattavatRikokset[j].pvm.getTime()),
                        lisattavatRikokset[j].syytekohta, lisattavatRikokset[j].nimike, tuomiolaskuriEhdottomat,
                        null, true, new Date(lisattavatRikokset[j].alkupvm.getTime()), lisattavatRikokset[j].pvmTeksti,
                        lisattavatRikokset[j].pvmEpaselva));
                    ehdottomatTuomiot[tuomiolaskuriEhdottomat].rikokset.push(rikosluetteloEhdottomat.length - 1);
                } else {
                    rikosluetteloEhdottomat.push(new Rikos(new Date(lisattavatRikokset[j].pvm.getTime()),
                        lisattavatRikokset[j].syytekohta, lisattavatRikokset[j].nimike, tuomiolaskuriEhdottomat,
                        null, false, null, lisattavatRikokset[j].pvmTeksti, lisattavatRikokset[j].pvmEpaselva));
                    ehdottomatTuomiot[tuomiolaskuriEhdottomat].rikokset.push(rikosluetteloEhdottomat.length - 1);
                }
            }

            tuomiolaskuriEhdottomat++;

        }

        // samanlainen toimenpide tehdään myös, jos kyseessä on ehdollinen tuomio

        if (tuomionTiedotTunnistettu && lisattavatRikokset.length > 0 && ehdollinen) {

            ehdollisetTuomiot.push(new Tuomio(new Date(uusiTuomio.pvm.getTime()), uusiTuomio.tuomioistuin,
                uusiTuomio.ratkaisunro, uusiTuomio.rangaistus, uusiTuomio.lainvoimaisuus, katkaisevaTuomio,
                pvm1, tuomioistuin1, ratkaisunro1, pvm2, tuomioistuin2, ratkaisunro2,
                pvm3, tuomioistuin3, ratkaisunro3));

            for (let j = 0; j < lisattavatRikokset.length; j++) {
                if (lisattavatRikokset[j].pvmEpaselva) {
                    if (pvmTekstiksi(lisattavatRikokset[j].pvm) ==
                        lisattavatRikokset[j].pvmTeksti.slice((0 - pvmTekstiksi(lisattavatRikokset[j].pvm).length))) {
                        lisattavatRikokset[j].pvmEpaselva = false;
                    }
                }
                if (lisattavatRikokset[j].pitkaTekoaika) {
                    rikosluetteloEhdolliset.push(new Rikos(new Date(lisattavatRikokset[j].pvm.getTime()),
                        lisattavatRikokset[j].syytekohta, lisattavatRikokset[j].nimike, tuomiolaskuriEhdolliset,
                        null, true, new Date(lisattavatRikokset[j].alkupvm.getTime()), lisattavatRikokset[j].pvmTeksti,
                        lisattavatRikokset[j].pvmEpaselva));
                    ehdollisetTuomiot[tuomiolaskuriEhdolliset].rikokset.push(rikosluetteloEhdolliset.length - 1);
                } else {
                    rikosluetteloEhdolliset.push(new Rikos(new Date(lisattavatRikokset[j].pvm.getTime()),
                        lisattavatRikokset[j].syytekohta, lisattavatRikokset[j].nimike, tuomiolaskuriEhdolliset,
                        null, false, null, lisattavatRikokset[j].pvmTeksti, lisattavatRikokset[j].pvmEpaselva));
                    ehdollisetTuomiot[tuomiolaskuriEhdolliset].rikokset.push(rikosluetteloEhdolliset.length - 1);
                }
            }

            tuomiolaskuriEhdolliset++;

            // vasta tässä vaiheessa, kun on varmistunut, että kyseessä on tuomioluetteloon lisättävä nuorisorangaistus
            // (eikä esim. sellaisen muunto), annetaan asiasta varoitus (koska nuorisorangaistuksen merkitys on
            // tulkinnanvarainen)

            if (nuorisorangaistus) {
                varoitukset.push("Ote sisältää nuorisorangaistuksen &#8211; "
                    + "tarkista mahdollinen vaikutus konkurrenssiin: <i>" + uusiTuomio.lyhytNimi() + "</i>");
            }

        }

        // ulkomaisia tuomioita voi olla rikosrekisterissä ilman ratkaisunumeroa, joten seuraavassa
        // ei tarkisteta ehdolla "if (tuomionTiedotTunnistettu)" vaan tätä suppeammalla, eli riittää, että
        // tuomiosta on tunnistettu pvm ja tuomioistuin (ks. tuomionTiedotTunnistettu-testi ylempänä)

        if (uusiTuomio.pvm != 0 && uusiTuomio.tuomioistuin != "") {
            if (lisattavatRikokset.length == 0 && !sivuutettava) {
                varoitukset.push("Tuomiosta ei pystytty tunnistamaan rikoksia &#8211; "
                    + "tuomio sivuutetaan: <i>" + uusiTuomio.lyhytNimi() + "</i>");
            } else {
                if (!huomioonotettava && !ehdollinen && !sivuutettava) {
                    varoitukset.push("Tuomion lajia (ehdollinen/ehdoton) ei pystytty tunnistamaan &#8211; "
                        + "tuomio sivuutetaan: <i>" + uusiTuomio.lyhytNimi() + "</i>");
                }
            }
        }

        // nollataan muuttujat, joita käytetään useamman tuomion tietojen väliaikaiseen tallettamiseen

        pvm1 = new Date();
        pvm2 = new Date();
        pvm3 = new Date();
        tuomioistuin1 = "";
        tuomioistuin2 = "";
        tuomioistuin3 = "";
        ratkaisunro1 = null;
        ratkaisunro2 = null;
        ratkaisunro3 = null;
        katkaisevaTuomio = 1;

    }

    if (debug) {
        debugHTML.push("<hr /><p>Rikosrekisterin luenta valmis.</p></body></html>");
    }

    console.log("Pdf-muotoisen rikosrekisterin luenta valmis. Tilastot:");
    console.log("- ehdottomia tuomioita löydetty: " + ehdottomatTuomiot.length);
    console.log("- ehdottomista löydetty rikoksia: " + rikosluetteloEhdottomat.length);
    console.log("- ehdollisia tuomioita löydetty: " + ehdollisetTuomiot.length);
    console.log("- ehdollisista löydetty rikoksia: " + rikosluetteloEhdolliset.length + ".");

}

///////////////////////////////////////////////////////////////////////
// lajitteleTuomiot:
// funktio, joka lajittelee tuomiot aikajärjestykseen

function lajitteleTuomiot(tuomiot, rikosluettelo) {

    console.log("Tuomioiden lajittelu aikajärjestykseen alkaa");

    // tuomiot lajitellaan aikajärjestykseen vanhimmasta uusimpaan; lajittelussa on otettava huomioon, että
    // rikosluettelossa olevat viittaukset tuomionumeroihin on myös päivitettävä vastaamaan lajittelun tulosta

    // lajittelun apuvälineenä käytettävä taulukko
    let lajittelu = [];

    for (let i = 0; i < tuomiot.length; i++) {
        lajittelu.push([i, new Date(tuomiot[i].pvm.getTime())]);
        // lajittelu[n][0] = tuomion n nro (indeksi); lajittelu[n][1] = tuomion n pvm
    }

    // nyt lajittelu-taulukko vastaa pvm:n osalta tuomiot-taulukkoa ja sisältää tiedon tuomion alkuperäisestä numerosta

    // lajitellaan taulukot

    lajittelu.sort(function(a, b) {return a[1] - b[1]});

    tuomiot.sort(function(a, b) {return a.pvm - b.pvm});

    // korjataan rikosluettelon viittaukset tuomioihin käyttämällä lajittelu-taulukon tietoja

    for (let i = 0; i < rikosluettelo.length; i++) {
        let j = 0;
        let korjattu = false;
        do {
            if (rikosluettelo[i].tuomionro == lajittelu[j][0]) {
                rikosluettelo[i].tuomionro = j;
                korjattu = true;
            }
            j++;
        }
        while (j < lajittelu.length && !korjattu);
    }

    console.log("Tuomioiden lajittelu aikajärjestykseen valmis");

}

///////////////////////////////////////////////////////////////////////
// luoEsimerkkiRikrek:
// funktio, joka luo esimerkkirikosrekisterin tuomiot ja rikokset
// (ehdottomien ja ehdolliset luomiseksi funktiota on kutsuttava kahdesti)

function luoEsimerkkiRikrek(tuomiot, rikosluettelo, tuomionPvm, tuomioidenMaara, rikoksiaEnintaan, tuomioidenValiMax,
    rikostenValiMax, mhTodennakoisyys, mhValiMax, lainvoimaistenMaara) {

    console.log("Esimerkkirikosrekisterin luonti alkaa");

    const mhValiMin = 99;                           // muutoksenhaun vähimmäiskesto
    const mhVali = mhValiMax - mhValiMin;           // muutoksenhaun väli
    const kkoTodennakoisyys = 0.005;                // KKO:n ratkaisun todennäköisyys
    const hoviKatkaiseeTodennakoisyys = 0.006;      // todennäköisyys sille, että vasta HO:n tuomio on katkaiseva
    const alioikeusHylannytTodennakoisyys = 0.008;  // todennäköisyys sille, että vasta HO:n tuomio näkyy rekisterissä

    // ratkaisunumeron ja rangaistuksen pituuden välit
    const rituRatkaisunroMin = 110000;
    const rituRatkaisunroMaxLisays = 9999;
    const eiRituRatkaisunroMin = 1;
    const eiRituRatkaisunroMaxLisays = 1500;
    const rangaistuksenPituusMin = 1;
    const rangaistuksenPituusMaxLisays = 16;
    const rikoksestaTuomioonMin = 30;
    const rikoksestaTuomioonMaxLisays = 200;

    let nyt = new Date();

    // luettelo rikosnimikkeistä
    const rikosnimikkeet = ["Moottoriajoneuvon käyttövarkaus", "Törkeä varkaus", "Varkaus", "Varkaus", "Varkaus",
        "Avunanto törkeään pahoinpitelyyn", "Pahoinpitely", "Pahoinpitely", "Pahoinpitely",
        "Törkeä huumausainerikos", "Huumausainerikos", "Huumausainerikos", "Huumausaineen käyttörikos",
        "Törkeä vahingonteko", "Vahingonteko", "Vahingonteko", "Petos", "Petos", "Petos", "Rekisterimerkintärikos",
        "Oikeudenkäytössä kuultavan uhkaaminen", "Virkamiehen väkivaltainen vastustaminen", "Kunnianloukkaus",
        "Kotirauhan rikkominen"];

    // seuraaviin taulukkoihin lisätään tiedot eri ajanjaksojen hovioikeuksista ja alioikeuksista
    let ajanjaksot = [];    // taulukko, jossa on ajanjaksojen alkupäivämäärät
    let hovioikeudet = [];  // taulukko, jossa on merkkijonoina luettelo hovioikeuksista
    let hoviKertoimet = []; // taulukko, jossa on hovioikeuksien arvontatodennäköisyyksien painokertoimet
    let hoviSummat = [];    // taulukko, jossa on painokerrointen summat
    let alioikeudet = [];   // taulukko, jossa on taulukko kutakin hovioikeutta kohden ja siinä merkkijonoina
                            // luettelo kyseisen hovioikeuspiirin alioikeuksista

    // asetus 1025/2017
    ajanjaksot.push(new Date(2019, 0, 1));
    hovioikeudet.push(["Helsingin hovioikeus", "Itä-Suomen hovioikeus", "Rovaniemen hovioikeus", "Turun hovioikeus",
        "Vaasan hovioikeus"]);
    hoviKertoimet.push([6, 2, 1, 3, 1]);
    alioikeudet.push([["Helsingin käräjäoikeus", "Itä-Uudenmaan käräjäoikeus", "Länsi-Uudenmaan käräjäoikeus"],
        ["Etelä-Karjalan käräjäoikeus", "Etelä-Savon käräjäoikeus", "Kymenlaakson käräjäoikeus",
        "Pohjois-Karjalan käräjäoikeus", "Pohjois-Savon käräjäoikeus", "Päijät-Hämeen käräjäoikeus"],
        ["Kainuun käräjäoikeus", "Lapin käräjäoikeus", "Oulun käräjäoikeus"],
        ["Ahvenanmaan käräjäoikeus", "Kanta-Hämeen käräjäoikeus", "Pirkanmaan käräjäoikeus",
        "Varsinais-Suomen käräjäoikeus"],
        ["Etelä-Pohjanmaan käräjäoikeus", "Keski-Suomen käräjäoikeus", "Pohjanmaan käräjäoikeus",
        "Satakunnan käräjäoikeus"]]);

    // asetus 337/2013 (1.1.2017 lukien asetuksessa 864/2016; asetuksissa erona vain järjestys;
    // tässä ensin mainitun mukaisessa järjestyksessä
    ajanjaksot.push(new Date(2014, 3, 1));
    hovioikeudet.push(["Turun hovioikeus", "Vaasan hovioikeus", "Itä-Suomen hovioikeus", "Helsingin hovioikeus",
        "Rovaniemen hovioikeus"]);
    hoviKertoimet.push([3, 1, 2, 6, 1]);
    alioikeudet.push([["Ahvenanmaan käräjäoikeus", "Kanta-Hämeen käräjäoikeus", "Länsi-Uudenmaan käräjäoikeus",
        "Pirkanmaan käräjäoikeus", "Varsinais-Suomen käräjäoikeus"],
        ["Etelä-Pohjanmaan käräjäoikeus", "Keski-Pohjanmaan käräjäoikeus", "Keski-Suomen käräjäoikeus",
        "Pohjanmaan käräjäoikeus", "Satakunnan käräjäoikeus"],
        ["Etelä-Karjalan käräjäoikeus", "Etelä-Savon käräjäoikeus", "Kymenlaakson käräjäoikeus",
        "Pohjois-Karjalan käräjäoikeus", "Pohjois-Savon käräjäoikeus", "Päijät-Hämeen käräjäoikeus"],
        ["Espoon käräjäoikeus", "Helsingin käräjäoikeus", "Hyvinkään käräjäoikeus", "Itä-Uudenmaan käräjäoikeus",
        "Tuusulan käräjäoikeus", "Vantaan käräjäoikeus"],
        ["Kainuun käräjäoikeus", "Kemi-Tornion käräjäoikeus", "Lapin käräjäoikeus", "Oulun käräjäoikeus",
        "Ylivieska-Raahen käräjäoikeus"]]);

    // asetus 180/2009
    ajanjaksot.push(new Date(2010, 0, 1));
    hovioikeudet.push(["Turun hovioikeus", "Vaasan hovioikeus", "Itä-Suomen hovioikeus", "Helsingin hovioikeus",
        "Kouvolan hovioikeus", "Rovaniemen hovioikeus"]);
    hoviKertoimet.push([3, 1, 2, 6, 2, 1]);
    alioikeudet.push([["Ahvenanmaan käräjäoikeus", "Kanta-Hämeen käräjäoikeus", "Länsi-Uudenmaan käräjäoikeus",
        "Pirkanmaan käräjäoikeus", "Varsinais-Suomen käräjäoikeus"],
        ["Etelä-Pohjanmaan käräjäoikeus", "Keski-Pohjanmaan käräjäoikeus", "Keski-Suomen käräjäoikeus",
        "Pohjanmaan käräjäoikeus", "Satakunnan käräjäoikeus"],
        ["Etelä-Savon käräjäoikeus", "Kainuun käräjäoikeus", "Pohjois-Karjalan käräjäoikeus",
        "Pohjois-Savon käräjäoikeus"],
        ["Espoon käräjäoikeus", "Helsingin käräjäoikeus", "Itä-Uudenmaan käräjäoikeus", "Tuusulan käräjäoikeus",
        "Vantaan käräjäoikeus"],
        ["Etelä-Karjalan käräjäoikeus", "Hyvinkään käräjäoikeus", "Kymenlaakson käräjäoikeus",
        "Päijät-Hämeen käräjäoikeus"],
        ["Kemi-Tornion käräjäoikeus", "Lapin käräjäoikeus", "Oulun käräjäoikeus", "Ylivieska-Raahen käräjäoikeus"]]);

    // päätös 976/2004
    ajanjaksot.push(new Date(2005, 0, 1));
    hovioikeudet.push(["Turun hovioikeus", "Vaasan hovioikeus", "Itä-Suomen hovioikeus", "Helsingin hovioikeus",
        "Kouvolan hovioikeus", "Rovaniemen hovioikeus"]);
    hoviKertoimet.push([3, 1, 2, 6, 2, 1]);
    alioikeudet.push([["Ahvenanmaan käräjäoikeus", "Forssan käräjäoikeus", "Hämeenlinnan käräjäoikeus",
        "Ikaalisten käräjäoikeus", "Kokemäen käräjäoikeus", "Loimaan käräjäoikeus", "Lohjan käräjäoikeus",
        "Paraisten käräjäoikeus", "Raaseporin käräjäoikeus", "Rauman käräjäoikeus", "Salon käräjäoikeus",
        "Tampereen käräjäoikeus", "Toijalan käräjäoikeus", "Turun käräjäoikeus", "Turunseudun käräjäoikeus",
        "Vakka-Suomen käräjäoikeus"],
        ["Jyväskylän käräjäoikeus", "Jämsän käräjäoikeus", "Kauhajoen käräjäoikeus", "Kauhavan käräjäoikeus",
        "Kokkolan käräjäoikeus", "Kyrönmaan käräjäoikeus", "Mustasaaren käräjäoikeus", "Porin käräjäoikeus",
        "Seinäjoen käräjäoikeus", "Vaasan käräjäoikeus", "Äänekosken käräjäoikeus"],
        ["Iisalmen käräjäoikeus", "Joensuun käräjäoikeus", "Kajaanin käräjäoikeus", "Kuopion käräjäoikeus",
        "Mikkelin käräjäoikeus", "Nilsiän käräjäoikeus", "Nurmeksen käräjäoikeus", "Pieksämäen käräjäoikeus",
        "Savonlinnan käräjäoikeus", "Varkauden käräjäoikeus"],
        ["Espoon käräjäoikeus", "Helsingin käräjäoikeus", "Loviisan käräjäoikeus", "Porvoon käräjäoikeus",
        "Tuusulan käräjäoikeus", "Vantaan käräjäoikeus"],
        ["Heinolan käräjäoikeus", "Hyvinkään käräjäoikeus", "Imatran käräjäoikeus", "Kotkan käräjäoikeus",
        "Kouvolan käräjäoikeus", "Lahden käräjäoikeus", "Lappeenrannan käräjäoikeus", "Orimattilan käräjäoikeus",
        "Riihimäen käräjäoikeus"],
        ["Haapajärven käräjäoikeus", "Kemi-Tornion käräjäoikeus", "Kemijärven käräjäoikeus", "Kuusamon käräjäoikeus",
        "Lapin käräjäoikeus", "Oulun käräjäoikeus", "Raahen käräjäoikeus", "Rovaniemen käräjäoikeus",
        "Ylivieskan käräjäoikeus"]]);

    // asetus 927/1993, alioikeusuudistus 1.12.1993 (1.5.1994 lukien päätöksessä 298/1994) 
    ajanjaksot.push(new Date(1993, 11, 1));
    hovioikeudet.push(["Turun hovioikeus", "Vaasan hovioikeus", "Itä-Suomen hovioikeus", "Helsingin hovioikeus",
        "Kouvolan hovioikeus", "Rovaniemen hovioikeus"]);
    hoviKertoimet.push([3, 1, 2, 6, 2, 1]);
    alioikeudet.push([["Ahvenanmaan käräjäoikeus", "Forssan käräjäoikeus", "Hämeenlinnan käräjäoikeus",
        "Ikaalisten käräjäoikeus", "Kokemäen käräjäoikeus", "Loimaan käräjäoikeus", "Mynämäen käräjäoikeus",
        "Paraisten käräjäoikeus", "Pirkanmaan käräjäoikeus", "Porin käräjäoikeus", "Rauman käräjäoikeus",
        "Salon käräjäoikeus", "Tampereen käräjäoikeus", "Toijalan käräjäoikeus", "Turun käräjäoikeus",
        "Turunseudun käräjäoikeus", "Vammalan käräjäoikeus"],
        ["Alavuden käräjäoikeus", "Haapajärven käräjäoikeus", "Jyväskylän käräjäoikeus", "Jämsän käräjäoikeus",
        "Kauhajoen käräjäoikeus", "Kauhavan käräjäoikeus", "Kokkolan käräjäoikeus", "Kyrönmaan käräjäoikeus",
        "Lapuan käräjäoikeus", "Mustasaaren käräjäoikeus", "Pietarsaaren käräjäoikeus", "Raahen käräjäoikeus",
        "Saarijärven käräjäoikeus", "Seinäjoen käräjäoikeus", "Vaasan käräjäoikeus", "Ylivieskan käräjäoikeus",
        "Äänekosken käräjäoikeus"],
        ["Iisalmen käräjäoikeus", "Joensuun käräjäoikeus", "Juvan käräjäoikeus", "Kajaanin käräjäoikeus",
        "Kuopion käräjäoikeus", "Mikkelin käräjäoikeus", "Nilsiän käräjäoikeus", "Nurmeksen käräjäoikeus",
        "Pieksämäen käräjäoikeus", "Savonlinnan käräjäoikeus", "Varkauden käräjäoikeus"],
        ["Espoon käräjäoikeus", "Helsingin käräjäoikeus", "Hyvinkään käräjäoikeus", "Lohjan käräjäoikeus",
        "Loviisan käräjäoikeus", "Porvoon käräjäoikeus", "Raaseporin käräjäoikeus", "Tuusulan käräjäoikeus",
        "Vantaan käräjäoikeus"],
        ["Heinolan käräjäoikeus", "Iitin käräjäoikeus", "Imatran käräjäoikeus", "Kotkan käräjäoikeus",
        "Kouvolan käräjäoikeus", "Lahden käräjäoikeus", "Lappeenrannan käräjäoikeus", "Orimattilan käräjäoikeus",
        "Riihimäen käräjäoikeus"],
        ["Kemin käräjäoikeus", "Kemijärven käräjäoikeus", "Kuusamon käräjäoikeus", "Lapin käräjäoikeus",
        "Oulun käräjäoikeus", "Rovaniemen käräjäoikeus", "Tornion käräjäoikeus"]]);

    // asetus 438/1985 muutettuna asetuksella 889/1988
    ajanjaksot.push(new Date(1989, 5, 1));
    hovioikeudet.push(["Turun hovioikeus", "Vaasan hovioikeus", "Itä-Suomen hovioikeus", "Helsingin hovioikeus",
        "Kouvolan hovioikeus", "Rovaniemen hovioikeus"]);
    hoviKertoimet.push([3, 1, 2, 6, 2, 1]);
    alioikeudet.push([["Ahvenanmaan tuomiokunta", "Euran tuomiokunta", "Halikon tuomiokunta", "Hauhon tuomiokunta",
        "Ikaalisten tuomiokunta", "Kokemäen tuomiokunta", "Loimaan tuomiokunta", "Paraisten tuomiokunta",
        "Piikkiön tuomiokunta", "Pirkkalan tuomiokunta", "Ruoveden tuomiokunta", "Tammelan tuomiokunta",
        "Toijalan tuomiokunta", "Tyrvään tuomiokunta", "Ulvilan tuomiokunta", "Vehmaan tuomiokunta",
        "Hämeenlinnan raastuvanoikeus", "Naantalin raastuvanoikeus", "Porin raastuvanoikeus", "Rauman raastuvanoikeus",
        "Tampereen raastuvanoikeus", "Turun raastuvanoikeus", "Uudenkaupungin raastuvanoikeus"],
        ["Alavuden tuomiokunta", "Haapajärven tuomiokunta", "Ilmajoen tuomiokunta", "Jyväskylän tuomiokunta",
        "Jämsän tuomiokunta", "Kauhajoen tuomiokunta", "Kauhavan tuomiokunta", "Korsholman tuomiokunta",
        "Kyrön tuomiokunta", "Lapuan tuomiokunta", "Lohtajan tuomiokunta", "Närpiön tuomiokunta",
        "Pietarsaaren tuomiokunta", "Saarijärven tuomiokunta", "Viitasaaren tuomiokunta", "Ylivieskan tuomiokunta",
        "Jyväskylän raastuvanoikeus", "Kokkolan raastuvanoikeus", "Pietarsaaren raastuvanoikeus",
        "Raahen raastuvanoikeus", "Vaasan raastuvanoikeus"],
        ["Iisalmen tuomiokunta", "Ilomantsin tuomiokunta", "Juvan tuomiokunta", "Kajaanin tuomiokunta",
        "Kiteen tuomiokunta", "Kuopion tuomiokunta", "Liperin tuomiokunta", "Mikkelin tuomiokunta",
        "Nilsiän tuomiokunta", "Pieksämäen tuomiokunta", "Pielaveden tuomiokunta", "Pielisjärven tuomiokunta",
        "Rantasalmen tuomiokunta", "Suonenjoen tuomiokunta", "Varkauden tuomiokunta", "Iisalmen raastuvanoikeus",
        "Joensuun raastuvanoikeus", "Kajaanin raastuvanoikeus", "Kuopion raastuvanoikeus", "Mikkelin raastuvanoikeus",
        "Savonlinnan raastuvanoikeus"],
        ["Espoon tuomiokunta", "Hyvinkään tuomiokunta", "Lohjan tuomiokunta", "Loviisan tuomiokunta",
        "Porvoon tuomiokunta", "Raaseporin tuomiokunta", "Tuusulan tuomiokunta", "Vantaan tuomiokunta",
        "Hangon raastuvanoikeus", "Helsingin raastuvanoikeus", "Loviisan raastuvanoikeus", "Porvoon raastuvanoikeus"],
        ["Heinolan tuomiokunta", "Hollolan tuomiokunta", "Iitin tuomiokunta", "Imatran tuomiokunta",
        "Janakkalan tuomiokunta", "Kymin tuomiokunta", "Lappeen tuomiokunta", "Orimattilan tuomiokunta",
        "Valkealan tuomiokunta", "Haminan raastuvanoikeus", "Kotkan raastuvanoikeus", "Lahden raastuvanoikeus",
        "Lappeenrannan raastuvanoikeus"],
        ["Kemijärven tuomiokunta", "Kuusamon tuomiokunta", "Lapin tuomiokunta", "Muhoksen tuomiokunta",
        "Oulujoen tuomiokunta", "Rovaniemen tuomiokunta", "Tornion tuomiokunta", "Kemin raastuvanoikeus",
        "Oulun raastuvanoikeus"]]);

    // lasketaan hovioikeuksien painokerrointen summat
    for (let i = 0; i < hoviKertoimet.length; i++) {
        let summa = 0;
        for (let j = 0; j < hoviKertoimet[i].length; j++) {
            summa += hoviKertoimet[i][j];
        }
        hoviSummat.push(summa);
    }

    // lisättävä myöhemmin: aiemmat tuomiopiirijaot, erityisesti ajalta ennen Kouvolan ja Rovaniemen hovioikeuksia

    // vapaapäivät: uudenvuodenpäivä, loppiainen, vappu, itsenäisyyspäivä ja joulu [kk, pv]
    const vapaapaivat = [[0, 1], [0, 6], [4, 1], [11, 6], [11, 24], [11, 25], [11, 26]];

    // lisättävä myöhemmin: pääsiäinen, helatorstai, juhannus

    // lisätään tuomiot

    for (let i = 0; i < tuomioidenMaara; i++) {

        // alioikeuden ja hovioikeuden indeksit ao. taulukoissa
        let alioikeudenNro = 0;
        let hovioikeudenNro = 0;

        // eri oikeusasteiden tuomioiden tiedot
        let alioikeusPvm, hovioikeusPvm, kkoPvm;
        let alioikeus, hovioikeus;
        let alioikeusRatkaisunro, hovioikeusRatkaisunro, kkoRatkaisunro;
        let lainvoimaisuus, rangaistus;
        let rangaistuksenPituus;

        // vähennetään tuomionPvm-argumenttia satunnaisella määrällä päiviä
        tuomionPvm.setDate(tuomionPvm.getDate() - Math.floor((Math.random() * tuomioidenValiMax) + 1));

        // jos kyseessä on vapaapäivä, siirrytään päivä kerrallaan taaksepäin, kunnes löydetään arkipäivä
        while (onVapaapaiva(tuomionPvm)) {
            tuomionPvm.setDate(tuomionPvm.getDate() - 1);
        }

        // määritetään päivämäärät kolmen oikeusasteen tuomioille em. päivästä lähtien

        alioikeusPvm = new Date(tuomionPvm.getTime());

        hovioikeusPvm = new Date(alioikeusPvm.getTime());
        hovioikeusPvm.setDate(hovioikeusPvm.getDate() + mhValiMin + Math.floor(Math.random() * mhVali));
        while (onVapaapaiva(hovioikeusPvm)) {
            hovioikeusPvm.setDate(hovioikeusPvm.getDate() + 1);
        }

        kkoPvm = new Date(hovioikeusPvm.getTime());
        kkoPvm.setDate(kkoPvm.getDate() + mhValiMin + Math.floor(Math.random() * mhVali));
        while (onVapaapaiva(kkoPvm)) {
            kkoPvm.setDate(kkoPvm.getDate() + 1);
        }

        // etsitään, mille ajanjaksolle alioikeuden tuomio sijoittuu

        let jaksonNro = 0;
        while (jaksonNro < ajanjaksot.length - 1 && ajanjaksot[jaksonNro] > alioikeusPvm) {
            jaksonNro++;
        }

        // arvotaan ensin hovioikeus hovioikeudet-taulukosta

        // tässä otetaan manuaalisesti huomioon Helsingin, Kouvolan ja Rovaniemen hovioikeuksien perustaminen
        // (myöhemmin lisättävä tarkemmat tiedot alioikeusuudistusta edeltäneestä tilanteesta, jolloin tämä tarkistus
        // käy tarpeettomaksi)
        do {
            // arvotaan hovioikeus painotetuilla todennäköisyyksillä
            let tavoite = Math.random() * hoviSummat[jaksonNro];
            let summa = 0;
            for (hovioikeudenNro = 0; hovioikeudenNro < hoviKertoimet[jaksonNro].length; hovioikeudenNro++) {
                summa += hoviKertoimet[jaksonNro][hovioikeudenNro];
                if (summa > tavoite) {
                    break;
                }
            }
        } while ((hovioikeudet[jaksonNro][hovioikeudenNro] == "Helsingin hovioikeus" && hovioikeusPvm <
            new Date(1952, 9, 1)) ||  (hovioikeudet[jaksonNro][hovioikeudenNro] == "Kouvolan hovioikeus" &&
            hovioikeusPvm < new Date(1978, 4, 1)) || (hovioikeudet[jaksonNro][hovioikeudenNro] ==
            "Rovaniemen hovioikeus" && hovioikeusPvm < new Date(1979, 4, 1)))
        hovioikeus = hovioikeudet[jaksonNro][hovioikeudenNro];

        // arvotaan sen jälkeen alioikeus alioikeudet-taulukosta

        alioikeudenNro = Math.floor(Math.random() * alioikeudet[jaksonNro][hovioikeudenNro].length);
        alioikeus = alioikeudet[jaksonNro][hovioikeudenNro][alioikeudenNro];

        // otetaan erityistapauksena huomioon Kouvolan hovioikeuden lakkauttaminen
        if (hovioikeus == "Kouvolan hovioikeus" && hovioikeusPvm >= new Date(2014, 3, 1)) {
            hovioikeus = "Itä-Suomen hovioikeus";
        }

        // HO:n ja alioikeuden ratkaisunumero on erilainen Ritu-aikana (v. 2013 eteenpäin) ja ennen sitä
        if (alioikeusPvm.getFullYear() >= 2013) {
            alioikeusRatkaisunro = rituRatkaisunroMin + Math.floor(Math.random() * rituRatkaisunroMaxLisays);
        } else {
            alioikeusRatkaisunro = eiRituRatkaisunroMin + Math.floor(Math.random() * eiRituRatkaisunroMaxLisays);
        }
        if (hovioikeusPvm.getFullYear() >= 2013) {
            hovioikeusRatkaisunro = rituRatkaisunroMin + Math.floor(Math.random() * rituRatkaisunroMaxLisays);
        } else {
            hovioikeusRatkaisunro = eiRituRatkaisunroMin + Math.floor(Math.random() * eiRituRatkaisunroMaxLisays);
        }

        // KKO:n ratkaisunumero on aina samanlainen
        kkoRatkaisunro = eiRituRatkaisunroMin + Math.floor(Math.random() * eiRituRatkaisunroMaxLisays);

        // luodaan merkkijono, joka sisältää rangaistuksen pituuden
        rangaistuksenPituus = rangaistuksenPituusMin + Math.floor(Math.random() * rangaistuksenPituusMaxLisays);
        if (rangaistuksenPituus < 12) {
            rangaistus = rangaistuksenPituus + " kk vankeutta";
        } else {
            rangaistus = "1 v " + (rangaistuksenPituus - 12) + " kk vankeutta";
        }
        if (rangaistuksenPituus == 12) {
            rangaistus = "1 v vankeutta";
        }

        lainvoimaisuus = true;

        if (i < lainvoimaistenMaara) {
            lainvoimaisuus = false;
        }

        // otetaan huomioon muutoksenhaku asetuksista määritetyn todennäköisyyden mukaisesti
        if (Math.random() < mhTodennakoisyys) {
            // hovioikeuden tuomio lisätään vain, jos se on kuluvaa päivää aiempi
            // (muussa tapauksessa merkitään tuomio lainvoimaa vailla olevaksi; jos näin ei tehtäisi, tuomio voisi olla
            // lainvoimainen ilman muutoksenhakua, vaikka muutoksenhaun todennäköisyydeksi olisi määritetty 100 %)
            if (hovioikeusPvm < nyt) {
                // tarvittaessa lisätään myös KKO:n tuomio rikosrekisteriin
                if (Math.random() < kkoTodennakoisyys && kkoPvm < nyt) {
                    tuomiot.push(new Tuomio(new Date(alioikeusPvm.getTime()), alioikeus, alioikeusRatkaisunro,
                        rangaistus, lainvoimaisuus, 3, new Date(kkoPvm.getTime()), "Korkein oikeus", kkoRatkaisunro,
                        new Date(hovioikeusPvm.getTime()), hovioikeus, hovioikeusRatkaisunro,
                        new Date(alioikeusPvm.getTime()), alioikeus, alioikeusRatkaisunro));
                } else {
                    tuomiot.push(new Tuomio(new Date(alioikeusPvm.getTime()), alioikeus, alioikeusRatkaisunro,
                        rangaistus, lainvoimaisuus, 2, new Date(hovioikeusPvm.getTime()), hovioikeus,
                        hovioikeusRatkaisunro, new Date(alioikeusPvm.getTime()), alioikeus, alioikeusRatkaisunro, 0,
                        "", 0));
                }
            } else {
                lainvoimaisuus = false;
                tuomiot.push(new Tuomio(new Date(alioikeusPvm.getTime()), alioikeus, alioikeusRatkaisunro, rangaistus,
                    lainvoimaisuus, 1, new Date(alioikeusPvm.getTime()), alioikeus, alioikeusRatkaisunro, 0, "", 0, 0,
                    "", 0));
            }
        } else {
            tuomiot.push(new Tuomio(new Date(alioikeusPvm.getTime()), alioikeus, alioikeusRatkaisunro, rangaistus,
                lainvoimaisuus, 1, new Date(alioikeusPvm.getTime()), alioikeus, alioikeusRatkaisunro, 0, "", 0, 0, "",
                0));
        }

        // määritetään vasta hovioikeuden tuomio katkaisevaksi tietyn todennäköisyyden mukaisesti
        if (Math.random() < hoviKatkaiseeTodennakoisyys && tuomiot[tuomiot.length - 1].tuomioistuin2 != "") {
            if (tuomiot[tuomiot.length - 1].tuomioistuin3 != "") {
                tuomiot[tuomiot.length - 1].katkaisevaTuomio = 2;
            } else {
                tuomiot[tuomiot.length - 1].katkaisevaTuomio = 1;
            }
        }

        // poistetaan alioikeuden tuomio (syytteet hylätty) tietyn todennäköisyyden mukaisesti
        if (Math.random() < alioikeusHylannytTodennakoisyys && tuomiot[tuomiot.length - 1].tuomioistuin2 != "") {

            if (tuomiot[tuomiot.length - 1].tuomioistuin3 != "") {

                tuomiot[tuomiot.length - 1].pvm3 = 0;
                tuomiot[tuomiot.length - 1].tuomioistuin3 = "";
                tuomiot[tuomiot.length - 1].ratkaisunro3 = 0;

                tuomiot[tuomiot.length - 1].katkaisevaTuomio = 2;

                tuomiot[tuomiot.length - 1].pvm = tuomiot[tuomiot.length - 1].pvm2;
                tuomiot[tuomiot.length - 1].tuomioistuin = tuomiot[tuomiot.length - 1].tuomioistuin2;
                tuomiot[tuomiot.length - 1].ratkaisunro = tuomiot[tuomiot.length - 1].ratkaisunro2;

            } else {

                tuomiot[tuomiot.length - 1].pvm2 = 0;
                tuomiot[tuomiot.length - 1].tuomioistuin2 = "";
                tuomiot[tuomiot.length - 1].ratkaisunro2 = 0;

                tuomiot[tuomiot.length - 1].katkaisevaTuomio = 1;

                tuomiot[tuomiot.length - 1].pvm = tuomiot[tuomiot.length - 1].pvm1;
                tuomiot[tuomiot.length - 1].tuomioistuin = tuomiot[tuomiot.length - 1].tuomioistuin1;
                tuomiot[tuomiot.length - 1].ratkaisunro = tuomiot[tuomiot.length - 1].ratkaisunro1;

            }

        }

        // lisätään em. tuomioon satunnainen määrä rikoksia

        let rikostenMaaraTuomiossa = 1 + Math.floor(Math.random() * rikoksiaEnintaan);
        let syytekohta = 0;

        for(var j = 0; j < rikostenMaaraTuomiossa; j++) {

            // valitaan satunnainen rikosnimike luettelosta
            let rikosnimike = rikosnimikkeet[Math.floor(Math.random() * (rikosnimikkeet.length))];

            // lisätään syytekohtanumeroa satunnaisesti
            syytekohta++;
            if (Math.random() < 0.2) {
                syytekohta++;
            }
            if (Math.random() < 0.1) {
                syytekohta++;
            }
            if (Math.random() < 0.05) {
                syytekohta++;
            }

            // lisätään uusi rikos rikosluettelo-taulukkoon
            rikosluettelo.push(new Rikos(new Date(0), syytekohta + ".", rikosnimike, i, null, false, null, "", false));

            // lisätään myös sen numero tuomiot-taulukkoon
            tuomiot[i].rikokset.push(rikosluettelo.length - 1);

         }

        // määritetään näille rikoksille tekopäivät

        // aloitetaan rikosten laskeminen tuomion päivämäärästä taaksepäin
        let rikoksenPvm = new Date(tuomionPvm.getTime());
        rikoksenPvm.setDate(rikoksenPvm.getDate() - rikoksestaTuomioonMin
            - Math.floor(Math.random() * rikoksestaTuomioonMaxLisays));

        for(var j = 0; j < rikostenMaaraTuomiossa; j++) {

            // vähennetään päivämäärälaskuria satunnaisella pvm-määrällä, joka voi olla myös 0
            rikoksenPvm.setDate(rikoksenPvm.getDate() - Math.floor(Math.random() * rikostenValiMax));

            // asetetaan ko. päivä rikoksentekopäivämääräksi
            rikosluettelo[rikosluettelo.length - 1 - j].pvm = new Date(rikoksenPvm.getTime());

        }

    }

    console.log("Esimerkkirikosrekisterin luonti valmis");

    return tuomionPvm;

    function onVapaapaiva(pvm) {

        if (pvm.getDay() == 0 || pvm.getDay() == 6) {
            return true;
        }

        let v = pvm.getFullYear();
        let kk = pvm.getMonth();
        let pv = pvm.getDate();

        for (let n = 0; n < vapaapaivat.length; n++) {            
            if (vapaapaivat[n].toString() == [kk, pv].toString()) {
                return true;
            }
        }

        return false;

    }

}

  </script>

 </body>

</html>
